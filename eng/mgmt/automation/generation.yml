trigger: none

pr: none

pool:
  vmImage: 'ubuntu-18.04'

variables:
  MAVEN_CACHE_FOLDER: $(Pipeline.Workspace)/.m2/repository
  MAVEN_OPTS: '-Dmaven.repo.local=$(MAVEN_CACHE_FOLDER)'
  NodeVersion: '14.x'

steps:
- task: Cache@2
  inputs:
    key: 'maven | "$(Agent.OS)"'
    path: $(MAVEN_CACHE_FOLDER)
  displayName: Cache Maven Local Repo

- bash: |
    sudo apt-get install -y --upgrade python3-pip python3-setuptools
    pip3 install --upgrade wheel
    pip3 install --upgrade PyYAML
  displayName: Update python

- task: NodeTool@0
  displayName: 'Install Node.js $(NodeVersion)'
  inputs:
    versionSpec: '$(NodeVersion)'

- bash: |
    npm install -g autorest
    npm install
  displayName: 'Install autorest'

- bash: |
    export PATH=$JAVA_HOME_11_X64/bin:$PATH
    java -version
    ./eng/mgmt/automation/generate.py --readme "$(README)" --tag "$(TAG)" --service "$(SERVICE)" --version "$(VERSION)" --auto-commit-generated-code --user-name "azure-sdk" --user-email "azuresdk@microsoft.com"
  displayName: Generation and Compile

- template: /eng/common/pipelines/templates/steps/create-pull-request.yml
  parameters:
    PRBranchName: Fluent-lite-generation-$(Build.BuildId)
    CommitMsg: '[Automation] Update other files outside generation folder'
    PRTitle: '[Automation] Generate Fluent Lite from $(README)#$(TAG)'
    PRLabels: 'Mgmt - Track 2'
