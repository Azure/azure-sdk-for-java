trigger: none

pr:
  branches:
    include:
      - master
  paths:
    include:
      - eng/pipelines/aggregate-component-check.yml

jobs:
  - job: Generate
    timeoutInMinutes: 60
    variables:
      - template: templates/variables/globals.yml
    pool:
      vmImage: 'ubuntu-18.04'
    steps:
        
    - task: Maven@3
      displayName: 'Build All Libraries'
      inputs:
        mavenPomFile: pom.xml
        options: '$(DefaultOptions) -T 1C -DskipTests -Dgpg.skip -Dmaven.javadoc.skip=true -Dcheckstyle.skip=true -Dspotbugs.skip=true -Djacoco.skip=true -Drevapi.skip=true'
        mavenOptions: '$(MemoryOptions) $(LoggingOptions)'
        javaHomeOption: 'JDKVersion'
        jdkVersionOption: $(JavaBuildVersion)
        jdkArchitectureOption: 'x64'
        publishJUnitResults: false
        goals: 'clean install'

    - task: ms.vss-governance-buildtask.governance-build-task-component-detection.ComponentGovernanceComponentDetection@0
        # ComponentGovernance is currently unable to run on pull requests of public projects. Running on non-PR
        # builds should be sufficient.
        condition: and(succeededOrFailed(), ne(variables['Build.Reason'], 'PullRequest'))
        displayName: 'Component Detection'