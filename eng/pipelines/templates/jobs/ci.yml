parameters:
  - name: SDKType
    type: string
    default: client
  - name: ServiceDirectory
    type: string
    default: 'not-specified' # Set a default that breaks in obvious ways.
  - name: TestPipeline
    type: boolean
    default: false
  - name: Artifacts
    type: object
    default: []
  - name: AdditionalModules
    type: object
    default: []
  - name: PreTestSteps
    type: object
    default: []
  - name: MatrixConfigs
    type: object
  - name: AdditionalMatrixConfigs
    type: object
    default: []
  - name: MatrixFilters
    type: object
    default: []
  - name: MatrixReplace
    type: object
    default: []

jobs:
  - template: /eng/pipelines/templates/jobs/build.yml
    parameters:
      SDKType: ${{ parameters.SDKType }}
      ServiceDirectory: ${{ parameters.ServiceDirectory }}
      Artifacts: ${{ parameters.Artifacts }}
      AdditionalModules: ${{ parameters.AdditionalModules }}
      TestPipeline: ${{ parameters.TestPipeline }}

  - template: /eng/pipelines/templates/jobs/analyze.yml
    parameters:
      SDKType: ${{ parameters.SDKType }}
      ServiceDirectory: ${{ parameters.ServiceDirectory }}
      Artifacts: ${{ parameters.Artifacts }}
      AdditionalModules: ${{ parameters.AdditionalModules }}
      TestPipeline: ${{ parameters.TestPipeline }}

  - template: /eng/pipelines/templates/jobs/analyze.yml
    condition: and(succeeded(), eq(parameters.ServiceDirectory, 'core'))
    displayName: 'Analyze from source'
    parameters:
      SDKType: ${{ parameters.SDKType }}
      ServiceDirectory: ${{ parameters.ServiceDirectory }}
      Artifacts: ${{ parameters.Artifacts }}
      AdditionalModules: ${{ parameters.AdditionalModules }}
      TestPipeline: ${{ parameters.TestPipeline }}

  - template: /eng/common/pipelines/templates/jobs/archetype-sdk-tests-generate.yml
    parameters:
      JobTemplatePath: /eng/pipelines/templates/jobs/ci.tests.yml
      MatrixConfigs: ${{ parameters.MatrixConfigs }}
      MatrixFilters: ${{ parameters.MatrixFilters }}
      MatrixReplace: ${{ parameters.MatrixReplace }}
      CloudConfig:
        Cloud: Public
      AdditionalParameters:
        SDKType: ${{ parameters.SDKType }}
        ServiceDirectory: ${{ parameters.ServiceDirectory }}
        TestPipeline: ${{ parameters.TestPipeline }}
        Artifacts: ${{ parameters.Artifacts }}
        AdditionalModules: ${{ parameters.AdditionalModules }}
        PreTestSteps: ${{ parameters.PreTestSteps }}
