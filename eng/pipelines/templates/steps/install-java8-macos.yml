parameters:
  - name: JavaTestVersion
    type: string
    default: $(JavaTestVersion)
  - name: OSName
    type: string

steps:
  # Debug: Always show the parameters received
  - task: PowerShell@2
    displayName: 'Debug: Show Java 8 macOS template parameters'
    inputs:
      pwsh: true
      targetType: 'inline'
      script: |
        Write-Host "=== Java 8 macOS Template Debug ==="
        Write-Host "JavaTestVersion parameter: '${{ parameters.JavaTestVersion }}'"
        Write-Host "OSName parameter: '${{ parameters.OSName }}'"
        Write-Host "Condition will be: eq('${{ parameters.JavaTestVersion }}', '1.8') AND eq('${{ parameters.OSName }}', 'macOS')"

        if ('${{ parameters.JavaTestVersion }}' -eq '1.8') {
          Write-Host "✅ JavaTestVersion matches '1.8'"
        } else {
          Write-Host "❌ JavaTestVersion '${{ parameters.JavaTestVersion }}' does not match '1.8'"
        }

        if ('${{ parameters.OSName }}' -eq 'macOS') {
          Write-Host "✅ OSName matches 'macOS'"
        } else {
          Write-Host "❌ OSName '${{ parameters.OSName }}' does not match 'macOS'"
        }

  - task: Cache@2
    inputs:
      key: 'jdk | "1.8" | "$(CacheSalt)" | "$(Agent.OS)"'
      path: $(Agent.BuildDirectory)/jdk-8
    displayName: 'Cache Java 8 JDK'
    condition: and(eq('${{ parameters.JavaTestVersion }}', '1.8'), eq('${{ parameters.OSName }}', 'macOS'))

  - task: PowerShell@2
    displayName: 'Install Java 8 JDK on macOS 15'
    inputs:
      pwsh: true
      targetType: 'inline'
      script: |
        # Check macOS version
        $osVersion = sw_vers -productVersion 2>/dev/null
        Write-Host "Current macOS version: $osVersion"

        if ($osVersion -match '^15\.') {
          Write-Host "macOS 15 detected. Proceeding with Java 8 installation."

          # Call the existing installation script
          & "$(Build.SourcesDirectory)/eng/scripts/Install-Latest-JDK.ps1" -JdkFeatureVersion 8
        } else {
          Write-Host "macOS version is $osVersion, not macOS 15. Skipping Java 8 installation."
        }
      workingDirectory: $(Agent.BuildDirectory)
    condition: and(eq('${{ parameters.JavaTestVersion }}', '1.8'), eq('${{ parameters.OSName }}', 'macOS'))
