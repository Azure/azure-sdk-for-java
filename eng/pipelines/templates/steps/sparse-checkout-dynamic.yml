parameters:
  - name: Paths
    type: object
    default: []

steps:
  - template: /eng/common/pipelines/templates/steps/sparse-checkout.yml
    parameters:
      Repositories:
        - Name: Azure/azure-sdk-for-java
          Commitish: $(Build.SourceVersion)
          WorkingDirectory: $(System.DefaultWorkingDirectory)
      Paths:
        - eng/scripts/generate_from_source_pom.py
        - eng/versioning/version_client.txt
        - '**/pom*.xml'

  - task: UsePythonVersion@0
    displayName: 'Use Python 3.6'
    inputs:
      versionSpec: '3.6'
    condition: eq(variables['TestFromSource'], 'true')

  - task: PythonScript@0
    displayName: 'Generate sparse checkout directories'
    inputs:
      scriptPath: 'eng/scripts/generate_from_source_pom.py'
      arguments: '--set-pipeline-variable'
      workingDirectory: '$(System.DefaultWorkingDirectory)'
    condition: and(succeeded(), eq(variables['TestFromSource'], 'true'))

  - pwsh: |
      $paths = '$(FromSourceDirectories)' | ConvertFrom-Json
      foreach ($path in $paths) {
        Write-Host 'git sparse-checkout add $path'
        git sparse-checkout add $path
      }
