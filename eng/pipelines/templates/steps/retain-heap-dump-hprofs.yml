parameters:
  - name: OomArtifactName
    type: string
    default: 'oom-hprofs'

steps:
  - task: PowerShell@2
    displayName: 'Check for and copy OOM hprofs'
    inputs:
      pwsh: true
      filePath: eng/pipelines/scripts/Get-Heap-Dump-Hprofs.ps1
      arguments: >
        -StagingDirectory $(Build.ArtifactStagingDirectory)
        -OomArtifactName ${{ parameters.OomArtifactName }}
    condition: always()

  - publish: $(Build.ArtifactStagingDirectory)/${{ parameters.OomArtifactName }}.zip
    displayName: 'Publish OOM hprofs'
    artifact: ${{ parameters.OomArtifactName }}-$(System.StageName)-$(System.JobName)-$(System.JobAttempt)
    condition: eq(variables['HAS_OOM_PROFS'], 'true')
