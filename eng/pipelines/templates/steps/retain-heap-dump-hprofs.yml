parameters:
  - name: OomArtifactName
    type: string
    default: 'oom-hprofs'

steps:
  - task: PowerShell@2
    displayName: 'Check for and copy OOM hprofs'
    inputs:
      pwsh: true
      filePath: eng/pipelines/scripts/Get-Heap-Dump-Hprofs.ps1
      arguments: >
        -StagingDirectory $(Build.ArtifactStagingDirectory)
        -OomArtifactName ${{ parameters.OomArtifactName }}
    condition: always()

  - template: /eng/common/pipelines/templates/steps/publish-artifact.yml
    parameters:
      ArtifactName: ${{ parameters.OomArtifactName }}-$(System.StageName)-$(System.JobName)-$(System.JobAttempt)
      ArtifactPath: $(Build.ArtifactStagingDirectory)/${{ parameters.OomArtifactName }}.zip
      CustomCondition: eq(variables['HAS_OOM_PROFS'], 'true')
