parameters:
  - name: TestLogsArtifactName
    type: string
    default: 'test-logs'

steps:
  - task: PowerShell@2
    displayName: 'Check for and copy test logs'
    inputs:
      pwsh: true
      filePath: eng/pipelines/scripts/Get-Test-Logs.ps1
      arguments: >
        -StagingDirectory $(Build.ArtifactStagingDirectory)
        -TestLogsArtifactName ${{ parameters.TestLogsArtifactName }}
    condition: always()

  - publish: $(Build.ArtifactStagingDirectory)/${{ parameters.TestLogsArtifactName }}.zip
    displayName: 'Publish test logs'
    artifact: ${{ parameters.TestLogsArtifactName }}-$(System.StageName)-$(System.JobName)-$(System.JobAttempt)
    condition: and(not(succeeded()), eq(variables['HAS_TEST_LOGS'], 'true'))
