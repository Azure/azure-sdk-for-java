parameters:
  - name: TestLogsArtifactName
    type: string
    default: 'test-logs'

steps:
  - task: PowerShell@2
    displayName: 'Check for and copy test logs'
    inputs:
      pwsh: true
      filePath: eng/pipelines/scripts/Get-Test-Logs.ps1
      arguments: >
        -StagingDirectory $(Build.ArtifactStagingDirectory)
        -TestLogsArtifactName ${{ parameters.TestLogsArtifactName }}
    condition: always()

  - template: /eng/common/pipelines/templates/steps/publish-artifact.yml
    parameters:
      ArtifactName: ${{ parameters.TestLogsArtifactName }}-$(System.StageName)-$(System.JobName)-$(System.JobAttempt)
      ArtifactPath: $(Build.ArtifactStagingDirectory)/${{ parameters.TestLogsArtifactName }}.zip
      CustomCondition: and(not(succeeded()), eq(variables['HAS_TEST_LOGS'], 'true'))
