steps:
  - pwsh: |
      if (Test-Path -Path "$(Build.SourcesDirectory)/http-fault-injector.log") {
        Write-Host "##vso[task.setvariable variable=HAS_HTTP_FAULT_INJECTOR_LOGS]true"
      } else {
        Write-Host "##vso[task.setvariable variable=HAS_HTTP_FAULT_INJECTOR_LOGS]false"
      }
    displayName: 'Check if http-fault-injector log file exists'

  - template: ../pipelines/templates/steps/publish-artifact.yml
    parameters:
      ArtifactName: "$(System.JobName)-http-fault-injector-logs"
      ArtifactPath: "$(Build.SourcesDirectory)/http-fault-injector.log"
      CustomCondition: $(HAS_HTTP_FAULT_INJECTOR_LOGS)

  - pwsh: |
      Remove-Item -Force $(Build.SourcesDirectory)/http-fault-injector.log
    displayName: 'Cleanup http-fault-injector log file'
    condition: $(HAS_HTTP_FAULT_INJECTOR_LOGS)
