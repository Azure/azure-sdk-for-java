parameters:
  # This is the flattened
  FlattenedDirectory: not-specified
  StageOnly: false
  ShouldPublish: true

steps:
  - ${{if and(eq(parameters.ShouldPublish, 'true'), ne(parameters.StageOnly, 'true'))}}:
    - task: EsrpRelease@7
      displayName: 'Publish to ESRP'
      inputs:
        ConnectedServiceName: 'Azure SDK Engineering System'
        ClientId: '5f81938c-2544-4f1f-9251-dd9de5b8a81b'
        KeyVaultName: 'AzureSDKEngKeyVault'
        AuthCertName: 'azure-sdk-esrp-release-auth-certificate'
        SignCertName: 'azure-sdk-esrp-release-sign-certificate'
        Intent: 'PackageDistribution'
        ContentType: 'Maven'
        FolderLocation: ${{ parameters.FlattenedDirectory }}
        Owners: ${{ coalesce(variables['Build.RequestedForEmail'], 'azuresdk@microsoft.com') }}
        Approvers: ${{ coalesce(variables['Build.RequestedForEmail'], 'azuresdk@microsoft.com') }}
        ServiceEndpointUrl: 'https://api.esrp.microsoft.com'
        MainPublisher: 'ESRPRELPACMANTEST'
        DomainTenantId: '72f988bf-86f1-41af-91ab-2d7cd011db47'
