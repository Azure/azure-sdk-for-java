[
  {
    "extension": "revapi.java",
    "configuration": {
      "missing-classes": {
        "behavior": "report",
        "ignoreMissingAnnotations": false
      },
      "matchOverloads": true
    }
  },
  {
    "extension": "revapi.versions",
    "configuration": {
      "enabled": true,
      "semantic0": false,
      "versionIncreaseAllows": {
        "major": {
          "severity": "BREAKING"
        },
        "minor": {
          "severity": "NON_BREAKING"
        },
        "patch": {
          "severity": "EQUIVALENT"
        }
      },
      "onAllowed": {
        "remove": true,
        "attachments": {
          "breaksVersioningRules": "false"
        }
      },
      "onDisallowed": {
        "criticality": "error",
        "attachments": {
          "breaksVersioningRules": "true"
        }
      },
      "passThroughDifference": [
        "java.class.nonPublicPartOfAPI"
      ]
    }
  },
  {
    "extension": "revapi.filter",
    "configuration": {
      "elements": {
        "exclude": [
          "class com\\.azure\\.core\\.util\\.Configuration",
          {
            "matcher": "java-package",
            "match": "/com\\.azure(\\..+?)?\\.(implementation|samples)(\\..*)?/"
          },
          {
            "matcher": "java-package",
            "match": "/com\\.fasterxml\\.jackson(\\..*)?/"
          },
          {
            "matcher": "java-package",
            "match": "/reactor\\.(core|netty|util)(\\..*)?/"
          },
          {
            "matcher": "java-package",
            "match": "/io\\.(micrometer|netty)(\\..*)?/"
          },
          {
            "matcher": "java-package",
            "match": "/(kotlin|okhttp3|okio)(\\..+)?/"
          },
          {
            "matcher": "java-package",
            "match": "/com\\.nimbusds(\\..*)?/"
          },
          {
            "matcher": "java-package",
            "match": "/com\\.microsoft\\.azure(\\..*)?/"
          },
          {
            "matcher": "java-package",
            "match": "/javax\\.(jms|servlet)(\\..*)?/"
          },
          {
            "matcher": "java-package",
            "match": "/com\\.azure\\.data\\.cosmos(\\..*)?/"
          },
          "class com\\.azure\\.spring\\.cloud\\.config\\.State",
          "class com\\.azure\\.spring\\.cloud\\.config\\.AppConfigurationRefresh",
          "class com\\.azure\\.spring\\.cloud\\.config\\.properties\\.AppConfigurationProviderProperties",
          "class com\\.azure\\.spring\\.cloud\\.config\\.State",
          "class com\\.azure\\.spring\\.cloud\\.config\\.web\\.pushrefresh\\.AppConfigurationRefreshEvent",
          "class com\\.azure\\.spring\\.cloud\\.config\\.web\\.AppConfigurationEndpoint",
          {
            "matcher": "java-package",
            "match": "/org\\.apache\\.avro(\\..*)?/"
          },
          {
            "matcher": "java-package",
            "match": "/com\\.azure\\.resourcemanager(\\..+?)?\\.fluent(\\..*)?/"
          },
          {
            "matcher": "java-package",
            "match": "/org\\.junit(\\..*)?/"
          },
          {
            "matcher": "java-package",
            "match": "/org.apache.commons(..*)?/"
          },
          {
            "matcher": "java-package",
            "match": "/org.slf4j(..*)?/"
          },
          {
            "matcher": "java-package",
            "match": "/org.springframework(..*)?/"
          }
        ]
      }
    }
  },
  {
    "extension": "revapi.differences",
    "configuration": {
      "ignore": true,
      "differences": [
        {
          "regex": true,
          "code": "java.class.nonPublicPartOfAPI",
          "new": "class com.azure.spring.messaging.container.DefaultMessageListenerContainer",
          "justification": "We allow this in azure.spring.messaging."
        },
        {
          "regex": true,
          "code": "java.class.externalClassExposedInAPI",
          "new": "(class|interface|enum) com.azure.spring.(messaging|integration|cloud.(core|service|autoconfigure|stream.binder.(servicebus|eventhubs)|actuator|resourcemanager))..*",
          "justification": "azure.spring classes are allowed to be exposed."
        },
        {
          "regex": true,
          "code": "java.class.nonPublicPartOfAPI",
          "new": "(class|interface) org\\.apache\\.http\\.impl\\.conn\\.CPoolEntry",
          "exampleUseChainInNewApi": ".*org\\.apache\\.http\\.HttpClientConnection.*",
          "justification": "We allow this in org.apache.http.HttpClientConnection>"
        },
        {
          "regex": true,
          "code": "java.class.nonPublicPartOfAPI",
          "new": "(class|interface) com\\.azure\\.keyvault\\.jca\\.(com|org)\\..*",
          "justification": "skip check for third party files."
        },
        {
          "regex": true,
          "code": "java.class.nonPublicPartOfAPI",
          "new": "(class|enum|interface) org\\.conscrypt\\..*",
          "justification": "skip check for third party files."
        },
        {
          "regex": true,
          "code": "java\\.class\\.externalClassExposedInAPI",
          "new": "(interface|class|enum) com\\.azure\\.(communication\\.common|core|cosmos|data\\.schemaregistry|messaging\\.eventgrid|messaging.servicebus|resourcemanager|security\\.keyvault|storage).*",
          "justification": "SDK classes are allowed to be exposed by dependencies using them."
        },
        {
          "regex": true,
          "code": "java\\.class\\.externalClassExposedInAPI",
          "new": "interface org\\.reactivestreams\\.(Publisher|Subscriber|Subscription).*",
          "justification": "These classes exposed are publisher, subscriber, and Subscription."
        },
        {
          "regex": true,
          "code": "java\\.method\\.addedToInterface",
          "new": "method .* com\\.azure\\.resourcemanager\\..*",
          "justification": "resourcemanager interfaces are allowed to add methods."
        },
        {
          "regex": true,
          "code": "java\\.class\\.externalClassExposedInAPI",
          "new": "(class|interface|enum) com\\.azure\\.perf\\.test\\.core\\..*",
          "justification": "perf-test classes are allowed to be exposed."
        },
        {
          "regex": true,
          "code": "java\\.class\\.externalClassExposedInAPI",
          "new": "(interface|class|enum) io\\.opentelemetry.*",
          "justification": "Azure Monitor Exporter is allowed to use OpenTelemetry types in public APIs as it implements interfaces defined by OpenTelemetry"
        },
        {
          "regex": true,
          "code": "java\\.class\\.externalClassExposedInAPI",
          "new": "(interface|enum) io\\.cloudevents.*",
          "justification": "Azure Event Grid cloud native cloud event is allowed to use CloudEvents types in public APIs as it implements interfaces defined by CloudEvents"
        },
        {
          "regex": true,
          "code": "java\\.class\\.externalClassExposedInAPI",
          "new": "(interface|class) org\\.springframework.util\\.ErrorHandler",
          "justification": "Azure Spring Cloud Messaging need the Spring's public interface for error handler registration, it is a common class for users to handle runtime errors."
        },
        {
          "regex": true,
          "code": "java\\.annotation\\.(added|attributeValueChanged)",
          "old": ".*",
          "annotationType": "com\\.azure\\.core\\.annotation\\.Service(Method|Client)",
          "justification": "These are SDK metadata annotations and don't affect runtime behavior."
        },
        {
          "regex": true,
          "code": "java\\.annotation\\.attributeValueChanged",
          "new": "method byte\\[\\] com\\.azure\\.security\\.keyvault\\.keys\\.models\\.JsonWebKey::(g|s)et(D|Dp|Dq|E|K|N|P|Q|Qi|T|X|Y)\\(\\)",
          "justification": "The class used by the serialization/deserialization annotations is package private and moving it is not a breaking change."
        },
        {
          "regex": true,
          "code": "java\\.annotation\\.(added|attributeValueChanged|attributeAdded)",
          "new": "(class|method void|parameter void) com\\.azure\\.search\\.documents\\.indexes\\.models\\..*",
          "justification": "Generated classes were moved into public API, these annotations were already being used in implementation used during serialization and deserialization."
        },
        {
          "regex": true,
          "code": "java\\.annotation\\.added",
          "new": "(class|interface|method|parameter) org\\.springframework\\.data\\.repository\\.query\\..*",
          "justification": "Spring Data Commons framework 2.6.1 added Nullable annotations to its interfaces."
        },
        {
          "regex": true,
          "code": "java\\.annotation\\.added",
          "new": "(class|interface|method|parameter) com\\.azure\\.spring\\.data\\.cosmos\\.repository\\.query\\..*",
          "justification": "Spring Data Commons framework 2.6.1 added Nullable annotations to its interfaces which are implemented by Cosmos Spring Data SDK for internal usage."
        },
        {
          "code": "java.method.added",
          "new": "method boolean com.google.gson.JsonArray::isEmpty()",
          "justification": "com.google.code.gson:gson:jar:2.8.7 added this new method."
        },
        {
          "code": "java.method.added",
          "new": "method java.lang.String com.azure.storage.common.StorageSharedKeyCredential::generateAuthorizationHeader(java.net.URL, java.lang.String, com.azure.core.http.HttpHeaders, boolean)",
          "justification": "New method added to SharedKeyCredential in common not intended for use by customers. Only public for access by other packages."
        },
        {
          "code": "java.field.removedWithConstant",
          "old": "field com.azure.messaging.eventhubs.EventProcessorClientBuilder.DEFAULT_OWNERSHIP_EXPIRATION_FACTOR",
          "justification": "The default ownership expiration factor is an implementation detail that users can override via configuration."
        },
        {
          "code": "java.class.nonFinalClassInheritsFromNewClass",
          "old": "class com.azure.messaging.eventhubs.EventData",
          "new": "class com.azure.messaging.eventhubs.EventData",
          "superClass": "com.azure.core.models.MessageContent",
          "justification": "To support Schema Registry Avro Serializer's signature, EventData extends from MessageContent."
        },
        {
          "code": "java.missing.newSuperType",
          "old": "class com.azure.messaging.eventhubs.EventData",
          "new": "class com.azure.messaging.eventhubs.EventData",
          "superClass": "com.azure.core.models.MessageContent",
          "justification": "To support Schema Registry Avro Serializer's signature, EventData extends from MessageContent."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.http.HttpResponse com.azure.core.http.HttpClient::sendSync(com.azure.core.http.HttpRequest, com.azure.core.util.Context)",
          "justification": "Temp fix to make patch release pipeline succeed."      
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.http.HttpResponse com.azure.core.http.HttpPipeline::sendSync(com.azure.core.http.HttpRequest, com.azure.core.util.Context)",
          "justification": "Temp fix to make patch release pipeline succeed."        
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method void com.azure.core.http.HttpRequest::<init>(com.azure.core.http.HttpMethod, java.net.URL, com.azure.core.http.HttpHeaders, com.azure.core.util.BinaryData)",
          "justification": "Temp fix to make patch release pipeline succeed."        
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method void com.azure.core.http.HttpRequest::<init>(com.azure.core.http.HttpMethod, java.net.URL, com.azure.core.http.HttpHeaders)",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.util.BinaryData com.azure.core.http.HttpRequest::getBodyAsBinaryData()",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.http.HttpRequest com.azure.core.http.HttpRequest::setBody(com.azure.core.util.BinaryData)",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.util.BinaryData com.azure.core.http.HttpResponse::getBodyAsBinaryData()",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method void com.azure.core.http.HttpResponse::writeBodyTo(java.nio.channels.WritableByteChannel) throws java.io.IOException",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method reactor.core.publisher.Mono<java.lang.Void> com.azure.core.http.HttpResponse::writeBodyToAsync(java.nio.channels.AsynchronousByteChannel)",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.http.HttpResponse com.azure.core.http.policy.HttpPipelinePolicy::processSync(com.azure.core.http.HttpPipelineCallContext, com.azure.core.http.HttpPipelineNextSyncPolicy)",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method void com.azure.core.http.policy.HttpRequestLogger::logRequestSync(com.azure.core.util.logging.ClientLogger, com.azure.core.http.policy.HttpRequestLoggingContext)",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.http.HttpResponse com.azure.core.http.policy.HttpResponseLogger::logResponseSync(com.azure.core.util.logging.ClientLogger, com.azure.core.http.policy.HttpResponseLoggingContext)",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.http.HttpResponse com.azure.core.http.policy.RetryPolicy::processSync(com.azure.core.http.HttpPipelineCallContext, com.azure.core.http.HttpPipelineNextSyncPolicy)",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.util.MetricsOptions com.azure.core.util.ClientOptions::getMetricsOptions()",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.util.ClientOptions com.azure.core.util.ClientOptions::setMetricsOptions(com.azure.core.util.MetricsOptions)",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method reactor.core.publisher.Mono<com.azure.core.util.BinaryData> com.azure.core.util.BinaryData::toReplayableBinaryDataAsync()",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.util.BinaryData com.azure.core.util.BinaryData::toReplayableBinaryData()",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method boolean com.azure.core.util.BinaryData::isReplayable()",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method reactor.core.publisher.Mono<com.azure.core.util.BinaryData> com.azure.core.util.BinaryData::fromStreamAsync(java.io.InputStream, java.lang.Long)",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.util.BinaryData com.azure.core.util.BinaryData::fromStream(java.io.InputStream, java.lang.Long)",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method reactor.core.publisher.Mono<com.azure.core.util.BinaryData> com.azure.core.util.BinaryData::fromFlux(reactor.core.publisher.Flux<java.nio.ByteBuffer>, java.lang.Long, boolean)",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.util.BinaryData com.azure.core.util.BinaryData::fromFile(java.nio.file.Path, java.lang.Long, java.lang.Long, int)",
          "justification": "Temp fix to make patch release pipeline succeed."
        },
        {
          "ignore": true,
          "code": "java.method.removed",
          "old": "method com.azure.core.util.BinaryData com.azure.core.util.BinaryData::fromFile(java.nio.file.Path, java.lang.Long, java.lang.Long)",
          "justification": "Temp fix to make patch release pipeline succeed."
        }
      ]
    }
  }
]
