parameters:
  SourcesCommit: "${env:SYSTEM_PULLREQUEST_SOURCECOMMITID}"
  TargetBranch: "origin/${env:SYSTEM_PULLREQUEST_TARGETBRANCH}"
  TargetCommit: ""
  TargetVar: "diff"
steps:  
- pwsh: |
    $target = ${{parameters.TargetCommit}} -eq "" ? ${{parameters.TargetBranch}} : ${{parameters.TargetCommit}}
    Write-Host "The target is $target."
    $changedFiles = git -c core.quotepath=off -c i18n.logoutputencoding=utf-8 diff $target ${{parameters.SourcesCommit}} --name-only --diff-filter=d
    if(!$changedFiles) {
      Write-Host "No changed files in git diff between origin/${{parameters.TargetBranch}} and ${{parameters.SourcesCommit}}"
    }
    Write-Host "##vso[task.setvariable variable=${{ parameters.TargetVar }}]$changedFiles"
    foreach ($file in $changedFiles) {
      Write-Host "The file is: $file"
    }
  displayName: git diff changes
  condition: eq(variables['Build.Reason'], 'PullRequest')
- pwsh: |
    Write-Output $(diff)
  displayName: Print changed files