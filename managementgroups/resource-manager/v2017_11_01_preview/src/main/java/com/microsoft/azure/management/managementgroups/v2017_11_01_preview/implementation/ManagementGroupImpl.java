/**
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License. See License.txt in the project root for
 * license information.
 *
 * Code generated by Microsoft (R) AutoRest Code Generator.
 *
 */

package com.microsoft.azure.management.managementgroups.v2017_11_01_preview.implementation;

import com.microsoft.azure.management.managementgroups.v2017_11_01_preview.ManagementGroup;
import com.microsoft.azure.arm.model.implementation.CreatableUpdatableImpl;
import rx.Observable;
import com.microsoft.azure.management.managementgroups.v2017_11_01_preview.CreateManagementGroupRequest;
import java.util.List;
import com.microsoft.azure.management.managementgroups.v2017_11_01_preview.ManagementGroupChildInfo;
import com.microsoft.azure.management.managementgroups.v2017_11_01_preview.ManagementGroupDetails;
import rx.functions.Func1;

class ManagementGroupImpl extends CreatableUpdatableImpl<ManagementGroup, ManagementGroupInner, ManagementGroupImpl> implements ManagementGroup, ManagementGroup.Definition, ManagementGroup.Update {
    private String groupId;
    private String ccacheControl;
    private String ucacheControl;
    private CreateManagementGroupRequest createOrUpdateParameter;
    private final ManagementManager manager;

    ManagementGroupImpl(String name, ManagementManager manager) {
        super(name, new ManagementGroupInner());
        this.manager = manager;
        // Set resource name
        this.groupId = name;
        //
        this.createOrUpdateParameter = new CreateManagementGroupRequest();
    }

    ManagementGroupImpl(ManagementGroupInner inner, ManagementManager manager) {
        super(inner.name(), inner);
        this.manager = manager;
        // Set resource name
        this.groupId = inner.name();
        // set resource ancestor and positional variables
        this.groupId = IdParsingUtils.getValueFromIdByName(inner.id(), "managementGroups");
        // set other parameters for create and update
        this.createOrUpdateParameter = new CreateManagementGroupRequest();
    }

    @Override
    public ManagementManager manager() {
        return this.manager;
    }

    @Override
    public Observable<ManagementGroup> createResourceAsync() {
        ManagementGroupsInner client = this.manager().inner().managementGroups();
        return client.createOrUpdateAsync(this.groupId, this.createOrUpdateParameter, this.ccacheControl)
            .map(new Func1<ManagementGroupInner, ManagementGroupInner>() {
               @Override
               public ManagementGroupInner call(ManagementGroupInner resource) {
                   resetCreateUpdateParameters();
                   return resource;
               }
            })
            .map(innerToFluentMap(this));
    }

    @Override
    public Observable<ManagementGroup> updateResourceAsync() {
        ManagementGroupsInner client = this.manager().inner().managementGroups();
        return client.updateAsync(this.groupId, this.createOrUpdateParameter, this.ucacheControl)
            .map(new Func1<ManagementGroupInner, ManagementGroupInner>() {
               @Override
               public ManagementGroupInner call(ManagementGroupInner resource) {
                   resetCreateUpdateParameters();
                   return resource;
               }
            })
            .map(innerToFluentMap(this));
    }

    @Override
    protected Observable<ManagementGroupInner> getInnerAsync() {
        ManagementGroupsInner client = this.manager().inner().managementGroups();
        return client.getAsync(this.groupId);
    }

    @Override
    public boolean isInCreateMode() {
        return this.inner().id() == null;
    }

    private void resetCreateUpdateParameters() {
        this.createOrUpdateParameter = new CreateManagementGroupRequest();
    }

    @Override
    public List<ManagementGroupChildInfo> children() {
        return this.inner().children();
    }

    @Override
    public ManagementGroupDetails details() {
        return this.inner().details();
    }

    @Override
    public String displayName() {
        return this.inner().displayName();
    }

    @Override
    public String id() {
        return this.inner().id();
    }

    @Override
    public String name() {
        return this.inner().name();
    }

    @Override
    public String tenantId() {
        return this.inner().tenantId();
    }

    @Override
    public String type() {
        return this.inner().type();
    }

    @Override
    public ManagementGroupImpl withCacheControl(String cacheControl) {
        if (isInCreateMode()) {
            this.ccacheControl = cacheControl;
        } else {
            this.ucacheControl = cacheControl;
        }
        return this;
    }

    @Override
    public ManagementGroupImpl withDisplayName(String displayName) {
        this.createOrUpdateParameter.withDisplayName(displayName);
        return this;
    }

    @Override
    public ManagementGroupImpl withParentId(String parentId) {
        this.createOrUpdateParameter.withParentId(parentId);
        return this;
    }

}
