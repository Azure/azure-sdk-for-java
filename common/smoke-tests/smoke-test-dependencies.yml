parameters:
- name: OS
  type: string
- name: Pool
  type: string
- name: OSVmImage
  type: string

jobs:
  - template: ./smoke-test-job.yml
    parameters:
      OS: ${{ parameters.OS }}
      Pool: ${{ parameters.Pool }}
      OSVmImage: ${{ parameters.OSVmImage }}
      TestTask:
        task: AzurePowerShell@5
        displayName: 'Run Smoke Test Samples'
        inputs:
          azureSubscription: azure-sdk-tests-public
          azurePowerShellVersion: LatestVersion
          pwsh: true
          ScriptType: InlineScript
          Inline: |
            mvn --% -f $(PomFile) $(DefaultOptions) -Dexec.mainClass=com.azure.smoketest.App exec:java
            exit $LASTEXITCODE
        env:
          # Enable samples tests that use DefaultAzureCredential to load the federated pipeline credential
          AZURE_POD_IDENTITY_AUTHORITY_HOST: 'https://FakeAuthorityHost'
          AZURE_LOG_LEVEL: 2

      Matrix:
        Java_${{ parameters.OS }}_(AzureCloud):
          JavaTestVersion: $(LatestNonLtsJavaVersion)
          PomFile: common/smoke-tests/pom.xml
          ServiceDirectory: '$(Build.SourcesDirectory)/common/smoke-tests/'
        JavaLTS_${{ parameters.OS }}_(AzureCloud):
          JavaTestVersion: $(JavaTestVersion)
          PomFile: common/smoke-tests/pom.xml
          ServiceDirectory: '$(Build.SourcesDirectory)/common/smoke-tests/'
