// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) AutoRest Code Generator.

package com.azure.resourcemanager.policyinsights.generated;

import com.azure.core.credential.AccessToken;
import com.azure.core.http.HttpClient;
import com.azure.core.management.profile.AzureProfile;
import com.azure.core.models.AzureCloud;
import com.azure.core.test.http.MockHttpResponse;
import com.azure.resourcemanager.policyinsights.PolicyInsightsManager;
import com.azure.resourcemanager.policyinsights.models.ComponentPolicyStatesQueryResults;
import com.azure.resourcemanager.policyinsights.models.ComponentPolicyStatesResource;
import java.nio.charset.StandardCharsets;
import java.time.OffsetDateTime;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import reactor.core.publisher.Mono;

public final class ComponentPolicyStatesListQueryResultsForSubscriptionLevelPolicyAssignmentWithResponseMockTests {
    @Test
    public void testListQueryResultsForSubscriptionLevelPolicyAssignmentWithResponse() throws Exception {
        String responseStr
            = "{\"@odata.context\":\"brouszxac\",\"@odata.count\":388894888,\"value\":[{\"@odata.id\":\"goojjfuk\",\"@odata.context\":\"bc\",\"timestamp\":\"2021-07-04T18:04:10Z\",\"componentId\":\"gbtzvxxvsbcu\",\"componentType\":\"krfnkcni\",\"componentName\":\"swxmfurqm\",\"resourceId\":\"wwp\",\"policyAssignmentId\":\"um\",\"policyDefinitionId\":\"ahbqsvnkxm\",\"subscriptionId\":\"zuae\",\"resourceType\":\"lhxgcqm\",\"resourceLocation\":\"hkvxz\",\"resourceGroup\":\"i\",\"policyAssignmentName\":\"qyftgpqoswgfqvjm\",\"policyAssignmentOwner\":\"pakbqyhlsor\",\"policyAssignmentParameters\":\"b\",\"policyAssignmentScope\":\"qagkncjmybn\",\"policyDefinitionName\":\"vztnjawrhulemm\",\"policyDefinitionAction\":\"bwppxir\",\"policyDefinitionCategory\":\"kitzm\",\"policySetDefinitionId\":\"itaxju\",\"policySetDefinitionName\":\"tjlxsgcemegdzdvy\",\"policySetDefinitionOwner\":\"u\",\"policySetDefinitionCategory\":\"f\",\"policySetDefinitionParameters\":\"zufldifnivlutg\",\"policyDefinitionReferenceId\":\"aacxauhvc\",\"complianceState\":\"xhklsqxt\",\"policyEvaluationDetails\":{\"evaluatedExpressions\":[{}],\"reason\":\"ktsrjyxxoxwfzbkv\"},\"policyDefinitionGroupNames\":[\"xfxp\"],\"policyDefinitionVersion\":\"owbebsnbwut\",\"policySetDefinitionVersion\":\"uwmsu\",\"policyAssignmentVersion\":\"stih\",\"ogtder\":\"dataafjajvkyxmmjcz\",\"xhhlbmyphf\":\"dataennmkvaeuwqd\",\"sf\":\"datanrpdhewoky\"},{\"@odata.id\":\"fsywbihq\",\"@odata.context\":\"odjfyxbvkvwzd\",\"timestamp\":\"2021-02-19T20:17:41Z\",\"componentId\":\"qwcrugyo\",\"componentType\":\"za\",\"componentName\":\"jdvvlrhocr\",\"resourceId\":\"vxundqzbvbps\",\"policyAssignmentId\":\"qhxtozfgdkwbkur\",\"policyDefinitionId\":\"piigf\",\"subscriptionId\":\"keutuipjclzjwaq\",\"resourceType\":\"qydewuwxyllz\",\"resourceLocation\":\"evt\",\"resourceGroup\":\"wczochw\",\"policyAssignmentName\":\"k\",\"policyAssignmentOwner\":\"ynfpkyvnhiysdho\",\"policyAssignmentParameters\":\"slhraqkiwlwkff\",\"policyAssignmentScope\":\"qwmwqoguflteat\",\"policyDefinitionName\":\"gefzj\",\"policyDefinitionAction\":\"jtqbgysi\",\"policyDefinitionCategory\":\"hnvxwtd\",\"policySetDefinitionId\":\"cbjdbtqy\",\"policySetDefinitionName\":\"xu\",\"policySetDefinitionOwner\":\"aujqgbbjv\",\"policySetDefinitionCategory\":\"oawh\",\"policySetDefinitionParameters\":\"smbcsloygsab\",\"policyDefinitionReferenceId\":\"d\",\"complianceState\":\"ronsdunr\",\"policyEvaluationDetails\":{\"evaluatedExpressions\":[{},{},{}],\"reason\":\"atqhgzu\"},\"policyDefinitionGroupNames\":[\"rvfdbq\",\"kgqjbvitptpvsf\"],\"policyDefinitionVersion\":\"vdhpiwrmuwkgjwb\",\"policySetDefinitionVersion\":\"dwfbwxy\",\"policyAssignmentVersion\":\"qtmg\",\"wymzskwqk\":\"datadrmegajrzc\",\"seiphgliup\":\"datag\",\"xsqcom\":\"datascoobkjlc\"}]}";

        HttpClient httpClient
            = response -> Mono.just(new MockHttpResponse(response, 200, responseStr.getBytes(StandardCharsets.UTF_8)));
        PolicyInsightsManager manager = PolicyInsightsManager.configure()
            .withHttpClient(httpClient)
            .authenticate(tokenRequestContext -> Mono.just(new AccessToken("this_is_a_token", OffsetDateTime.MAX)),
                new AzureProfile("", "", AzureCloud.AZURE_PUBLIC_CLOUD));

        ComponentPolicyStatesQueryResults response = manager.componentPolicyStates()
            .listQueryResultsForSubscriptionLevelPolicyAssignmentWithResponse("vvm", "bkxjar",
                ComponentPolicyStatesResource.LATEST, 1091449115, "dddwokqxailxq", "dyqjvzvcgrdspzes",
                OffsetDateTime.parse("2021-06-03T21:27:33Z"), OffsetDateTime.parse("2021-01-09T19:26:24Z"), "q", "uhvz",
                com.azure.core.util.Context.NONE)
            .getValue();

        Assertions.assertEquals("ktsrjyxxoxwfzbkv", response.value().get(0).policyEvaluationDetails().reason());
    }
}
