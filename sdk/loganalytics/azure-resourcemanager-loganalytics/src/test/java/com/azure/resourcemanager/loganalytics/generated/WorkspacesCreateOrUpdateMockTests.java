// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) AutoRest Code Generator.

package com.azure.resourcemanager.loganalytics.generated;

import com.azure.core.credential.AccessToken;
import com.azure.core.http.HttpClient;
import com.azure.core.management.profile.AzureProfile;
import com.azure.core.management.serializer.SerializerFactory;
import com.azure.core.models.AzureCloud;
import com.azure.core.test.http.MockHttpResponse;
import com.azure.core.util.serializer.SerializerEncoding;
import com.azure.resourcemanager.loganalytics.LogAnalyticsManager;
import com.azure.resourcemanager.loganalytics.models.Identity;
import com.azure.resourcemanager.loganalytics.models.IdentityType;
import com.azure.resourcemanager.loganalytics.models.PublicNetworkAccessType;
import com.azure.resourcemanager.loganalytics.models.UserIdentityProperties;
import com.azure.resourcemanager.loganalytics.models.Workspace;
import com.azure.resourcemanager.loganalytics.models.WorkspaceCapping;
import com.azure.resourcemanager.loganalytics.models.WorkspaceFailoverProperties;
import com.azure.resourcemanager.loganalytics.models.WorkspaceFeatures;
import com.azure.resourcemanager.loganalytics.models.WorkspaceReplicationProperties;
import com.azure.resourcemanager.loganalytics.models.WorkspaceSku;
import com.azure.resourcemanager.loganalytics.models.WorkspaceSkuNameEnum;
import java.nio.charset.StandardCharsets;
import java.time.OffsetDateTime;
import java.util.HashMap;
import java.util.Map;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import reactor.core.publisher.Mono;

public final class WorkspacesCreateOrUpdateMockTests {
    @Test
    public void testCreateOrUpdate() throws Exception {
        String responseStr
            = "{\"properties\":{\"provisioningState\":\"Succeeded\",\"customerId\":\"edenrexkxbhxv\",\"sku\":{\"name\":\"Standard\",\"capacityReservationLevel\":1049789640,\"lastSkuUpdate\":\"2021-02-13T23:06:36Z\"},\"retentionInDays\":1169492818,\"workspaceCapping\":{\"dailyQuotaGb\":33.579421975520674,\"quotaNextResetTime\":\"znfaj\",\"dataIngestionStatus\":\"ForceOn\"},\"createdDate\":\"2021-06-14T13:50:50Z\",\"modifiedDate\":\"2021-06-29T16:28:10Z\",\"publicNetworkAccessForIngestion\":\"SecuredByPerimeter\",\"publicNetworkAccessForQuery\":\"SecuredByPerimeter\",\"forceCmkForQuery\":false,\"privateLinkScopedResources\":[{\"resourceId\":\"rl\",\"scopeId\":\"zji\"},{\"resourceId\":\"qfhefkwabsol\",\"scopeId\":\"nqqlmgnl\"},{\"resourceId\":\"sjxtel\",\"scopeId\":\"hvuqbo\"},{\"resourceId\":\"o\",\"scopeId\":\"qocarkuzlbc\"}],\"features\":{\"enableDataExport\":false,\"immediatePurgeDataOn30Days\":false,\"enableLogAccessUsingOnlyResourcePermissions\":true,\"clusterResourceId\":\"qytl\",\"disableLocalAuth\":false,\"unifiedSentinelBillingOnly\":false,\"associations\":[\"ckze\",\"nxakckyw\"],\"hfaogzv\":\"datagaabjkdtf\"},\"defaultDataCollectionRuleResourceId\":\"wrsiwdyjqurykc\",\"replication\":{\"location\":\"ueekcsue\",\"enabled\":false,\"provisioningState\":\"Canceled\",\"createdDate\":\"2021-03-11T17:26:18Z\",\"lastModifiedDate\":\"2021-07-31T15:46:45Z\"},\"failover\":{\"state\":\"Deactivating\",\"lastModifiedDate\":\"2021-04-29T13:14:35Z\"}},\"identity\":{\"principalId\":\"d\",\"tenantId\":\"mhmpty\",\"type\":\"UserAssigned\",\"userAssignedIdentities\":{\"fnqt\":{\"principalId\":\"bnrqq\",\"clientId\":\"ztpb\"}}},\"etag\":\"omals\",\"location\":\"bnfddep\",\"tags\":{\"f\":\"qjn\",\"vmywhsbrcarycsjj\":\"ygleexa\",\"dmkrrb\":\"yvoaqajuvehzp\",\"ubefgybpmfbfunu\":\"mpfu\"},\"id\":\"mpzkrvfyifkd\",\"name\":\"chlzvfi\",\"type\":\"tnkjjwgcwnphb\"}";

        HttpClient httpClient
            = response -> Mono.just(new MockHttpResponse(response, 200, responseStr.getBytes(StandardCharsets.UTF_8)));
        LogAnalyticsManager manager = LogAnalyticsManager.configure()
            .withHttpClient(httpClient)
            .authenticate(tokenRequestContext -> Mono.just(new AccessToken("this_is_a_token", OffsetDateTime.MAX)),
                new AzureProfile("", "", AzureCloud.AZURE_PUBLIC_CLOUD));

        Workspace response = manager.workspaces()
            .define("gv")
            .withRegion("oyfpuq")
            .withExistingResourceGroup("yznclkfkee")
            .withTags(mapOf("wvpsoz", "ezxlhdjzqdca", "pnx", "iihjriybmrzo"))
            .withIdentity(new Identity().withType(IdentityType.USER_ASSIGNED)
                .withUserAssignedIdentities(mapOf("xomeikjclwzacn", new UserIdentityProperties())))
            .withEtag("fsuqtaazyqbxy")
            .withSku(new WorkspaceSku().withName(WorkspaceSkuNameEnum.FREE).withCapacityReservationLevel(965244387))
            .withRetentionInDays(1510649527)
            .withWorkspaceCapping(new WorkspaceCapping().withDailyQuotaGb(15.022557422512794D))
            .withPublicNetworkAccessForIngestion(PublicNetworkAccessType.ENABLED)
            .withPublicNetworkAccessForQuery(PublicNetworkAccessType.SECURED_BY_PERIMETER)
            .withForceCmkForQuery(true)
            .withFeatures(new WorkspaceFeatures().withEnableDataExport(true)
                .withImmediatePurgeDataOn30Days(false)
                .withEnableLogAccessUsingOnlyResourcePermissions(true)
                .withClusterResourceId("llqxbdmvrscm")
                .withDisableLocalAuth(false)
                .withAdditionalProperties(mapOf("associations",
                    SerializerFactory.createDefaultManagementSerializerAdapter()
                        .deserialize("[\"nyeofltfnnxrk\",\"dj\",\"ynnfmuiii\",\"ipfohykfkx\"]", Object.class,
                            SerializerEncoding.JSON),
                    "ewoi", "databrwjiutgnjizb", "uifr", "datad", "pezkis", "datavka", "unifiedSentinelBillingOnly",
                    true, "juyrsrziuctixg", "datamrvz")))
            .withDefaultDataCollectionRuleResourceId("jm")
            .withReplication(new WorkspaceReplicationProperties().withLocation("syparybjufp").withEnabled(true))
            .withFailover(new WorkspaceFailoverProperties())
            .create();

        Assertions.assertEquals("bnfddep", response.location());
        Assertions.assertEquals("qjn", response.tags().get("f"));
        Assertions.assertEquals(IdentityType.USER_ASSIGNED, response.identity().type());
        Assertions.assertEquals("omals", response.etag());
        Assertions.assertEquals(WorkspaceSkuNameEnum.STANDARD, response.sku().name());
        Assertions.assertEquals(1049789640, response.sku().capacityReservationLevel());
        Assertions.assertEquals(1169492818, response.retentionInDays());
        Assertions.assertEquals(33.579421975520674D, response.workspaceCapping().dailyQuotaGb());
        Assertions.assertEquals(PublicNetworkAccessType.SECURED_BY_PERIMETER,
            response.publicNetworkAccessForIngestion());
        Assertions.assertEquals(PublicNetworkAccessType.SECURED_BY_PERIMETER, response.publicNetworkAccessForQuery());
        Assertions.assertFalse(response.forceCmkForQuery());
        Assertions.assertFalse(response.features().enableDataExport());
        Assertions.assertFalse(response.features().immediatePurgeDataOn30Days());
        Assertions.assertTrue(response.features().enableLogAccessUsingOnlyResourcePermissions());
        Assertions.assertEquals("qytl", response.features().clusterResourceId());
        Assertions.assertFalse(response.features().disableLocalAuth());
        Assertions.assertEquals("wrsiwdyjqurykc", response.defaultDataCollectionRuleResourceId());
        Assertions.assertEquals("ueekcsue", response.replication().location());
        Assertions.assertFalse(response.replication().enabled());
    }

    // Use "Map.of" if available
    @SuppressWarnings("unchecked")
    private static <T> Map<String, T> mapOf(Object... inputs) {
        Map<String, T> map = new HashMap<>();
        for (int i = 0; i < inputs.length; i += 2) {
            String key = (String) inputs[i];
            T value = (T) inputs[i + 1];
            map.put(key, value);
        }
        return map;
    }
}
