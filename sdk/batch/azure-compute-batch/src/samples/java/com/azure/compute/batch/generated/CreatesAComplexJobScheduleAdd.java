// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.azure.compute.batch.generated;

import com.azure.compute.batch.BatchClient;
import com.azure.compute.batch.BatchClientBuilder;
import com.azure.compute.batch.models.AutoUserScope;
import com.azure.compute.batch.models.AutoUserSpecification;
import com.azure.compute.batch.models.BatchAutoPoolSpecification;
import com.azure.compute.batch.models.BatchCertificateReference;
import com.azure.compute.batch.models.BatchCertificateStoreLocation;
import com.azure.compute.batch.models.BatchCertificateVisibility;
import com.azure.compute.batch.models.BatchJobConstraints;
import com.azure.compute.batch.models.BatchJobManagerTask;
import com.azure.compute.batch.models.BatchJobScheduleConfiguration;
import com.azure.compute.batch.models.BatchJobScheduleCreateContent;
import com.azure.compute.batch.models.BatchJobSpecification;
import com.azure.compute.batch.models.BatchNodeCommunicationMode;
import com.azure.compute.batch.models.BatchNodeFillType;
import com.azure.compute.batch.models.BatchNodePlacementConfiguration;
import com.azure.compute.batch.models.BatchNodePlacementPolicyType;
import com.azure.compute.batch.models.BatchPoolInfo;
import com.azure.compute.batch.models.BatchPoolLifetimeOption;
import com.azure.compute.batch.models.BatchPoolSpecification;
import com.azure.compute.batch.models.BatchStartTask;
import com.azure.compute.batch.models.BatchTaskConstraints;
import com.azure.compute.batch.models.BatchTaskSchedulingPolicy;
import com.azure.compute.batch.models.ElevationLevel;
import com.azure.compute.batch.models.EnvironmentSetting;
import com.azure.compute.batch.models.ImageReference;
import com.azure.compute.batch.models.MetadataItem;
import com.azure.compute.batch.models.ResourceFile;
import com.azure.compute.batch.models.UserIdentity;
import com.azure.compute.batch.models.VirtualMachineConfiguration;
import com.azure.compute.batch.models.WindowsConfiguration;
import com.azure.core.util.Configuration;
import com.azure.identity.DefaultAzureCredentialBuilder;
import java.time.Duration;
import java.time.OffsetDateTime;
import java.util.Arrays;

public class CreatesAComplexJobScheduleAdd {
    public static void main(String[] args) {
        BatchClient batchClient = new BatchClientBuilder().credential(new DefaultAzureCredentialBuilder().build())
            .endpoint(Configuration.getGlobalConfiguration().get("ENDPOINT"))
            .buildClient();
        // BEGIN:com.azure.compute.batch.generated.createjobschedule.createsacomplexjobscheduleadd
        batchClient
            .createJobSchedule(
                new BatchJobScheduleCreateContent("jobScheduleId",
                    new BatchJobScheduleConfiguration()
                        .setDoNotRunUntil(OffsetDateTime.parse("2014-09-10T02:30:00.000Z"))
                        .setDoNotRunAfter(OffsetDateTime.parse("2014-09-10T06:30:00.000Z"))
                        .setStartWindow(Duration.parse("PT1M"))
                        .setRecurrenceInterval(Duration.parse("PT5M")),
                    new BatchJobSpecification(
                        new BatchPoolInfo()
                            .setAutoPoolSpecification(
                                new BatchAutoPoolSpecification(BatchPoolLifetimeOption.JOB_SCHEDULE)
                                    .setAutoPoolIdPrefix("mypool")
                                    .setPool(
                                        new BatchPoolSpecification("STANDARD_D2S_V3")
                                            .setVirtualMachineConfiguration(new VirtualMachineConfiguration(
                                                new ImageReference().setPublisher("MicrosoftWindowsServer")
                                                    .setOffer("WindowsServer")
                                                    .setSku("2016-datacenter-smalldisk")
                                                    .setVersion("latest"),
                                                "batch.node.windows amd64")
                                                    .setWindowsConfiguration(new WindowsConfiguration()
                                                        .setEnableAutomaticUpdates(false))
                                                    .setNodePlacementConfiguration(new BatchNodePlacementConfiguration()
                                                        .setPolicy(BatchNodePlacementPolicyType.ZONAL)))
                                            .setTaskSlotsPerNode(2)
                                            .setTaskSchedulingPolicy(
                                                new BatchTaskSchedulingPolicy(BatchNodeFillType.SPREAD))
                                            .setResizeTimeout(Duration.parse("PT15M"))
                                            .setTargetDedicatedNodes(3)
                                            .setTargetLowPriorityNodes(0)
                                            .setEnableAutoScale(false)
                                            .setEnableInterNodeCommunication(true)
                                            .setStartTask(new BatchStartTask("myprogram2.exe")
                                                .setResourceFiles(Arrays.asList(new ResourceFile().setHttpUrl(
                                                    "http://mystorage1.blob.core.windows.net/scripts/myprogram2.exe?sas")
                                                    .setFilePath("myprogram2.exe")))
                                                .setEnvironmentSettings(Arrays
                                                    .asList(new EnvironmentSetting("myvariable").setValue("myvalue")))
                                                .setUserIdentity(new UserIdentity().setAutoUser(
                                                    new AutoUserSpecification().setScope(AutoUserScope.TASK)
                                                        .setElevationLevel(ElevationLevel.ADMIN)))
                                                .setMaxTaskRetryCount(2)
                                                .setWaitForSuccess(true))
                                            .setCertificateReferences(Arrays.asList(new BatchCertificateReference(
                                                "0123456789abcdef0123456789abcdef01234567", "sha1")
                                                    .setStoreLocation(BatchCertificateStoreLocation.LOCAL_MACHINE)
                                                    .setStoreName("Root")
                                                    .setVisibility(Arrays.asList(BatchCertificateVisibility.TASK))))
                                            .setMetadata(Arrays.asList(new MetadataItem("myproperty", "myvalue")))
                                            .setTargetNodeCommunicationMode(BatchNodeCommunicationMode.DEFAULT))))
                                                .setPriority(100)
                                                .setConstraints(new BatchJobConstraints()
                                                    .setMaxWallClockTime(Duration.parse("PT1H"))
                                                    .setMaxTaskRetryCount(-1))
                                                .setJobManagerTask(new BatchJobManagerTask("mytask1", "myprogram.exe")
                                                    .setResourceFiles(Arrays.asList(new ResourceFile().setHttpUrl(
                                                        "http://mystorage1.blob.core.windows.net/scripts/myprogram.exe?sas")
                                                        .setFilePath("myprogram.exe"),
                                                        new ResourceFile().setHttpUrl(
                                                            "http://mystorage1.blob.core.windows.net/scripts/test.txt?sas")
                                                            .setFilePath("test.txt")))
                                                    .setEnvironmentSettings(Arrays.asList(
                                                        new EnvironmentSetting("myvariable").setValue("myvalue")))
                                                    .setConstraints(new BatchTaskConstraints()
                                                        .setMaxWallClockTime(Duration.parse("PT1H"))
                                                        .setRetentionTime(Duration.parse("PT1H"))
                                                        .setMaxTaskRetryCount(0))
                                                    .setRequiredSlots(2)
                                                    .setKillJobOnCompletion(true)
                                                    .setUserIdentity(new UserIdentity().setAutoUser(
                                                        new AutoUserSpecification().setScope(AutoUserScope.TASK)
                                                            .setElevationLevel(ElevationLevel.NON_ADMIN)))
                                                    .setRunExclusive(true))).setMetadata(
                                                        Arrays.asList(new MetadataItem("myproperty", "myvalue"))),
                null);
        // END:com.azure.compute.batch.generated.createjobschedule.createsacomplexjobscheduleadd
    }
}
