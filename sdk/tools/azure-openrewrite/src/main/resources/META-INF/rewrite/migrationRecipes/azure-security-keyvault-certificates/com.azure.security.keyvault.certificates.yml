type: specs.openrewrite.org/v1beta/recipe
name: com.azure.openrewrite.recipe.azure.security.keyvault.certificates
displayName: Migrate from azure.security.keyvault.certificates to next generation stack
description: This recipe migrates the azure.security.keyvault.certificates package to the next generation stack.
recipeList:

  # --------------------------------------------------------------------
  # CertificateClientBuilder
  # --------------------------------------------------------------------

  - org.openrewrite.java.ChangeMethodName:
      methodPattern: com.azure.security.keyvault.certificates.CertificateClientBuilder vaultUrl(..)
      newMethodName: endpoint

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.azure.security.keyvault.certificates.CertificateClientBuilder
      newFullyQualifiedTypeName: com.azure.v2.security.keyvault.certificates.CertificateClientBuilder

  # --------------------------------------------------------------------
  # CertificateClient
  # --------------------------------------------------------------------

  - org.openrewrite.java.ChangeMethodName:
      methodPattern: com.azure.security.keyvault.certificates.CertificateClient getCertificateVersion(..)
      newMethodName: getCertificate

  # Handle purgeDeletedCertificate variants:
  # - remove second arg (Context/RequestContext) if present
  # - rename purgeDeletedCertificateWithResponse -> purgeDeletedCertificate

  - org.openrewrite.java.DeleteMethodArgument:
      methodPattern: com.azure.security.keyvault.certificates.CertificateClient purgeDeletedCertificateWithResponse(..)
      argumentIndex: 1

  - org.openrewrite.java.ChangeMethodName:
      methodPattern: com.azure.security.keyvault.certificates.CertificateClient purgeDeletedCertificateWithResponse(..)
      newMethodName: purgeDeletedCertificate

  - org.openrewrite.java.DeleteMethodArgument:
      methodPattern: com.azure.security.keyvault.certificates.CertificateClient purgeDeletedCertificate(..)
      argumentIndex: 1

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.azure.security.keyvault.certificates.CertificateClient
      newFullyQualifiedTypeName: com.azure.v2.security.keyvault.certificates.CertificateClient
