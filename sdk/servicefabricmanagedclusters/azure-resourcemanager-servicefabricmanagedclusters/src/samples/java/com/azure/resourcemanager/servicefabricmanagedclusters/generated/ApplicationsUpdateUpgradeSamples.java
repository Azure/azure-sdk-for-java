// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.azure.resourcemanager.servicefabricmanagedclusters.generated;

import com.azure.resourcemanager.servicefabricmanagedclusters.models.RuntimeApplicationHealthPolicy;
import com.azure.resourcemanager.servicefabricmanagedclusters.models.RuntimeFailureAction;
import com.azure.resourcemanager.servicefabricmanagedclusters.models.RuntimeRollingUpgradeMode;
import com.azure.resourcemanager.servicefabricmanagedclusters.models.RuntimeRollingUpgradeUpdateMonitoringPolicy;
import com.azure.resourcemanager.servicefabricmanagedclusters.models.RuntimeServiceTypeHealthPolicy;
import com.azure.resourcemanager.servicefabricmanagedclusters.models.RuntimeUpdateApplicationUpgradeParameters;
import com.azure.resourcemanager.servicefabricmanagedclusters.models.RuntimeUpgradeKind;
import java.util.HashMap;
import java.util.Map;

/**
 * Samples for Applications UpdateUpgrade.
 */
public final class ApplicationsUpdateUpgradeSamples {
    /*
     * x-ms-original-file: 2025-10-01-preview/ApplicationActionUpdateUpgrade_example.json
     */
    /**
     * Sample code: Update an application upgrade.
     * 
     * @param manager Entry point to ServiceFabricManagedClustersManager.
     */
    public static void updateAnApplicationUpgrade(
        com.azure.resourcemanager.servicefabricmanagedclusters.ServiceFabricManagedClustersManager manager) {
        manager.applications()
            .updateUpgrade("resRg", "myCluster", "myApp",
                new RuntimeUpdateApplicationUpgradeParameters().withName("fabric:/Voting")
                    .withUpgradeKind(RuntimeUpgradeKind.ROLLING)
                    .withApplicationHealthPolicy(new RuntimeApplicationHealthPolicy().withConsiderWarningAsError(true)
                        .withMaxPercentUnhealthyDeployedApplications(10)
                        .withDefaultServiceTypeHealthPolicy(
                            new RuntimeServiceTypeHealthPolicy().withMaxPercentUnhealthyServices(12)
                                .withMaxPercentUnhealthyPartitionsPerService(10)
                                .withMaxPercentUnhealthyReplicasPerPartition(11))
                        .withServiceTypeHealthPolicyMap(mapOf("VotingWeb",
                            new RuntimeServiceTypeHealthPolicy().withMaxPercentUnhealthyServices(15)
                                .withMaxPercentUnhealthyPartitionsPerService(13)
                                .withMaxPercentUnhealthyReplicasPerPartition(14))))
                    .withUpdateDescription(new RuntimeRollingUpgradeUpdateMonitoringPolicy()
                        .withRollingUpgradeMode(RuntimeRollingUpgradeMode.MONITORED)
                        .withForceRestart(true)
                        .withFailureAction(RuntimeFailureAction.MANUAL)
                        .withHealthCheckWaitDurationInMilliseconds("PT0H0M10S")
                        .withHealthCheckStableDurationInMilliseconds("PT1H0M0S")
                        .withHealthCheckRetryTimeoutInMilliseconds("PT0H15M0S")
                        .withUpgradeTimeoutInMilliseconds("PT2H0M0S")
                        .withUpgradeDomainTimeoutInMilliseconds("PT2H0M0S")),
                com.azure.core.util.Context.NONE);
    }

    // Use "Map.of" if available
    @SuppressWarnings("unchecked")
    private static <T> Map<String, T> mapOf(Object... inputs) {
        Map<String, T> map = new HashMap<>();
        for (int i = 0; i < inputs.length; i += 2) {
            String key = (String) inputs[i];
            T value = (T) inputs[i + 1];
            map.put(key, value);
        }
        return map;
    }
}
