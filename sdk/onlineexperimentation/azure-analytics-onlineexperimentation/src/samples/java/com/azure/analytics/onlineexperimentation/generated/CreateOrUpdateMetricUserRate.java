// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.azure.analytics.onlineexperimentation.generated;

import com.azure.analytics.onlineexperimentation.OnlineExperimentationClient;
import com.azure.analytics.onlineexperimentation.OnlineExperimentationClientBuilder;
import com.azure.analytics.onlineexperimentation.models.DesiredDirection;
import com.azure.analytics.onlineexperimentation.models.ExperimentMetric;
import com.azure.analytics.onlineexperimentation.models.LifecycleStage;
import com.azure.analytics.onlineexperimentation.models.ObservedEvent;
import com.azure.analytics.onlineexperimentation.models.UserRateMetricDefinition;
import com.azure.core.http.RequestConditions;
import com.azure.core.util.Configuration;
import com.azure.identity.DefaultAzureCredentialBuilder;
import java.time.OffsetDateTime;
import java.util.Arrays;

public class CreateOrUpdateMetricUserRate {
    public static void main(String[] args) {
        OnlineExperimentationClient onlineExperimentationClient
            = new OnlineExperimentationClientBuilder().credential(new DefaultAzureCredentialBuilder().build())
                .endpoint(Configuration.getGlobalConfiguration().get("ENDPOINT"))
                .buildClient();
        // BEGIN:com.azure.analytics.onlineexperimentation.generated.createorupdatemetric.createorupdatemetricuserrate
        ExperimentMetric response = onlineExperimentationClient.createOrUpdateMetric("rate_subscription_ad",
            new ExperimentMetric().setLifecycle(LifecycleStage.ACTIVE)
                .setDisplayName("Subscription ad conversion rate")
                .setDescription(
                    "The percentage of users who saw an advertisement for a subscription promotion and then later successfully subscribed. This metric is calculated as the number of users who successfully subscribed after seeing the advert divided by the total number of users who saw the advert. Users who saw multiple adverts or subscribed multiple times are counted only once. Users who saw the advert before the analysis period starts are excluded from this metric.")
                .setCategories(Arrays.asList("Monetization"))
                .setDesiredDirection(DesiredDirection.INCREASE)
                .setDefinition(new UserRateMetricDefinition()
                    .setStartEvent(
                        new ObservedEvent().setEventName("AdView").setFilter("Source == 'subscription_promo'"))
                    .setEndEvent(new ObservedEvent().setEventName("Subscribe").setFilter("Status == 'Success'"))),
            new RequestConditions().setIfMatch("vxexdn")
                .setIfNoneMatch("ijchzdh")
                .setIfUnmodifiedSince(OffsetDateTime.parse("2024-08-22T02:02:11Z"))
                .setIfModifiedSince(OffsetDateTime.parse("2024-08-22T02:02:11Z")));
        // END:com.azure.analytics.onlineexperimentation.generated.createorupdatemetric.createorupdatemetricuserrate
    }
}
