extends:
  template: /eng/pipelines/templates/stages/archetype-sdk-tests.yml
  parameters:
    ServiceDirectory: openai
    DisableAzureResourceCreation: true
    UseFederatedAuth: false
    PreSteps:
      - template: ./../../../../../sdk/openai/openai-build.yml
    PreTestRunSteps:
      - script: |
          java -version
          echo "Java version above"
          echo "JAVA_HOME: $JAVA_HOME"
          echo "PATH: $PATH"
          export JAVA_HOME=/usr/lib/jvm/temurin-8-jdk-amd64/jre
          echo "JAVA_HOME: $JAVA_HOME"

          ls /usr/lib/jvm
#
#          if ! java -version 2>&1 | grep -q "1.8"; then
#            echo "Java 8 is not installed. Installing Java 8..."
#            sudo apt-get update
#            sudo apt-get install -y openjdk-8-jdk
#          fi
#          echo "Setting JAVA_HOME to Java 8"
#          export JAVA_HOME=/path/to/java8
#          export PATH=$JAVA_HOME/bin:$PATH
        displayName: "Set JAVA_HOME to Java 8"
#      - task: Maven@4
#          displayName: 'Run tests'
#          inputs:
#            mavenPomFile: pom.xml
#            javaHomeOption: 'JDKVersion'
#            jdkVersionOption: '8'
#            jdkArchitectureOption: 'x64'
#            publishJUnitResults: false
#            goals: 'test'
    Artifacts:
      - name: azure-ai-openai
        groupId: com.azure
        safeName: azureaiopenai
    EnvVars:
      AZURE_OPENAI_ENDPOINT: $(AOAI-ENDPOINT-SWEDENCENTRAL)
      AZURE_OPENAI_KEY: $(AOAI-API-KEY-SWEDENCENTRAL)
      NON_AZURE_OPENAI_KEY: $(OPENAI-API-KEY)
      AZURE_TEST_RUN_LIVE: 'true'
      API_VERSION_GA: '2024-06-01'
    MatrixFilters:
      - JavaTestVersion=^(?!1.8).*
