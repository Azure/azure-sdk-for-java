// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) AutoRest Code Generator.

package com.azure.resourcemanager.security.generated;

import com.azure.core.credential.AccessToken;
import com.azure.core.http.HttpClient;
import com.azure.core.management.AzureEnvironment;
import com.azure.core.management.profile.AzureProfile;
import com.azure.core.test.http.MockHttpResponse;
import com.azure.resourcemanager.security.SecurityManager;
import com.azure.resourcemanager.security.models.JitNetworkAccessPolicy;
import com.azure.resourcemanager.security.models.Protocol;
import java.nio.charset.StandardCharsets;
import java.time.OffsetDateTime;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import reactor.core.publisher.Mono;

public final class JitNetworkAccessPoliciesGetWithResponseMockTests {
    @Test
    public void testGetWithResponse() throws Exception {
        String responseStr
            = "{\"properties\":{\"virtualMachines\":[{\"id\":\"bmwrvpvdrohul\",\"ports\":[{\"number\":1644824146,\"protocol\":\"UDP\",\"maxRequestAccessDuration\":\"b\"},{\"number\":1196339523,\"protocol\":\"*\",\"maxRequestAccessDuration\":\"juai\"},{\"number\":435844830,\"protocol\":\"TCP\",\"maxRequestAccessDuration\":\"nirnygtixk\"},{\"number\":642038813,\"protocol\":\"*\",\"maxRequestAccessDuration\":\"bmk\"}],\"publicIpAddress\":\"vdlor\"},{\"id\":\"zpqditu\",\"ports\":[{\"number\":1219701812,\"protocol\":\"*\",\"maxRequestAccessDuration\":\"fcieile\"},{\"number\":281766793,\"protocol\":\"UDP\",\"maxRequestAccessDuration\":\"tkehldopjsxvbb\"},{\"number\":1604405525,\"protocol\":\"*\",\"maxRequestAccessDuration\":\"i\"}],\"publicIpAddress\":\"mibnm\"},{\"id\":\"pid\",\"ports\":[{\"number\":384937339,\"protocol\":\"TCP\",\"maxRequestAccessDuration\":\"gzwmzhc\"},{\"number\":1471760316,\"protocol\":\"*\",\"maxRequestAccessDuration\":\"oqavstyzavkyjjl\"},{\"number\":1106436361,\"protocol\":\"*\",\"maxRequestAccessDuration\":\"mbjqbng\"},{\"number\":886953679,\"protocol\":\"TCP\",\"maxRequestAccessDuration\":\"vvdkoptythc\"}],\"publicIpAddress\":\"xoipmqnerwh\"}],\"requests\":[{\"virtualMachines\":[{\"id\":\"dsssfzsgzguspej\",\"ports\":[]},{\"id\":\"meqgxhwispsogdbl\",\"ports\":[]},{\"id\":\"jsbaqxaxtuxir\",\"ports\":[]}],\"startTimeUtc\":\"2021-07-22T03:37:01Z\",\"requestor\":\"biichlygkvuixw\",\"justification\":\"kr\"},{\"virtualMachines\":[{\"id\":\"zdxywabkitnipapt\",\"ports\":[]}],\"startTimeUtc\":\"2021-04-29T01:08:44Z\",\"requestor\":\"naqyjukkaj\",\"justification\":\"ewltono\"},{\"virtualMachines\":[{\"id\":\"femiwfhhawbabhz\",\"ports\":[]},{\"id\":\"fcdi\",\"ports\":[]}],\"startTimeUtc\":\"2021-06-19T20:20:56Z\",\"requestor\":\"nxydgzfoiqzsus\",\"justification\":\"y\"},{\"virtualMachines\":[{\"id\":\"slqeronz\",\"ports\":[]}],\"startTimeUtc\":\"2021-11-27T23:58:02Z\",\"requestor\":\"fkxfmuwdbv\",\"justification\":\"qavouymkde\"}],\"provisioningState\":\"xlvzpfdka\"},\"kind\":\"biw\",\"location\":\"opqlktt\",\"id\":\"bmrrmtr\",\"name\":\"gjmpd\",\"type\":\"rjzwawpewajccs\"}";

        HttpClient httpClient
            = response -> Mono.just(new MockHttpResponse(response, 200, responseStr.getBytes(StandardCharsets.UTF_8)));
        SecurityManager manager = SecurityManager.configure()
            .withHttpClient(httpClient)
            .authenticate(tokenRequestContext -> Mono.just(new AccessToken("this_is_a_token", OffsetDateTime.MAX)),
                new AzureProfile("", "", AzureEnvironment.AZURE));

        JitNetworkAccessPolicy response = manager.jitNetworkAccessPolicies()
            .getWithResponse("nvtolzj", "fkryxs", "haknklthqwppv", com.azure.core.util.Context.NONE)
            .getValue();

        Assertions.assertEquals("biw", response.kind());
        Assertions.assertEquals("bmwrvpvdrohul", response.virtualMachines().get(0).id());
        Assertions.assertEquals(1644824146, response.virtualMachines().get(0).ports().get(0).number());
        Assertions.assertEquals(Protocol.UDP, response.virtualMachines().get(0).ports().get(0).protocol());
        Assertions.assertEquals("b", response.virtualMachines().get(0).ports().get(0).maxRequestAccessDuration());
        Assertions.assertEquals("vdlor", response.virtualMachines().get(0).publicIpAddress());
        Assertions.assertEquals("dsssfzsgzguspej", response.requests().get(0).virtualMachines().get(0).id());
        Assertions.assertEquals(OffsetDateTime.parse("2021-07-22T03:37:01Z"),
            response.requests().get(0).startTimeUtc());
        Assertions.assertEquals("biichlygkvuixw", response.requests().get(0).requestor());
        Assertions.assertEquals("kr", response.requests().get(0).justification());
    }
}
