// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

import com.azure.autorest.customization.Customization;
import com.azure.autorest.customization.Editor;
import com.azure.autorest.customization.LibraryCustomization;
import org.slf4j.Logger;

/**
 * Contains customizations for Azure Key Vault's Keys code generation.
 */
public class KeysCustomizations extends Customization {
    private static final String ROOT_FILE_PATH = "src/main/java/com/azure/v2/security/keyvault/keys/";

    @Override
    public void customize(LibraryCustomization libraryCustomization, Logger logger) {
        // Remove unnecessary files.
        removeFiles(libraryCustomization.getRawEditor());
        customizeServiceVersion(libraryCustomization.getRawEditor());
        customizeModuleInfo(libraryCustomization.getRawEditor());
    }

    private static void removeFiles(Editor editor) {
        editor.removeFile(ROOT_FILE_PATH + "KeyClient.java");
        editor.removeFile(ROOT_FILE_PATH + "KeyClientBuilder.java");
        editor.removeFile(ROOT_FILE_PATH + "implementation/models/package-info.java");
    }

    private static void customizeServiceVersion(Editor editor) {
        String serviceVersion = editor.getFileContent(ROOT_FILE_PATH + "KeyVaultServiceVersion.java")
            .replace("KeyVaultServiceVersion", "KeyServiceVersion");

        editor.addFile(ROOT_FILE_PATH + "KeyServiceVersion.java", serviceVersion);
        editor.removeFile(ROOT_FILE_PATH + "KeyVaultServiceVersion.java");

        String fileName = ROOT_FILE_PATH + "implementation/KeyClientImpl.java";
        String fileContent = editor.getFileContent(fileName);
        fileContent = fileContent.replace("KeyVaultServiceVersion", "KeyServiceVersion");
        editor.replaceFile(fileName, fileContent);
    }

    private static void customizeModuleInfo(Editor editor) {
        editor.replaceFile("src/main/java/module-info.java", String.join("\n",
            "// Copyright (c) Microsoft Corporation. All rights reserved.",
            "// Licensed under the MIT License.",
            "// Code generated by Microsoft (R) TypeSpec Code Generator.",
            "",
            "module com.azure.v2.security.keyvault.keys {",
            "    requires transitive com.azure.v2.core;",
            "",
            "    exports com.azure.v2.security.keyvault.keys;",
            "    exports com.azure.v2.security.keyvault.keys.models;",
            "}"));
    }
}
