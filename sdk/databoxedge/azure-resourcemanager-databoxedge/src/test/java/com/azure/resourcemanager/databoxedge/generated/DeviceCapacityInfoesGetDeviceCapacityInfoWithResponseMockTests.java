// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.azure.resourcemanager.databoxedge.generated;

import com.azure.core.credential.AccessToken;
import com.azure.core.http.HttpClient;
import com.azure.core.management.profile.AzureProfile;
import com.azure.core.models.AzureCloud;
import com.azure.core.test.http.MockHttpResponse;
import com.azure.resourcemanager.databoxedge.DataBoxEdgeManager;
import com.azure.resourcemanager.databoxedge.models.DeviceCapacityInfo;
import java.nio.charset.StandardCharsets;
import java.time.OffsetDateTime;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import reactor.core.publisher.Mono;

public final class DeviceCapacityInfoesGetDeviceCapacityInfoWithResponseMockTests {
    @Test
    public void testGetDeviceCapacityInfoWithResponse() throws Exception {
        String responseStr
            = "{\"properties\":{\"timeStamp\":\"2021-07-11T09:53:45Z\",\"clusterStorageCapacityInfo\":{\"clusterTotalStorageMb\":12.347370894334986,\"clusterFreeStorageMb\":16.639704594397298},\"clusterComputeCapacityInfo\":{\"fqdn\":\"flnwy\",\"gpuCapacity\":{\"gpuType\":\"xrerlniylylyf\",\"gpuUsedUnitsCount\":1823905170,\"gpuFreeUnitsCount\":856698353,\"gpuReservedForFailoverUnitsCount\":940843916,\"gpuTotalUnitsCount\":1491604791},\"memoryCapacity\":{\"clusterFreeMemoryMb\":7.448081638131965,\"clusterUsedMemoryMb\":96.25715728259036,\"clusterFailoverMemoryMb\":77.93376879045461,\"clusterFragmentationMemoryMb\":90.98900884918515,\"clusterHypervReserveMemoryMb\":24.077750313814228,\"clusterInfraVmMemoryMb\":55.77038235319657,\"clusterTotalMemoryMb\":74.1770468361796,\"clusterNonFailoverVmMb\":38.243065707057745,\"clusterMemoryUsedByVmsMb\":67.50522618380931},\"lastRefreshedTime\":\"2021-10-31T20:37:14Z\",\"totalProvisionedNonHpnCores\":5822463104061015574},\"nodeCapacityInfos\":{\"avsczuejdtxp\":{\"hostName\":\"afeddwwnlza\",\"effectiveAvailableMemoryMbOnHost\":2372646677215374842,\"availableGpuCount\":1657667707,\"vmUsedMemory\":{\"gookrtalvnb\":{},\"gpbemeluclvdjju\":{},\"yrdnqod\":{},\"ahhxhqfaqnvzoqg\":{}},\"gpuType\":\"pem\",\"numaNodesData\":[{},{},{}]},\"hychocokuleh\":{\"hostName\":\"ghwzhomewjjstli\",\"effectiveAvailableMemoryMbOnHost\":1800612963256769496,\"availableGpuCount\":2067829444,\"vmUsedMemory\":{\"ia\":{},\"cz\":{},\"vodrrslblxydkxr\":{}},\"gpuType\":\"vbxiwkgfbqlj\",\"numaNodesData\":[{},{},{},{}]}}},\"id\":\"qlrqffaweyurk\",\"name\":\"hy\",\"type\":\"dxravj\"}";

        HttpClient httpClient
            = response -> Mono.just(new MockHttpResponse(response, 200, responseStr.getBytes(StandardCharsets.UTF_8)));
        DataBoxEdgeManager manager = DataBoxEdgeManager.configure()
            .withHttpClient(httpClient)
            .authenticate(tokenRequestContext -> Mono.just(new AccessToken("this_is_a_token", OffsetDateTime.MAX)),
                new AzureProfile("", "", AzureCloud.AZURE_PUBLIC_CLOUD));

        DeviceCapacityInfo response = manager.deviceCapacityInfoes()
            .getDeviceCapacityInfoWithResponse("sjsz", "bscm", com.azure.core.util.Context.NONE)
            .getValue();

        Assertions.assertEquals(OffsetDateTime.parse("2021-07-11T09:53:45Z"), response.timeStamp());
        Assertions.assertEquals(12.347370894334986D, response.clusterStorageCapacityInfo().clusterTotalStorageMb());
        Assertions.assertEquals(16.639704594397298D, response.clusterStorageCapacityInfo().clusterFreeStorageMb());
        Assertions.assertEquals("flnwy", response.clusterComputeCapacityInfo().fqdn());
        Assertions.assertEquals("xrerlniylylyf", response.clusterComputeCapacityInfo().gpuCapacity().gpuType());
        Assertions.assertEquals(1823905170, response.clusterComputeCapacityInfo().gpuCapacity().gpuUsedUnitsCount());
        Assertions.assertEquals(856698353, response.clusterComputeCapacityInfo().gpuCapacity().gpuFreeUnitsCount());
        Assertions.assertEquals(940843916,
            response.clusterComputeCapacityInfo().gpuCapacity().gpuReservedForFailoverUnitsCount());
        Assertions.assertEquals(1491604791, response.clusterComputeCapacityInfo().gpuCapacity().gpuTotalUnitsCount());
        Assertions.assertEquals(7.448081638131965D,
            response.clusterComputeCapacityInfo().memoryCapacity().clusterFreeMemoryMb());
        Assertions.assertEquals(96.25715728259036D,
            response.clusterComputeCapacityInfo().memoryCapacity().clusterUsedMemoryMb());
        Assertions.assertEquals(77.93376879045461D,
            response.clusterComputeCapacityInfo().memoryCapacity().clusterFailoverMemoryMb());
        Assertions.assertEquals(90.98900884918515D,
            response.clusterComputeCapacityInfo().memoryCapacity().clusterFragmentationMemoryMb());
        Assertions.assertEquals(24.077750313814228D,
            response.clusterComputeCapacityInfo().memoryCapacity().clusterHypervReserveMemoryMb());
        Assertions.assertEquals(55.77038235319657D,
            response.clusterComputeCapacityInfo().memoryCapacity().clusterInfraVmMemoryMb());
        Assertions.assertEquals(74.1770468361796D,
            response.clusterComputeCapacityInfo().memoryCapacity().clusterTotalMemoryMb());
        Assertions.assertEquals(38.243065707057745D,
            response.clusterComputeCapacityInfo().memoryCapacity().clusterNonFailoverVmMb());
        Assertions.assertEquals(67.50522618380931D,
            response.clusterComputeCapacityInfo().memoryCapacity().clusterMemoryUsedByVmsMb());
        Assertions.assertEquals(OffsetDateTime.parse("2021-10-31T20:37:14Z"),
            response.clusterComputeCapacityInfo().lastRefreshedTime());
        Assertions.assertEquals(5822463104061015574L,
            response.clusterComputeCapacityInfo().totalProvisionedNonHpnCores());
        Assertions.assertEquals("afeddwwnlza", response.nodeCapacityInfos().get("avsczuejdtxp").hostName());
        Assertions.assertEquals(2372646677215374842L,
            response.nodeCapacityInfos().get("avsczuejdtxp").effectiveAvailableMemoryMbOnHost());
        Assertions.assertEquals(1657667707, response.nodeCapacityInfos().get("avsczuejdtxp").availableGpuCount());
        Assertions.assertEquals("pem", response.nodeCapacityInfos().get("avsczuejdtxp").gpuType());
    }
}
