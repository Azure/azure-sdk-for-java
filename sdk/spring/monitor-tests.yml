#trigger: none
#pr: none
trigger:
  branches:
    include:
      - main
      - feature/*
      - hotfix/*
      - release/*
  paths:
    include:
      - sdk/spring/ci.monitor.yml
      - sdk/spring/monitor-tests.yml
      - sdk/spring/spring-cloud-azure-starter-monitor/
      - sdk/spring/spring-cloud-azure-starter-monitor-test/
pr:
  branches:
    include:
      - main
      - feature/*
      - hotfix/*
      - release/*
  paths:
    include:
      - sdk/spring/ci.monitor.yml
      - sdk/spring/monitor-tests.yml
      - sdk/spring/spring-cloud-azure-starter-monitor/
      - sdk/spring/spring-cloud-azure-starter-monitor-test/

variables:
  - template: ../../eng/pipelines/templates/variables/globals.yml

stages:
  - stage: "monitor_tests"
    jobs:
      - template: /eng/common/pipelines/templates/jobs/archetype-sdk-tests-generate.yml
        parameters:
          SparseCheckout: true
          JobTemplatePath: ../../../../../sdk/spring/monitor-tests-job.yml
          AdditionalParameters:
            ServiceDirectory: spring
      - template: /eng/common/pipelines/templates/jobs/archetype-sdk-tests-generate.yml
        parameters:
          SparseCheckout: true
          JobTemplatePath: ../../../../../sdk/spring/monitor-tests-job.yml
          AdditionalParameters:
            ServiceDirectory: spring
          MatrixConfigs:
            - Name: monitor_compatibility_tests
              Path: sdk/spring/monitor-matrix.json
              Selection: sparse
              NonSparseParameters:
                - TEST_SPRING_BOOT_VERSION
              GenerateVMJobs: true
          PreGenerationSteps:
#            - script: |
#                python -m pip install termcolor
#              displayName: 'python module install'
            - script: |
                python ./sdk/spring/scripts/monitor_update_monitor_matrix_json.py
              displayName: 'update test version'
