parameters:
- name: Artifacts
  type: object
  default:
  - name: spring-cloud-azure-core
    groupId: com.azure.spring
    safeName: springcloudazurecore
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-service
    groupId: com.azure.spring
    safeName: springcloudazureservice
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-resourcemanager
    groupId: com.azure.spring
    safeName: springcloudazureresourcemanager
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-trace-sleuth
    groupId: com.azure.spring
    safeName: springcloudazuretracesleuth
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-messaging-azure
    groupId: com.azure.spring
    safeName: springmessagingazure
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-messaging-azure-eventhubs
    groupId: com.azure.spring
    safeName: springmessagingazureeventhubs
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-messaging-azure-servicebus
    groupId: com.azure.spring
    safeName: springmessagingazureservicebus
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-messaging-azure-storage-queue
    groupId: com.azure.spring
    safeName: springmessagingazurestoragequeue
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-integration-azure-core
    groupId: com.azure.spring
    safeName: springintegrationazurecore
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-integration-azure-eventhubs
    groupId: com.azure.spring
    safeName: springintegrationazureeventhubs
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-integration-azure-servicebus
    groupId: com.azure.spring
    safeName: springintegrationazureservicebus
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-integration-azure-storage-queue
    groupId: com.azure.spring
    safeName: springintegrationazurestoragequeue
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-autoconfigure
    groupId: com.azure.spring
    safeName: springcloudazureautoconfigure
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-actuator
    groupId: com.azure.spring
    safeName: springcloudazureactuator
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-actuator-autoconfigure
    groupId: com.azure.spring
    safeName: springcloudazureactuatorautoconfigure
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter
    groupId: com.azure.spring
    safeName: springcloudazurestarter
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-actuator
    groupId: com.azure.spring
    safeName: springcloudazurestarteractuator
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-appconfiguration
    groupId: com.azure.spring
    safeName: springcloudazurestarterappconfiguration
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-cosmos
    groupId: com.azure.spring
    safeName: springcloudazurestartercosmos
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-data-cosmos
    groupId: com.azure.spring
    safeName: springcloudazurestarterdatacosmos
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-eventhubs
    groupId: com.azure.spring
    safeName: springcloudazurestartereventhubs
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-keyvault-certificates
    groupId: com.azure.spring
    safeName: springcloudazurestarterkeyvaultcertificates
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-keyvault-secrets
    groupId: com.azure.spring
    safeName: springcloudazurestarterkeyvaultsecrets
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-servicebus
    groupId: com.azure.spring
    safeName: springcloudazurestarterservicebus
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-servicebus-jms
    groupId: com.azure.spring
    safeName: springcloudazurestarterservicebusjms
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-storage-blob
    groupId: com.azure.spring
    safeName: springcloudazurestarterstorageblob
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-storage-file-share
    groupId: com.azure.spring
    safeName: springcloudazurestarterstoragefileshare
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-storage-queue
    groupId: com.azure.spring
    safeName: springcloudazurestarterstoragequeue
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-integration-eventhubs
    groupId: com.azure.spring
    safeName: springcloudazurestarterintegrationeventhubs
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-integration-servicebus
    groupId: com.azure.spring
    safeName: springcloudazurestarterintegrationservicebus
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-integration-storage-queue
    groupId: com.azure.spring
    safeName: springcloudazurestarterintegrationstoragequeue
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-stream-binder-servicebus-core
    groupId: com.azure.spring
    safeName: springcloudazurestreambinderservicebuscore
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-stream-binder-servicebus
    groupId: com.azure.spring
    safeName: springcloudazurestreambinderservicebus
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-stream-binder-eventhubs
    groupId: com.azure.spring
    safeName: springcloudazurestreambindereventhubs
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-stream-binder-eventhubs-core
    groupId: com.azure.spring
    safeName: springcloudazurestreambindereventhubscore
    skipPublishDocMs: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-stream-eventhubs
    groupId: com.azure.spring
    safeName: springcloudazurestarterstreameventhubs
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-stream-servicebus
    groupId: com.azure.spring
    safeName: springcloudazurestarterstreamservicebus
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-starter-storage-queue
    groupId: com.azure.spring
    safeName: springcloudazurestarterstoragequeue
    skipPublishDocMs: true
    skipUpdatePackageJson: true
    skipVerifyChangelog: true
  - name: spring-cloud-azure-stream-binder-test
    groupId: com.azure.spring
    safeName: springcloudazurestreambindertest
    skipPublishDocMs: true
    skipVerifyChangelog: true
- name: TestPipeline
  type: boolean
  default: false
- name: AdditionalModules
  type: object
  default: []
- name: SDKType
  type: string
  default: client
- name: ServiceDirectory
  type: string
  default: spring
- name: TargetDocRepoOwner
  type: string
  default: Azure
- name: TargetDocRepoName
  type: string
  default: azure-docs-sdk-java
- name: MatrixConfigs
  type: object
  default:
    - Name: Java_ci_test_base
      Path: eng/pipelines/templates/stages/platform-matrix.json
      Selection: sparse
      NonSparseParameters: Agent
      GenerateVMJobs: true
- name: AdditionalMatrixConfigs
  type: object
  default: []
- name: MatrixFilters
  type: object
  default: []
- name: MatrixReplace
  type: object
  default: []
- name: SkipAggregateReports
  type: boolean
  default: false
- name: PreBuildSteps
  type: object
  default: []

job:
- template: /eng/pipelines/templates/jobs/ci.yml
  parameters:
    ServiceDirectory: ${{ parameters.ServiceDirectory }}
    ${{ if eq(parameters.ServiceDirectory, 'template') }}:
      TestPipeline: true
    SDKType: ${{ parameters.SDKType }}
    Artifacts: ${{ parameters.Artifacts }}
    AdditionalModules: ${{ parameters.AdditionalModules }}
    SkipAggregateReports: ${{ parameters.SkipAggregateReports }}
    MatrixConfigs:
      - ${{ each config in parameters.MatrixConfigs }}:
        -  ${{ config }}
      - ${{ each config in parameters.AdditionalMatrixConfigs }}:
        -  ${{ config }}
    MatrixFilters:
      - ${{ each filter in parameters.MatrixFilters }}:
        - ${{ filter }}
      # Skip TestFromSource jobs for SDKType data
      - ${{ if eq(parameters.SDKType, 'data') }}:
        - TestFromSource=^(?!true).*
    MatrixReplace:
      - ${{ each replacement in parameters.MatrixReplace }}:
        - ${{ replacement }}
      - ${{ if eq(parameters.SDKType, 'data') }}:
        - TestGoals=.*/verify
        - TestOptions=.*/-am
      - AZURE_TEST.*=.*/
    PreBuildSteps: ${{ parameters.PreBuildSteps }}
