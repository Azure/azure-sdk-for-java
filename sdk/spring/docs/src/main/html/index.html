<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Asciidoctor 2.0.16">
    <title>Spring Cloud Azure</title>
    <link rel="stylesheet" href="css/spring.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"></head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<body class="book toc2 toc-left">
<div id="header">
    <h1>Spring Cloud Azure</h1>
    <div id="toc" class="toc2">
        <div id="toctitle">Table of Contents</div>
        <ul class="sectlevel1">
            <li><a href="#azure-cosmos-db-spring-boot-starter-client-library-for-java">1. Azure Cosmos DB Spring Boot Starter client library for Java</a>
                <ul class="sectlevel2">
                    <li><a href="#getting-started">1.1. Getting started</a>
                        <ul class="sectlevel3">
                            <li><a href="#prerequisites">1.1.1. Prerequisites</a></li>
                            <li><a href="#include-the-package">1.1.2. Include the package</a></li>
                        </ul>
                    </li>
                    <li><a href="#key-concepts">1.2. Key concepts</a></li>
                    <li><a href="#examples">1.3. Examples</a>
                        <ul class="sectlevel3">
                            <li><a href="#add-the-property-setting">1.3.1. Add the property setting</a>
                                <ul class="sectlevel4">
                                    <li><a href="#optional-add-spring-boot-actuator">(Optional) Add Spring Boot Actuator</a></li>
                                </ul>
                            </li>
                            <li><a href="#define-an-entity">1.3.2. Define an entity</a></li>
                            <li><a href="#create-repositories">1.3.3. Create repositories</a></li>
                            <li><a href="#create-an-application-class">1.3.4. Create an Application class</a></li>
                        </ul>
                    </li>
                    <li><a href="#troubleshooting">1.4. Troubleshooting</a>
                        <ul class="sectlevel3">
                            <li><a href="#logging-setting">1.4.1. Logging setting</a>
                                <ul class="sectlevel4">
                                    <li><a href="#logging-setting-examples">Logging setting examples</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><a href="#next-steps">1.5. Next steps</a></li>
                    <li><a href="#more-sample-code">1.6. More sample code</a></li>
                    <li><a href="#contributing">1.7. Contributing</a></li>
                </ul>
            </li>
            <li><a href="#azure-event-hubs-spring-cloud-starter-client-library-for-java">2. Azure Event Hubs Spring cloud starter client library for Java</a>
                <ul class="sectlevel2">
                    <li><a href="#getting-started-2">2.1. Getting started</a>
                        <ul class="sectlevel3">
                            <li><a href="#prerequisites-2">2.1.1. Prerequisites</a></li>
                            <li><a href="#include-the-package-2">2.1.2. Include the package</a></li>
                        </ul>
                    </li>
                    <li><a href="#key-concepts-2">2.2. Key concepts</a></li>
                    <li><a href="#examples-2">2.3. Examples</a></li>
                    <li><a href="#troubleshooting-2">2.4. Troubleshooting</a>
                        <ul class="sectlevel3">
                            <li><a href="#logging-setting-2">2.4.1. Logging setting</a>
                                <ul class="sectlevel4">
                                    <li><a href="#logging-setting-examples-2">Logging setting examples</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><a href="#next-steps-2">2.5. Next steps</a></li>
                    <li><a href="#more-sample-code-2">2.6. More sample code</a></li>
                    <li><a href="#contributing-2">2.7. Contributing</a></li>
                </ul>
            </li>
        </ul>
    </div>
</div>
<div id="content">
    <div id="preamble">
        <div class="sectionbody">
            <div class="paragraph">
                <p>Spring Cloud Azure is an open-source project that provides seamless Spring integration with Azure services. It gives developers a Spring-idiomatic way to connect and consume Azure services, with only need few lines of configuration and minimal code changes. Once youâ€™re ready to run your Spring app in the cloud, we recommend Azure Spring Cloud. Azure Spring Cloud is a fully managed Spring Cloud service, built and supported by the same team as Spring Cloud Azure.</p>
            </div>
        </div>
    </div>
    <div class="sect1">
        <h2 id="azure-cosmos-db-spring-boot-starter-client-library-for-java"><a class="anchor" href="#azure-cosmos-db-spring-boot-starter-client-library-for-java"></a>1. Azure Cosmos DB Spring Boot Starter client library for Java</h2>
        <div class="sectionbody">
            <div class="paragraph">
                <p><a href="https://azure.microsoft.com/services/cosmos-db/">Azure Cosmos DB</a> is a globally-distributed database service that allows developers to work with data using a variety of standard APIs, such as SQL, MongoDB, Graph, and Azure Table storage.</p>
            </div>
            <div class="paragraph">
                <p><a href="https://mvnrepository.com/artifact/com.azure.spring/azure-spring-boot-starter-cosmos">Package (Maven)</a> |  <a href="https://azure.github.io/azure-sdk-for-java/springboot.html#azure-spring-boot">API reference documentation</a> | <a href="https://docs.microsoft.com/azure/developer/java/spring-framework/configure-spring-boot-starter-java-app-with-cosmos-db">Product documentation</a> | <a href="https://github.com/Azure-Samples/azure-spring-boot-samples/tree/tag_azure-spring-boot_3.6.0/cosmos/azure-spring-boot-sample-cosmos">Samples</a></p>
            </div>
            <div class="sect2">
                <h3 id="getting-started"><a class="anchor" href="#getting-started"></a>1.1. Getting started</h3>
                <div class="sect3">
                    <h4 id="prerequisites"><a class="anchor" href="#prerequisites"></a>1.1.1. Prerequisites</h4>
                    <div class="ulist">
                        <ul>
                            <li>
                                <p><a href="https://github.com/Azure/azure-sdk-for-java/blob/main/sdk/spring/ENVIRONMENT_CHECKLIST.md#ready-to-run-checklist">Environment checklist</a></p>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="include-the-package"><a class="anchor" href="#include-the-package"></a>1.1.2. Include the package</h4>
                    <div class="olist arabic">
                        <ol class="arabic">
                            <li>
                                <p><a href="https://github.com/Azure/azure-sdk-for-java/blob/main/sdk/spring/AZURE_SPRING_BOMS_USAGE.md#add-azure-spring-boot-bom">Add azure-spring-boot-bom</a>.</p>
                            </li>
                            <li>
                                <p>Add dependency. <code>&lt;version&gt;</code> can be skipped because we already add <code>azure-spring-boot-bom</code>.</p>
                            </li>
                        </ol>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.azure.spring<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>spring-cloud-azure-starter-cosmos<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="key-concepts"><a class="anchor" href="#key-concepts"></a>1.2. Key concepts</h3>
                <div class="ulist">
                    <ul>
                        <li>
                            <p>Spring Data ReactiveCrudRepository basic CRUD functionality</p>
                            <div class="ulist">
                                <ul>
                                    <li>
                                        <p>save</p>
                                    </li>
                                    <li>
                                        <p>findAll</p>
                                    </li>
                                    <li>
                                        <p>findOne by Id</p>
                                    </li>
                                    <li>
                                        <p>deleteAll</p>
                                    </li>
                                    <li>
                                        <p>delete by Id</p>
                                    </li>
                                    <li>
                                        <p>delete entity</p>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <p>Spring Data <a href="https://github.com/spring-projects/spring-data-commons/blob/db62390de90c93a78743c97cc2cc9ccd964994a5/src/main/java/org/springframework/data/annotation/Id.java">@Id</a> annotation.
                                There&#8217;re 2 ways to map a field in domain class to <code>id</code> of Azure Cosmos DB document.</p>
                            <div class="ulist">
                                <ul>
                                    <li>
                                        <p>annotate a field in domain class with @Id, this field will be mapped to document <code>id</code> in Cosmos DB.</p>
                                    </li>
                                    <li>
                                        <p>set name of this field to <code>id</code>, this field will be mapped to document <code>id</code> in Cosmos DB.
                                            [Note] if both way applied,</p>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <p>Custom collection Name.
                                By default, collection name will be class name of user domain class.
                                To customize it, add annotation <code>@Document(collection="myCustomCollectionName")</code> to your domain class, that&#8217;s all.</p>
                        </li>
                        <li>
                            <p>Supports <a href="https://docs.microsoft.com/azure/cosmos-db/partition-data">Azure Cosmos DB partition</a>.
                                To specify a field of your domain class to be partition key field, just annotate it with <code>@PartitionKey</code>.
                                When you do CRUD operation, please specify your partition value.
                                For more sample on partition CRUD, please refer to <a href="https://github.com/Azure/azure-sdk-for-java/blob/main/sdk/cosmos/azure-spring-data-cosmos-test/src/test/java/com/azure/spring/data/cosmos/repository/integration/AddressRepositoryIT.java">test here</a></p>
                            <div class="ulist">
                                <ul>
                                    <li>
                                        <p>Supports <a href="https://docs.spring.io/spring-data/commons/docs/current/reference/html/#repositories.query-methods.details">Spring Data custom query</a> find operation.</p>
                                    </li>
                                    <li>
                                        <p>Supports <a href="https://projects.spring.io/spring-data-rest/">spring-boot-starter-data-rest</a>.</p>
                                    </li>
                                    <li>
                                        <p>Supports List and nested type in domain class.</p>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="sect2">
                <h3 id="examples"><a class="anchor" href="#examples"></a>1.3. Examples</h3>
                <div class="sect3">
                    <h4 id="add-the-property-setting"><a class="anchor" href="#add-the-property-setting"></a>1.3.1. Add the property setting</h4>
                    <div class="paragraph">
                        <p>Open <code>application.properties</code> file and add below properties with your Cosmos DB credentials.</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">azure.cosmos.uri=your-cosmos-uri
azure.cosmos.key=your-cosmos-key
azure.cosmos.database=your-cosmos-databasename
azure.cosmos.populateQueryMetrics=true
secondary-key=put-your-cosmos-secondary-key-here
# Whether to validate the uri, default is true.
azure.cosmos.validateUri=true</code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Property <code>azure.cosmos.consistency-level</code> is also supported.</p>
                    </div>
                    <div class="paragraph">
                        <p>AzureKeyCredential feature provides capability to rotate keys on the fly.
                            You can use <code>AzureKeyCredential.update()</code> methods to rotate key.
                            For more information on this, see the <a href="https://github.com/Azure/azure-sdk-for-java/blob/main/sdk/cosmos/azure-spring-data-cosmos/src/samples/java/com/azure/spring/data/cosmos/SampleApplication.java">Sample Application</a> code.</p>
                    </div>
                    <div class="sect4">
                        <h5 id="optional-add-spring-boot-actuator"><a class="anchor" href="#optional-add-spring-boot-actuator"></a>(Optional) Add Spring Boot Actuator</h5>
                        <div class="paragraph">
                            <p>If you choose to add Spring Boot Actuator for Cosmos DB, add <code>management.health.azure-cosmos.enabled=true</code> to application.properties.</p>
                        </div>
                        <div class="listingblock">
                            <div class="content">
                                <pre class="CodeRay highlight"><code data-lang="properties">management.health.azure-cosmos.enabled=true</code></pre>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>Include actuator dependencies.</p>
                        </div>
                        <div class="listingblock">
                            <div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>

<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>Call <code><a href="http://{hostname}:{port}/actuator/health/cosmos" class="bare">{hostname}:{port}/actuator/health/cosmos</a></code> to get the Cosmos DB health info.
                                <strong>Please note</strong>: it will calculate <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/request-units">RUs</a>.</p>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="define-an-entity"><a class="anchor" href="#define-an-entity"></a>1.3.2. Define an entity</h4>
                    <div class="paragraph">
                        <p>Define a simple entity as Document in Cosmos DB.</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Container</span>(containerName = <span class="string"><span class="delimiter">&quot;</span><span class="content">mycollection</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {
    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> id;
    <span class="directive">private</span> <span class="predefined-type">String</span> firstName;
    <span class="annotation">@PartitionKey</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> lastName;
    <span class="directive">private</span> <span class="predefined-type">String</span> address;

    <span class="directive">public</span> User() {
    }

    <span class="directive">public</span> User(<span class="predefined-type">String</span> id, <span class="predefined-type">String</span> firstName, <span class="predefined-type">String</span> lastName, <span class="predefined-type">String</span> address) {
        <span class="local-variable">this</span>.id = id;
        <span class="local-variable">this</span>.firstName = firstName;
        <span class="local-variable">this</span>.lastName = lastName;
        <span class="local-variable">this</span>.address = address;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getId() {
        <span class="keyword">return</span> id;
    }

    <span class="directive">public</span> <span class="type">void</span> setId(<span class="predefined-type">String</span> id) {
        <span class="local-variable">this</span>.id = id;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() {
        <span class="keyword">return</span> firstName;
    }

    <span class="directive">public</span> <span class="type">void</span> setFirstName(<span class="predefined-type">String</span> firstName) {
        <span class="local-variable">this</span>.firstName = firstName;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getLastName() {
        <span class="keyword">return</span> lastName;
    }

    <span class="directive">public</span> <span class="type">void</span> setLastName(<span class="predefined-type">String</span> lastName) {
        <span class="local-variable">this</span>.lastName = lastName;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getAddress() {
        <span class="keyword">return</span> address;
    }

    <span class="directive">public</span> <span class="type">void</span> setAddress(<span class="predefined-type">String</span> address) {
        <span class="local-variable">this</span>.address = address;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">%s %s, %s</span><span class="delimiter">&quot;</span></span>, firstName, lastName, address);
    }
}</code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p><code>id</code> field will be used as document <code>id</code> in Azure Cosmos DB.
                            Or you can annotate any field with <code>@Id</code> to map it to document <code>id</code>.</p>
                    </div>
                    <div class="paragraph">
                        <p>Annotation <code>@Container(containerName = "mycollection")</code> is used to specify the collection name of your document in Azure Cosmos DB.</p>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="create-repositories"><a class="anchor" href="#create-repositories"></a>1.3.3. Create repositories</h4>
                    <div class="paragraph">
                        <p>Extends ReactiveCosmosRepository interface, which provides Spring Data repository support.</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Repository</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> ReactiveCosmosRepository&lt;User, <span class="predefined-type">String</span>&gt; {

    Flux&lt;User&gt; findByFirstName(<span class="predefined-type">String</span> firstName);
}</code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>So far ReactiveCosmosRepository provides basic save, delete and find operations.
                            More operations will be supported later.</p>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="create-an-application-class"><a class="anchor" href="#create-an-application-class"></a>1.3.4. Create an Application class</h4>
                    <div class="paragraph">
                        <p>Here create an application class with all the components</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CosmosSampleApplication</span> <span class="directive">implements</span> CommandLineRunner {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> LOGGER = LoggerFactory.getLogger(CosmosSampleApplication.class);

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> UserRepository repository;

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> AzureKeyCredential azureKeyCredential;

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> CosmosProperties properties;

    <span class="comment">/**
     * The secondaryKey is used to rotate key for authorizing request.
     */</span>
    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${secondary-key}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> secondaryKey;

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(CosmosSampleApplication.class, args);
    }

    <span class="directive">public</span> <span class="type">void</span> run(<span class="predefined-type">String</span>... var1) {
        <span class="directive">final</span> User testUser = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">&quot;</span><span class="content">testId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">testFirstName</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">testLastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test address line one</span><span class="delimiter">&quot;</span></span>);

        <span class="comment">// Save the User class to Azure Cosmos DB database.</span>
        <span class="directive">final</span> Mono&lt;User&gt; saveUserMono = repository.save(testUser);

        <span class="directive">final</span> Flux&lt;User&gt; firstNameUserFlux = repository.findByFirstName(<span class="string"><span class="delimiter">&quot;</span><span class="content">testFirstName</span><span class="delimiter">&quot;</span></span>);

        <span class="comment">//  Nothing happens until we subscribe to these Monos.</span>
        <span class="comment">//  findById will not return the user as user is not present.</span>
        <span class="directive">final</span> Mono&lt;User&gt; findByIdMono = repository.findById(testUser.getId());
        <span class="directive">final</span> User findByIdUser = findByIdMono.block();
        Assert.isNull(findByIdUser, <span class="string"><span class="delimiter">&quot;</span><span class="content">User must be null</span><span class="delimiter">&quot;</span></span>);

        <span class="directive">final</span> User savedUser = saveUserMono.block();
        Assert.state(savedUser != <span class="predefined-constant">null</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Saved user must not be null</span><span class="delimiter">&quot;</span></span>);
        Assert.state(savedUser.getFirstName().equals(testUser.getFirstName()),
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Saved user first name doesn't match</span><span class="delimiter">&quot;</span></span>);

        firstNameUserFlux.collectList().block();

        <span class="directive">final</span> Optional&lt;User&gt; optionalUserResult = repository.findById(testUser.getId()).blockOptional();
        Assert.isTrue(optionalUserResult.isPresent(), <span class="string"><span class="delimiter">&quot;</span><span class="content">Cannot find user.</span><span class="delimiter">&quot;</span></span>);

        <span class="directive">final</span> User result = optionalUserResult.get();
        Assert.state(result.getFirstName().equals(testUser.getFirstName()),
            <span class="string"><span class="delimiter">&quot;</span><span class="content">query result firstName doesn't match!</span><span class="delimiter">&quot;</span></span>);
        Assert.state(result.getLastName().equals(testUser.getLastName()),
            <span class="string"><span class="delimiter">&quot;</span><span class="content">query result lastName doesn't match!</span><span class="delimiter">&quot;</span></span>);
        LOGGER.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">findOne in User collection get result: {}</span><span class="delimiter">&quot;</span></span>, result.toString());

        switchKey();
    }

    <span class="comment">/**
     * Switch cosmos authorization key
     */</span>
    <span class="directive">private</span> <span class="type">void</span> switchKey() {
        azureKeyCredential.update(secondaryKey);
        LOGGER.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Switch to secondary key.</span><span class="delimiter">&quot;</span></span>);

        <span class="directive">final</span> User testUserUpdated = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">&quot;</span><span class="content">testIdUpdated</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">testFirstNameUpdated</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">testLastNameUpdated</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test address Updated line one</span><span class="delimiter">&quot;</span></span>);
        <span class="directive">final</span> User saveUserUpdated = repository.save(testUserUpdated).block();
        Assert.state(saveUserUpdated != <span class="predefined-constant">null</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Saved updated user must not be null</span><span class="delimiter">&quot;</span></span>);
        Assert.state(saveUserUpdated.getFirstName().equals(testUserUpdated.getFirstName()),
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Saved updated user first name doesn't match</span><span class="delimiter">&quot;</span></span>);

        <span class="directive">final</span> Optional&lt;User&gt; optionalUserUpdatedResult = repository.findById(testUserUpdated.getId()).blockOptional();
        Assert.isTrue(optionalUserUpdatedResult.isPresent(), <span class="string"><span class="delimiter">&quot;</span><span class="content">Cannot find updated user.</span><span class="delimiter">&quot;</span></span>);
        <span class="directive">final</span> User updatedResult = optionalUserUpdatedResult.get();
        Assert.state(updatedResult.getFirstName().equals(testUserUpdated.getFirstName()),
            <span class="string"><span class="delimiter">&quot;</span><span class="content">query updated result firstName doesn't match!</span><span class="delimiter">&quot;</span></span>);
        Assert.state(updatedResult.getLastName().equals(testUserUpdated.getLastName()),
            <span class="string"><span class="delimiter">&quot;</span><span class="content">query updated result lastName doesn't match!</span><span class="delimiter">&quot;</span></span>);

        azureKeyCredential.update(properties.getKey());
        LOGGER.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Switch back to key.</span><span class="delimiter">&quot;</span></span>);
        <span class="directive">final</span> Optional&lt;User&gt; userOptional = repository.findById(testUserUpdated.getId()).blockOptional();
        Assert.isTrue(userOptional.isPresent(), <span class="string"><span class="delimiter">&quot;</span><span class="content">Cannot find updated user.</span><span class="delimiter">&quot;</span></span>);
        Assert.state(updatedResult.getFirstName().equals(testUserUpdated.getFirstName()),
            <span class="string"><span class="delimiter">&quot;</span><span class="content">query updated result firstName doesn't match!</span><span class="delimiter">&quot;</span></span>);
        LOGGER.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Finished key switch.</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> setup() {
        <span class="comment">// For this example, remove all of the existing records.</span>
        <span class="local-variable">this</span>.repository.deleteAll().block();
    }
}</code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Autowired UserRepository interface, then can do save, delete and find operations.</p>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="troubleshooting"><a class="anchor" href="#troubleshooting"></a>1.4. Troubleshooting</h3>
                <div class="sect3">
                    <h4 id="logging-setting"><a class="anchor" href="#logging-setting"></a>1.4.1. Logging setting</h4>
                    <div class="paragraph">
                        <p>Please refer to <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#boot-features-logging">spring logging document</a> to get more information about logging.</p>
                    </div>
                    <div class="sect4">
                        <h5 id="logging-setting-examples"><a class="anchor" href="#logging-setting-examples"></a>Logging setting examples</h5>
                        <div class="ulist">
                            <ul>
                                <li>
                                    <p>Example: Setting logging level of hibernate</p>
                                </li>
                            </ul>
                        </div>
                        <div class="listingblock">
                            <div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">logging.level.root=WARN
logging.level.org.springframework.web=DEBUG
logging.level.org.hibernate=ERROR</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="next-steps"><a class="anchor" href="#next-steps"></a>1.5. Next steps</h3>
                <div class="paragraph">
                    <p>Besides using this Azure Cosmos DB Spring Boot Starter, you can directly use Spring Data for Azure Cosmos DB package for more complex scenarios.
                        Please refer to <a href="https://github.com/Azure/azure-sdk-for-java/tree/main/sdk/cosmos/azure-spring-data-cosmos">Spring Data for Azure Cosmos DB</a> for more details.</p>
                </div>
                <div class="paragraph">
                    <p>The following section provide a sample project illustrating how to use the starter.</p>
                </div>
            </div>
            <div class="sect2">
                <h3 id="more-sample-code"><a class="anchor" href="#more-sample-code"></a>1.6. More sample code</h3>
                <div class="ulist">
                    <ul>
                        <li>
                            <p><a href="https://github.com/Azure-Samples/azure-spring-boot-samples/tree/tag_azure-spring-boot_3.6.0/cosmos/azure-spring-boot-sample-cosmos">Cosmos DB SQL API</a></p>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="sect2">
                <h3 id="contributing"><a class="anchor" href="#contributing"></a>1.7. Contributing</h3>
                <div class="paragraph">
                    <p>This project welcomes contributions and suggestions.
                        Most contributions require you to agree to a Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us the rights to use your contribution.
                        For details, visit <a href="https://cla.microsoft.com" class="bare">cla.microsoft.com</a>.</p>
                </div>
                <div class="paragraph">
                    <p>Please follow <a href="https://github.com/Azure/azure-sdk-for-java/blob/main/sdk/spring/CONTRIBUTING.md">instructions here</a> to build from source or contribute.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="sect1">
        <h2 id="azure-event-hubs-spring-cloud-starter-client-library-for-java"><a class="anchor" href="#azure-event-hubs-spring-cloud-starter-client-library-for-java"></a>2. Azure Event Hubs Spring cloud starter client library for Java</h2>
        <div class="sectionbody">
            <div class="paragraph">
                <p>The Spring Cloud Event Hubs starter helps developers to finish the auto-configuration of Event Hubs and provides Spring Integration on Event Hubs.</p>
            </div>
            <div class="paragraph">
                <p>For Spring Integration on Event Hubs, please refer to the <a href="https://github.com/Azure/azure-sdk-for-java/tree/main/sdk/spring/azure-spring-integration-eventhubs">source code</a>.</p>
            </div>
            <div class="paragraph">
                <p><a href="https://mvnrepository.com/artifact/com.azure.spring/azure-spring-cloud-starter-eventhubs">Package (Maven)</a> | <a href="https://azure.github.io/azure-sdk-for-java/springcloud.html#azure-spring-cloud-autoconfigure">API reference documentation</a> | <a href="https://github.com/Azure-Samples/azure-spring-boot-samples/tree/tag_azure-spring-boot_3.6.0/eventhubs/azure-spring-integration-sample-eventhubs">Samples</a></p>
            </div>
            <div class="sect2">
                <h3 id="getting-started-2"><a class="anchor" href="#getting-started-2"></a>2.1. Getting started</h3>
                <div class="sect3">
                    <h4 id="prerequisites-2"><a class="anchor" href="#prerequisites-2"></a>2.1.1. Prerequisites</h4>
                    <div class="ulist">
                        <ul>
                            <li>
                                <p><a href="https://github.com/Azure/azure-sdk-for-java/blob/main/sdk/spring/ENVIRONMENT_CHECKLIST.md#ready-to-run-checklist">Environment checklist</a></p>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="include-the-package-2"><a class="anchor" href="#include-the-package-2"></a>2.1.2. Include the package</h4>
                    <div class="olist arabic">
                        <ol class="arabic">
                            <li>
                                <p><a href="https://github.com/Azure/azure-sdk-for-java/blob/main/sdk/spring/AZURE_SPRING_BOMS_USAGE.md#add-azure-spring-cloud-dependencies">Add azure-spring-cloud-dependencies</a>.</p>
                            </li>
                            <li>
                                <p>Add dependency. <code>&lt;version&gt;</code> can be skipped because we already add <code>azure-spring-cloud-dependencies</code>.</p>
                            </li>
                        </ol>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.azure.spring<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>spring-cloud-azure-starter-eventhubs<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="key-concepts-2"><a class="anchor" href="#key-concepts-2"></a>2.2. Key concepts</h3>
                <div class="paragraph">
                    <p>Azure Event Hubs is a big data streaming platform and event ingestion service. It can receive and process millions of events per second. Data sent to an event hub can be transformed and stored by using any real-time analytics provider or batching/storage adapters.</p>
                </div>
                <div class="paragraph">
                    <p>Note: RxJava support APIs have been deprecated from version 2.10.0, and will be dropped from version 4.0.0.
                        Please refer to Javadoc for details.</p>
                </div>
            </div>
            <div class="sect2">
                <h3 id="examples-2"><a class="anchor" href="#examples-2"></a>2.3. Examples</h3>
                <div class="paragraph">
                    <p>Please refer to this <a href="https://github.com/Azure-Samples/azure-spring-boot-samples/tree/tag_azure-spring-boot_3.6.0/eventhubs/azure-spring-integration-sample-eventhubs">sample project</a> illustrating how to use Spring Cloud Event Hubs.</p>
                </div>
            </div>
            <div class="sect2">
                <h3 id="troubleshooting-2"><a class="anchor" href="#troubleshooting-2"></a>2.4. Troubleshooting</h3>
                <div class="sect3">
                    <h4 id="logging-setting-2"><a class="anchor" href="#logging-setting-2"></a>2.4.1. Logging setting</h4>
                    <div class="paragraph">
                        <p>Please refer to <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#boot-features-logging">spring logging document</a> to get more information about logging.</p>
                    </div>
                    <div class="sect4">
                        <h5 id="logging-setting-examples-2"><a class="anchor" href="#logging-setting-examples-2"></a>Logging setting examples</h5>
                        <div class="ulist">
                            <ul>
                                <li>
                                    <p>Example: Setting logging level of hibernate</p>
                                </li>
                            </ul>
                        </div>
                        <div class="listingblock">
                            <div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">logging.level.root=WARN
logging.level.org.springframework.web=DEBUG
logging.level.org.hibernate=ERROR</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="next-steps-2"><a class="anchor" href="#next-steps-2"></a>2.5. Next steps</h3>
                <div class="paragraph">
                    <p>The following section provide a sample project illustrating how to use the starter.</p>
                </div>
            </div>
            <div class="sect2">
                <h3 id="more-sample-code-2"><a class="anchor" href="#more-sample-code-2"></a>2.6. More sample code</h3>
                <div class="ulist">
                    <ul>
                        <li>
                            <p><a href="https://github.com/Azure-Samples/azure-spring-boot-samples/tree/tag_azure-spring-boot_3.6.0/eventhubs/azure-spring-integration-sample-eventhubs">Eventhubs Integration Sample</a>.</p>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="sect2">
                <h3 id="contributing-2"><a class="anchor" href="#contributing-2"></a>2.7. Contributing</h3>
                <div class="paragraph">
                    <p>This project welcomes contributions and suggestions.  Most contributions require you to agree to a Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us the rights to use your contribution. For details, visit <a href="https://cla.microsoft.com" class="bare">cla.microsoft.com</a>.</p>
                </div>
                <div class="paragraph">
                    <p>Please follow <a href="https://github.com/Azure/azure-sdk-for-java/tree/main/sdk/spring/CONTRIBUTING.md">instructions here</a> to build from source or contribute.</p>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="js/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
<link rel="stylesheet" href="js/github.min.css">
<script src="js/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>
