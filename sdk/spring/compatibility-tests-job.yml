parameters:
  Matrix: ''
  MaxParallel: 0
  SkipOptions: "-Dcheckstyle.skip=true -Dcodesnippet.skip -Denforcer.skip -Djacoco.skip=true -Dmaven.javadoc.skip=true -Drevapi.skip=true -Dspotbugs.skip=true"
  BuildParallelization: '2C'


jobs:
  - job: 'compatibility_test'
#    dependsOn: ''
#    condition: always()
#    dependsOn: ${{ parameters.DependsOn }}
#    condition: and(succeededOrFailed(), ne(${{ parameters.Matrix }}, '{}'))

    strategy:
      maxParallel: ${{ parameters.MaxParallel }}
      matrix: $[ ${{ parameters.Matrix }} ]
    pool:
      vmImage: "ubuntu-latest"
    variables:
      - template: ../../eng/pipelines/templates/variables/globals.yml

    steps:
      - template: /eng/common/pipelines/templates/steps/sparse-checkout.yml
        parameters:
          Paths:
            - 'sdk/spring'
            - 'sdk/boms/spring-cloud-azure-dependencies'
#            - 'eng'
      - script: |
          pip install termcolor
        displayName: 'python module install'
      - script: |
          python ./sdk/spring/scripts/compatibility_add_dependencymanagement.py
        displayName: 'add dependency management'
      - script: |
          python ./sdk/spring/scripts/compatibility_deleted_version.py
        displayName: 'remove version'
      - task: Maven@3
        displayName: 'Run tests'
        inputs:
          options: '$(DefaultOptions) -ntp -T ${{parameters.BuildParallelization}} ${{parameters.SkipOptions}}'
          mavenPomFile: sdk/spring/pom.xml
          mavenOptions: '$(MemoryOptions)'
          javaHomeOption: 'JDKVersion'
          jdkVersionOption: $(JavaTestVersion)
          jdkArchitectureOption: 'x64'
          goals: 'clean test -Pdev '

