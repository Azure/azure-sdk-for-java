// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) AutoRest Code Generator.

package com.azure.resourcemanager.azurestackhci.generated;

import com.azure.core.credential.AccessToken;
import com.azure.core.http.HttpClient;
import com.azure.core.management.AzureEnvironment;
import com.azure.core.management.profile.AzureProfile;
import com.azure.core.test.http.MockHttpResponse;
import com.azure.resourcemanager.azurestackhci.AzureStackHciManager;
import com.azure.resourcemanager.azurestackhci.models.Cluster;
import com.azure.resourcemanager.azurestackhci.models.ClusterDesiredProperties;
import com.azure.resourcemanager.azurestackhci.models.DiagnosticLevel;
import com.azure.resourcemanager.azurestackhci.models.LogCollectionProperties;
import com.azure.resourcemanager.azurestackhci.models.ManagedServiceIdentityType;
import com.azure.resourcemanager.azurestackhci.models.RemoteSupportProperties;
import com.azure.resourcemanager.azurestackhci.models.SoftwareAssuranceIntent;
import com.azure.resourcemanager.azurestackhci.models.SoftwareAssuranceProperties;
import com.azure.resourcemanager.azurestackhci.models.UserAssignedIdentity;
import com.azure.resourcemanager.azurestackhci.models.WindowsServerSubscription;
import java.nio.charset.StandardCharsets;
import java.time.OffsetDateTime;
import java.util.HashMap;
import java.util.Map;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import reactor.core.publisher.Mono;

public final class ClustersCreateWithResponseMockTests {
    @Test
    public void testCreateWithResponse() throws Exception {
        String responseStr
            = "{\"identity\":{\"principalId\":\"33b9725c-39e1-4f46-ac71-c8fd624c348a\",\"tenantId\":\"d034c756-7750-4854-9603-17b0e99f4d16\",\"type\":\"UserAssigned\",\"userAssignedIdentities\":{\"t\":{\"principalId\":\"eefcd083-6f4e-47fa-b032-b9a90fa54c0c\",\"clientId\":\"2a17e21f-0f6b-4022-a4db-7d41b3644147\"},\"molpcqyde\":{\"principalId\":\"310e2ba7-6013-47c6-ad85-7425c0c5ef56\",\"clientId\":\"f6b9e9f9-5a95-474d-9145-ea615a11056d\"},\"skiczd\":{\"principalId\":\"12b2456b-7cec-460d-a09e-f95c482c74bc\",\"clientId\":\"1dd8b1fc-8657-4d94-83a0-57d309e7b6c1\"},\"eizikgqaboohxbms\":{\"principalId\":\"2400a659-6b39-4414-b6be-4e42028c832a\",\"clientId\":\"0e7d1bcc-41b3-40f4-85ee-9f737e366abc\"}}},\"properties\":{\"provisioningState\":\"Provisioning\",\"status\":\"Error\",\"connectivityStatus\":\"NotSpecified\",\"cloudId\":\"vewuyqaeoh\",\"cloudManagementEndpoint\":\"hgejkbvhhdaurgh\",\"aadClientId\":\"xaex\",\"aadTenantId\":\"hxjxjoezlqxrkdkn\",\"aadApplicationObjectId\":\"bekt\",\"aadServicePrincipalObjectId\":\"o\",\"softwareAssuranceProperties\":{\"softwareAssuranceStatus\":\"Disabled\",\"softwareAssuranceIntent\":\"Disable\",\"lastUpdated\":\"2021-06-22T14:04:52Z\"},\"logCollectionProperties\":{\"fromDate\":\"2020-12-28T13:33:15Z\",\"toDate\":\"2020-12-24T14:15:46Z\",\"lastLogGenerated\":\"2021-02-10T19:11:34Z\",\"logCollectionSessionDetails\":[{\"logStartTime\":\"2021-10-27T12:48:20Z\",\"logEndTime\":\"2021-10-28T14:26:59Z\",\"timeCollected\":\"2021-11-07T15:02:52Z\",\"logSize\":6876179074329642977,\"logCollectionStatus\":\"Succeeded\",\"logCollectionJobType\":\"Scheduled\",\"correlationId\":\"bmdlqjbed\",\"endTimeCollected\":\"2021-04-13T18:01:59Z\",\"logCollectionError\":{}},{\"logStartTime\":\"2021-05-30T19:18:21Z\",\"logEndTime\":\"2021-09-04T03:17:34Z\",\"timeCollected\":\"2021-05-22T06:53:40Z\",\"logSize\":1873661597049622764,\"logCollectionStatus\":\"Failed\",\"logCollectionJobType\":\"OnDemand\",\"correlationId\":\"xpkcdp\",\"endTimeCollected\":\"2021-05-29T14:33:46Z\",\"logCollectionError\":{}},{\"logStartTime\":\"2021-07-13T06:57:28Z\",\"logEndTime\":\"2021-11-10T07:43:10Z\",\"timeCollected\":\"2021-05-14T16:09:24Z\",\"logSize\":2408862410974547227,\"logCollectionStatus\":\"Failed\",\"logCollectionJobType\":\"Scheduled\",\"correlationId\":\"jyg\",\"endTimeCollected\":\"2021-04-10T00:07:42Z\",\"logCollectionError\":{}},{\"logStartTime\":\"2021-02-08T05:06:19Z\",\"logEndTime\":\"2021-11-10T12:39:45Z\",\"timeCollected\":\"2021-07-10T03:31:24Z\",\"logSize\":5940808250160111921,\"logCollectionStatus\":\"None\",\"logCollectionJobType\":\"OnDemand\",\"correlationId\":\"gvqcpdwj\",\"endTimeCollected\":\"2021-01-03T16:46:04Z\",\"logCollectionError\":{}}]},\"remoteSupportProperties\":{\"accessLevel\":\"Diagnostics\",\"expirationTimeStamp\":\"2021-11-22T22:58:24Z\",\"remoteSupportType\":\"Enable\",\"remoteSupportNodeSettings\":[{\"arcResourceId\":\"cdjhunhg\",\"state\":\"gawnrrnquo\",\"createdAt\":\"2021-04-17T12:36:08Z\",\"updatedAt\":\"2021-01-28T18:03:35Z\",\"connectionStatus\":\"eimseobfsxstcyil\",\"connectionErrorMessage\":\"zmmx\",\"transcriptLocation\":\"zlquzexo\"},{\"arcResourceId\":\"xebjvbz\",\"state\":\"zabwmvog\",\"createdAt\":\"2021-11-23T09:45:11Z\",\"updatedAt\":\"2021-02-22T10:33:03Z\",\"connectionStatus\":\"gi\",\"connectionErrorMessage\":\"wcehaqidoyzlt\",\"transcriptLocation\":\"omqo\"},{\"arcResourceId\":\"epiaeapfsergd\",\"state\":\"eqn\",\"createdAt\":\"2021-11-04T23:22:14Z\",\"updatedAt\":\"2021-04-16T16:17:47Z\",\"connectionStatus\":\"wbpqqncjubkhjoz\",\"connectionErrorMessage\":\"mcwmbup\",\"transcriptLocation\":\"qyvliqiipsejbsvs\"}],\"remoteSupportSessionDetails\":[{\"sessionStartTime\":\"2021-07-02T19:45:24Z\",\"sessionEndTime\":\"2021-01-13T14:45:34Z\",\"nodeName\":\"dzydisnuep\",\"duration\":3643735732741373341,\"accessLevel\":\"DiagnosticsAndRepair\"},{\"sessionStartTime\":\"2021-01-10T21:45:57Z\",\"sessionEndTime\":\"2021-09-29T18:06:51Z\",\"nodeName\":\"ttdiia\",\"duration\":6520305168269543676,\"accessLevel\":\"DiagnosticsAndRepair\"},{\"sessionStartTime\":\"2021-01-09T11:54:07Z\",\"sessionEndTime\":\"2021-05-22T02:36:51Z\",\"nodeName\":\"ebiphryvcjwqwoq\",\"duration\":7314568991883609573,\"accessLevel\":\"DiagnosticsAndRepair\"},{\"sessionStartTime\":\"2021-11-03T16:42:03Z\",\"sessionEndTime\":\"2021-03-06T14:36:39Z\",\"nodeName\":\"s\",\"duration\":4001919220570472502,\"accessLevel\":\"DiagnosticsAndRepair\"}]},\"desiredProperties\":{\"windowsServerSubscription\":\"Enabled\",\"diagnosticLevel\":\"Off\"},\"reportedProperties\":{\"clusterName\":\"v\",\"clusterId\":\"khsusmmorf\",\"clusterVersion\":\"hwilz\",\"nodes\":[{\"name\":\"jmriprlkdneyttlr\",\"id\":87.365326,\"windowsServerSubscription\":\"Disabled\",\"nodeType\":\"FirstParty\",\"ehcResourceId\":\"tpumltwjfluxynb\",\"manufacturer\":\"zlqywauyqn\",\"model\":\"khmocgjs\",\"osName\":\"ouarhwvixqqggljk\",\"osVersion\":\"sjrclrvtzq\",\"osDisplayVersion\":\"bctbhp\",\"serialNumber\":\"xpc\",\"coreCount\":40.743237,\"memoryInGiB\":3.5265923,\"lastLicensingTimestamp\":\"2021-08-27T15:37:44Z\",\"oemActivation\":\"Enabled\"},{\"name\":\"eq\",\"id\":4.6417713,\"windowsServerSubscription\":\"Enabled\",\"nodeType\":\"ThirdParty\",\"ehcResourceId\":\"wriuomzczfkic\",\"manufacturer\":\"vsaaxwsp\",\"model\":\"xikhfj\",\"osName\":\"bglcxkxgzzromvy\",\"osVersion\":\"sem\",\"osDisplayVersion\":\"esrfsvpinkzpatq\",\"serialNumber\":\"iswxspv\",\"coreCount\":71.246414,\"memoryInGiB\":56.06608,\"lastLicensingTimestamp\":\"2021-11-07T00:53:27Z\",\"oemActivation\":\"Disabled\"},{\"name\":\"pftesubzpvpvdy\",\"id\":81.08345,\"windowsServerSubscription\":\"Enabled\",\"nodeType\":\"ThirdParty\",\"ehcResourceId\":\"eu\",\"manufacturer\":\"fjb\",\"model\":\"zfxnxmlbmuos\",\"osName\":\"jmdihdcyyyzlw\",\"osVersion\":\"wzjnufz\",\"osDisplayVersion\":\"gmdq\",\"serialNumber\":\"nbzrtfte\",\"coreCount\":78.62227,\"memoryInGiB\":78.94032,\"lastLicensingTimestamp\":\"2021-08-16T22:24:01Z\",\"oemActivation\":\"Disabled\"},{\"name\":\"sxmtyjjvavdp\",\"id\":14.428884,\"windowsServerSubscription\":\"Disabled\",\"nodeType\":\"ThirdParty\",\"ehcResourceId\":\"titsf\",\"manufacturer\":\"fwanm\",\"model\":\"scauwazcgwdfr\",\"osName\":\"gyb\",\"osVersion\":\"ozokscvglli\",\"osDisplayVersion\":\"gbyfgwe\",\"serialNumber\":\"k\",\"coreCount\":40.628033,\"memoryInGiB\":7.843375,\"lastLicensingTimestamp\":\"2021-06-05T16:00:28Z\",\"oemActivation\":\"Enabled\"}],\"lastUpdated\":\"2021-03-20T16:40:18Z\",\"imdsAttestation\":\"Enabled\",\"diagnosticLevel\":\"Off\",\"supportedCapabilities\":[\"skl\",\"e\",\"uugggzlfbgrd\"],\"clusterType\":\"ThirdParty\",\"manufacturer\":\"srtmdylperpiltt\",\"oemActivation\":\"Disabled\"},\"isolatedVmAttestationConfiguration\":{\"attestationResourceId\":\"fcm\",\"relyingPartyServiceEndpoint\":\"fbodetresrgvts\",\"attestationServiceEndpoint\":\"vftwaiv\"},\"trialDaysRemaining\":41.889103,\"billingModel\":\"evzgjypanh\",\"registrationTimestamp\":\"2021-08-20T09:01:24Z\",\"lastSyncTimestamp\":\"2021-10-11T22:17:45Z\",\"lastBillingTimestamp\":\"2021-06-06T18:24:53Z\",\"serviceEndpoint\":\"twwzjw\",\"resourceProviderObjectId\":\"nxlkfhglhrfoxqwe\"},\"location\":\"snhpcselqx\",\"tags\":{\"rl\":\"pqibukklv\",\"vfqbqna\":\"mlccmetjscz\"},\"id\":\"dsyenzsieuscpl\",\"name\":\"yvdgxlyzk\",\"type\":\"itdshezsvkolru\"}";

        HttpClient httpClient
            = response -> Mono.just(new MockHttpResponse(response, 200, responseStr.getBytes(StandardCharsets.UTF_8)));
        AzureStackHciManager manager = AzureStackHciManager.configure()
            .withHttpClient(httpClient)
            .authenticate(tokenRequestContext -> Mono.just(new AccessToken("this_is_a_token", OffsetDateTime.MAX)),
                new AzureProfile("", "", AzureEnvironment.AZURE));

        Cluster response = manager.clusters()
            .define("xxij")
            .withRegion("do")
            .withExistingResourceGroup("dm")
            .withTags(mapOf("hmnulwem", "zfjjnnuxxrkk", "flu", "dcifrhjulrsulwz"))
            .withTypeIdentityType(ManagedServiceIdentityType.SYSTEM_ASSIGNED)
            .withUserAssignedIdentities(
                mapOf("gyacwrasekwef", new UserAssignedIdentity(), "inwoqartwyxq", new UserAssignedIdentity()))
            .withCloudManagementEndpoint("jezcjumvps")
            .withAadClientId("ioyoiglkmiq")
            .withAadTenantId("nracli")
            .withAadApplicationObjectId("fqpspkladyd")
            .withAadServicePrincipalObjectId("hautw")
            .withSoftwareAssuranceProperties(
                new SoftwareAssuranceProperties().withSoftwareAssuranceIntent(SoftwareAssuranceIntent.ENABLE))
            .withLogCollectionProperties(new LogCollectionProperties())
            .withRemoteSupportProperties(new RemoteSupportProperties())
            .withDesiredProperties(
                new ClusterDesiredProperties().withWindowsServerSubscription(WindowsServerSubscription.DISABLED)
                    .withDiagnosticLevel(DiagnosticLevel.ENHANCED))
            .create();

        Assertions.assertEquals("snhpcselqx", response.location());
        Assertions.assertEquals("pqibukklv", response.tags().get("rl"));
        Assertions.assertEquals(ManagedServiceIdentityType.USER_ASSIGNED, response.typeIdentityType());
        Assertions.assertEquals("hgejkbvhhdaurgh", response.cloudManagementEndpoint());
        Assertions.assertEquals("xaex", response.aadClientId());
        Assertions.assertEquals("hxjxjoezlqxrkdkn", response.aadTenantId());
        Assertions.assertEquals("bekt", response.aadApplicationObjectId());
        Assertions.assertEquals("o", response.aadServicePrincipalObjectId());
        Assertions.assertEquals(SoftwareAssuranceIntent.DISABLE,
            response.softwareAssuranceProperties().softwareAssuranceIntent());
        Assertions.assertEquals(WindowsServerSubscription.ENABLED,
            response.desiredProperties().windowsServerSubscription());
        Assertions.assertEquals(DiagnosticLevel.OFF, response.desiredProperties().diagnosticLevel());
    }

    // Use "Map.of" if available
    @SuppressWarnings("unchecked")
    private static <T> Map<String, T> mapOf(Object... inputs) {
        Map<String, T> map = new HashMap<>();
        for (int i = 0; i < inputs.length; i += 2) {
            String key = (String) inputs[i];
            T value = (T) inputs[i + 1];
            map.put(key, value);
        }
        return map;
    }
}
