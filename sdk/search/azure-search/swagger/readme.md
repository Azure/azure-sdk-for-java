# Azure Search for Java
    
> see https://aka.ms/autorest

This is the AutoRest configuration file for SearchServiceClient and SearchIndexClient.
---
## Getting Started 

To build the SDK for SearchServiceClient and SearchIndexClient, simply [Install AutoRest](https://aka.ms/autorest/install) and in this folder, run:

> `autorest`

To see additional help and options, run:

> `autorest --help`
---

---
### Generation

There are two swaggers for search: index and service. They always under same package version, e.g. `--tag=package-2019-05-searchindex-preview` and `--tag=package-2019-05-searchservice-preview`.

```ps
cd <swagger-folder>
autorest --use=@microsoft.azure/autorest.java@3.0.3 --tag=${package} --version=2.0.4413 
```

e.g.
```ps
cd <swagger-folder>
autorest --use=@microsoft.azure/autorest.java@3.0.3 --tag=package-2019-05-searchindex-preview --version=2.0.4413 
autorest --use=@microsoft.azure/autorest.java@3.0.3 --tag=package-2019-05-searchservice-preview --version=2.0.4413 
```
## Configuration

### Basic Information 
These are the global settings for SearchServiceClient and SearchIndexClient.

``` yaml
opt-in-extensible-enums: true
openapi-type: data-plane
```

### Tag: package-2019-05-searchservice-preview

These settings apply only when `--tag=package-2019-05-searchservice-preview` is specified on the command line.

``` yaml $(tag) == 'package-2019-05-searchservice-preview'
input-file:
- https://github.com/Azure/azure-rest-api-specs/blob/master/specification/search/data-plane/Azure.Search/preview/2019-05-06-preview/searchservice.json
title: SearchServiceRestClient
custom-types-subpackage: implementation.models
custom-types: AnalyzeResult,ListDataSourcesResult,ListIndexersResult,ListIndexesResult,ListSkillsetsResult,ListSynonymMapsResult,AccessCondition
```

### Tag: package-2019-05-searchindex-preview

These settings apply only when `--tag=package-2019-05-searchindex-preview` is specified on the command line.

``` yaml $(tag) == 'package-2019-05-searchindex-preview'
input-file:
- https://github.com/Azure/azure-rest-api-specs/blob/master/specification/search/data-plane/Azure.Search/preview/2019-05-06-preview/searchindex.json
title: SearchIndexRestClient
models-subpackage: implementation.models
custom-types: QueryType,AutocompleteResult,AutocompleteOptions,AutocompleteRequest,AutocompleteItem,IndexDocumentsResult,IndexingResult,SearchError,SearchErrorException,SearchResult,SearchRequest,SearchOptions,RequestOptions,IndexBatchBase,IndexAction,FacetResult,SuggestOptions,SuggestResult,SuggestRequest
custom-types-subpackage: models
```

### Tag: package-2019-05-searchservice

These settings apply only when `--tag=package-2019-05-searchservice` is specified on the command line.

``` yaml $(tag) == 'package-2019-05-searchservice'
input-file:
- https://github.com/Azure/azure-rest-api-specs/blob/master/specification/search/data-plane/Azure.Search/stable/2019-05-06/searchservice.json
```

### Tag: package-2019-05-searchindex

These settings apply only when `--tag=package-2019-05-searchindex` is specified on the command line.

``` yaml $(tag) == 'package-2019-05-searchindex'
input-file:
- https://github.com/Azure/azure-rest-api-specs/blob/master/specification/search/data-plane/Azure.Search/stable/2019-05-06/searchindex.json
```

---
# Code Generation

!!! READ THIS !!!
This swagger is ready for C# and Java.
!!! READ THIS !!!

## Java

``` yaml
output-folder: ../
namespace: com.azure.search
java: true
sync-methods: none
add-context-parameter: true
generate-client-interfaces: false
license-header: |-
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the MIT License.
  Code generated by Microsoft (R) AutoRest Code Generator.
  Changes may cause incorrect behavior and will be lost if the code is regenerated.

require: ./autorest-custom-directives.md

vararg-properties: >-
  AutocompleteOptions.searchFields,
  SearchOptions.facets, SearchOptions.highlightFields, SearchOptions.orderBy, SearchOptions.scoringParameters, SearchOptions.searchFields, SearchOptions.select,
  SuggestOptions.orderBy, SuggestOptions.searchFields, SuggestOptions.select, CorsOptions.allowedOrigins
```

``` yaml $(java)
directive:
    # Change DocumentsImpl to take Accept header parameter
    - from: DocumentsImpl.java
      where: $
      transform: >-
          return $
          .replace(/(\@HostParam\(\"indexName\"\) String indexName)/g, "$1\, @HeaderParam\(\"accept\"\) String accept")
          .replace(/(this.client.getIndexName\(\),)/g, "$1 accept,")
          .replace(/(public Mono\<(.*)\) \{)/g, "$1\n\t\tfinal String accept \= \"application\/json\;odata\.metadata\=none\"\;\n")

    # Use Document rather than Map<String, Object>
    - from:
          - SuggestResult.java
          - SearchResult.java
      where: $
      transform: >-
          return $
          .replace(/(package com.azure.search.models;)/g, "$1\nimport com.azure.search.SearchDocument;")
          .replace(/(Map<String, Object>)/g, "SearchDocument")

    # Rename IndexBatch to IndexBatchBase when processing the API spec
    - rename-model:
          from: IndexBatch
          to: IndexBatchBase

    # Enable configuration of RestProxy serializer
    - from: DocumentsImpl.java
      where: $
      transform: >-
          return $
          .replace(/(import com.azure.core.util.serializer.JacksonAdapter;)/g, "$1\nimport com.azure.core.util.serializer.SerializerAdapter;")
          .replace(/(import java.util.List;)/g, "$1\nimport java.util.Map;")
          .replace(/(Mono\<SimpleResponse\<Object\>\>)/g, "Mono<SimpleResponse<Map<? extends String, Object>>>")
          .replace(/(@param client the instance of the service client containing this operation class.)/g, "$1\n     \* @param serializer the serializer to be used for service client requests.")
          .replace(/(public DocumentsImpl\(SearchIndexRestClientImpl client\) {)/g, "public DocumentsImpl(SearchIndexRestClientImpl client, SerializerAdapter serializer) {")
          .replace(/(this.service = RestProxy.create\(DocumentsService.class, client.getHttpPipeline\(\)\);)/g, "this.service = RestProxy.create(DocumentsService.class, client.getHttpPipeline(), serializer);")

    # Enable configuration of RestProxy serializer
    - from: SearchIndexRestClientImpl.java
      where: $
      transform: >-
          return $
          .replace(/(void setApiVersion)/g, "public void setApiVersion")
          .replace(/(void setIndexName)/g, "public void setIndexName")
          .replace(/(void setSearchDnsSuffix)/g, "public void setSearchDnsSuffix")
          .replace(/(void setSearchServiceName)/g, "public void setSearchServiceName")
          .replace(/(package com.azure.search.implementation;)/g, "$1\nimport com.azure.core.util.serializer.JacksonAdapter;\nimport com.azure.core.util.serializer.SerializerAdapter;")
          .replace(/(this\(RestProxy.createDefaultPipeline\(\)\);)/g, "this(RestProxy.createDefaultPipeline(), JacksonAdapter.createDefaultSerializerAdapter());")
          .replace(/(@param httpPipeline The HTTP pipeline to send requests through.)/g, "$1\n     \* @param serializer the serializer to be used for service client requests.")
          .replace(/(this\(new HttpPipelineBuilder\(\)\.policies\(new UserAgentPolicy\(\)\, new RetryPolicy\(\)\, new CookiePolicy\(\)\)\.build\(\)\)\;)/g, "this(new HttpPipelineBuilder().policies(new UserAgentPolicy(), new RetryPolicy(), new CookiePolicy()).build(), new JacksonAdapter());")
          .replace(/(public SearchIndexRestClientImpl\(HttpPipeline httpPipeline\) {)/g, "public SearchIndexRestClientImpl(HttpPipeline httpPipeline, SerializerAdapter serializer) {")
          .replace(/(this.documents = new DocumentsImpl\(this\);)/g, "this.documents = new DocumentsImpl(this, serializer);")

    # Enable serialization of both POJOs and Maps
    - from: IndexAction.java
      where: $
      transform: >-
          return $
          .replace(/(import com.fasterxml.jackson.annotation.JsonProperty;)/g, "import com.fasterxml.jackson.annotation.JsonAnyGetter;\nimport com.fasterxml.jackson.annotation.JsonIgnore;\n$1\nimport com.fasterxml.jackson.annotation.JsonUnwrapped;\n")
          .replace(/(class IndexAction)/g, "$1<T>")
          .replace(/(Unmatched properties from the message are deserialized this collection)/g, "The document on which the action will be performed.")
          .replace(/(@JsonProperty\(value = ""\))/g, "@JsonUnwrapped")
          .replace(/(private Map<String, Object> additionalProperties);/g, "private T document;\n\n    @JsonIgnore\n    private Map<String, Object> properties;\n\n    @JsonAnyGetter\n    private Map<String, Object> getParamMap() {\n        return properties;\n    }")
          .replace(/(Get the additionalProperties property: Unmatched properties from the\n\s+\* message are deserialized this collection.)/g, "Get the document on which the action will be performed; Fields other than the key are ignored for delete actions.")
          .replace(/(@return the additionalProperties value.)/g, "@return the document value.")
          .replace(/(public Map<String, Object> getAdditionalProperties\(\) {\s+return this.additionalProperties;\s+})/g, "public T getDocument() {\n        return this.document;\n    }")
          .replace(/(Set the additionalProperties property: Unmatched properties from the\s+\* message are deserialized this collection.)/g, "Get the document on which the action will be performed; Fields other than the key are ignored for delete actions.")
          .replace(/(@param additionalProperties the additionalProperties value to set.)/g, "@param document the document value to set.")
          .replace(/(public IndexAction setAdditionalProperties\(Map<String, Object> additionalProperties\) {\s+this.additionalProperties = additionalProperties;\s+return this;\s+})/g, "@SuppressWarnings(\"unchecked\")\n    public IndexAction<T> setDocument(T document) {\n        if (document instanceof Map) {\n            this.properties = (Map<String, Object>) document;\n            this.document = null;\n        } else {\n            this.document = document;\n            this.properties = null;\n        }\n        return this;\n    }")
          .replace(/(public IndexAction setActionType\(IndexActionType actionType\) {)/g, "public IndexAction<T> setActionType(IndexActionType actionType) {")

    # Enable configuration of RestProxy serializer
    - from: SearchIndexRestClientBuilder.java
      where: $
      transform: >-
          return $
          .replace(/(package com.azure.search.implementation;)/g, "$1\nimport com.azure.core.util.serializer.SerializerAdapter;")
          .replace(/(\* The HTTP pipeline to send requests through)/g, "\* The serializer to use for requests\n     \*\/\n    private SerializerAdapter serializer;\n\n    \/\*\*\n     \* Sets The serializer to use for requests.\n     \*\n     \* @param serializer the serializer value.\n     \* @return the SearchIndexRestClientBuilder.\n     \*\/\n    public SearchIndexRestClientBuilder serializer\(SerializerAdapter serializer\) {\n        this.serializer = serializer;\n        return this;\n    }\n\n    \/\*\n     $1")
          .replace(/(new SearchIndexRestClientImpl\(pipeline)/g, "$1, serializer")
          .replace(/(this.pipeline = RestProxy.createDefaultPipeline\(\);\s+})/g, "$1\n        if \(serializer == null\) {\n            this.serializer = JacksonAdapter.createDefaultSerializerAdapter\(\);\n        }")

    # Enable IndexBatchBase to be used as a generic type
    - from: IndexBatchBase.java
      where: $
      transform: >-
          return $
          .replace(/(public final class IndexBatchBase)/g, "public class IndexBatchBase<T>")
          .replace(/(private List<IndexAction> actions;)/g, "private List<IndexAction<T>> actions;")
          .replace(/(public List<IndexAction> getActions\(\) {)/g, "public List<IndexAction<T>> getActions() {")
          .replace(/(public IndexBatchBase setActions\(List<IndexAction> actions\) {)/g, "protected IndexBatchBase<T> setActions(List<IndexAction<T>> actions) {")

    # Replace use of generated IndexBatchBase with custom IndexBatch class
    - from: DocumentsImpl.java
      where: $
      transform: >-
          return $
          .replace(/(Mono<IndexDocumentsResult> indexAsync)/g, "<T> $1")
          .replace(/(Mono<SimpleResponse<IndexDocumentsResult>> index)/g, "<T> $1")
          .replace(/(IndexBatchBase)/g, "IndexBatchBase<T>")
          .replace(/(com\.azure\.search\.models\.IndexBatchBase\<T\>)/g, "com.azure.search.models.IndexBatchBase")

    # Change get to is
    - from: DocumentsImpl.java
      where: $
      transform: >-
          return $
          .replace(/(get(IncludeTotalResultCount|UseFuzzyMatching))/g, "is$2")

    # Mark IndexingResult as Serializable, for use in IndexBatchException
    - from: IndexingResult.java
      where: $
      transform: >-
          return $
          .replace(/(import com.fasterxml.jackson.annotation.JsonProperty;)/g, "$1\n\nimport java.io.Serializable;")
          .replace(/(class IndexingResult {)/g, "class IndexingResult implements Serializable {\n    private static final long serialVersionUID = -8604424005271188140L;")

    - from:
          - FacetResult.java
      where: $
      transform: >-
          return $.replace(/(public FacetResult setAdditionalProperties)/g, "FacetResult setAdditionalProperties")

    - from:
          - SearchResult.java
      where: $
      transform: >-
          return $.replace(/(public SearchResult setAdditionalProperties)/g, "SearchResult setAdditionalProperties")

    - from:
          - SuggestResult.java
      where: $
      transform: >-
          return $.replace(/(public SuggestResult setAdditionalProperties)/g, "SuggestResult setAdditionalProperties")

    - from:
          - SearchResult.java
          - SuggestResult.java
      where: $
      transform: >-
          return $
          .replace(/(getAdditionalProperties)/g, "getDocument")
          .replace(/(setAdditionalProperties)/g, "setDocument")
      reason: Provides a better description of the getter/setter for addtionalProperties

    - from:
          - SearchResult.java
      where: $
      transform: >-
          return $
          .replace(/(package com.azure.search.models;)/g, "$1\nimport com.fasterxml.jackson.annotation.JsonIgnore;")
          .replace(/(public Document getDocument())/g, "@JsonIgnore\n$1")

    # Add static Collection<DataType> method to DataType
    - from: DataType.java
      where: $
      transform: >-
        return $
        .replace(/(public static final DataType EDM_COMPLEX_TYPE = fromString\("Edm.ComplexType"\);)/g, "$1\n\n    /**\n     * Returns a collection of a specific DataType\n     * @param dataType the corresponding DataType\n     * @return a Collection of the corresponding DataType\n     */\n    @JsonCreator\n    public static DataType collection(DataType dataType) {\n        return fromString(String.format(\"Collection(%s)\", dataType.toString()));\n    }")

    # Workaround to fix bad host path parameters
    - from:
        - SkillsetsImpl.java
        - DatasetsImpl.java
        - DataSourcesImpl.java
        - IndexersImpl.java
        - IndexesImpl.java
        - SynonymMapsImpl.java
      where: $
      transform: >-
        return $
        .replace(/(import com\.azure\.search\.implementation\.models\.AccessCondition\;)/g, "import com.azure.core.http.MatchConditions;")
        .replace(/(this.getSearchServiceName)/g, "this.client.getSearchServiceName")
        .replace(/(this.getEndpoint)/g, "this.client.getEndpoint")
        .replace(/(this.getSearchDnsSuffix)/g, "this.client.getSearchDnsSuffix")
        .replace(/(AccessCondition)/g, "MatchConditions")

    # Add RestProxy import
    - from:
        - SearchServiceRestClientImpl.java
      where: $
      transform: >-
        return $.replace(/(package com.azure.search.implementation;)/g, "$1\nimport com.azure.core.http.rest.RestProxy;")

    # Rename COSMOS_DB to COSMOS in DataSourceType.java
    - from:
        - DataSourceType.java
      where: $
      transform: >-
        return $
        .replace(/(COSMOS_DB)/g, "COSMOS")
```
