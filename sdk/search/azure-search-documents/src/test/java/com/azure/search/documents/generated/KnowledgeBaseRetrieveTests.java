// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.azure.search.documents.generated;

import com.azure.search.documents.knowledgebase.models.KnowledgeBaseActivityRecord;
import com.azure.search.documents.knowledgebase.models.KnowledgeBaseActivityRecordType;
import com.azure.search.documents.knowledgebase.models.KnowledgeBaseMessage;
import com.azure.search.documents.knowledgebase.models.KnowledgeBaseMessageContent;
import com.azure.search.documents.knowledgebase.models.KnowledgeBaseMessageContentType;
import com.azure.search.documents.knowledgebase.models.KnowledgeBaseMessageTextContent;
import com.azure.search.documents.knowledgebase.models.KnowledgeBaseReference;
import com.azure.search.documents.knowledgebase.models.KnowledgeBaseReferenceType;
import com.azure.search.documents.knowledgebase.models.KnowledgeBaseRetrievalRequest;
import com.azure.search.documents.knowledgebase.models.KnowledgeBaseRetrievalResponse;
import com.azure.search.documents.knowledgebase.models.KnowledgeRetrievalLowReasoningEffort;
import com.azure.search.documents.knowledgebase.models.KnowledgeRetrievalOutputMode;
import com.azure.search.documents.knowledgebase.models.SearchIndexKnowledgeSourceParams;
import java.util.Arrays;
import java.util.List;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.Test;

@Disabled
public final class KnowledgeBaseRetrieveTests extends SearchClientTestBase {
    @Test
    @Disabled
    public void testKnowledgeBaseRetrieveTests() {
        // method invocation
        KnowledgeBaseRetrievalResponse response = knowledgeBaseRetrievalClient.retrieve("base-preview-test",
            new KnowledgeBaseRetrievalRequest()
                .setMessages(Arrays
                    .asList(new KnowledgeBaseMessage(Arrays.asList(new KnowledgeBaseMessageTextContent("hello world")))
                        .setRole("user")))
                .setMaxRuntimeInSeconds(60)
                .setMaxOutputSize(100000)
                .setRetrievalReasoningEffort(new KnowledgeRetrievalLowReasoningEffort())
                .setIncludeActivity(true)
                .setOutputMode(KnowledgeRetrievalOutputMode.ANSWER_SYNTHESIS)
                .setKnowledgeSourceParams(
                    Arrays.asList(new SearchIndexKnowledgeSourceParams("ks-preview-test").setIncludeReferences(true)
                        .setIncludeReferenceSourceData(true)
                        .setAlwaysQuerySource(false)
                        .setRerankerThreshold(2.1D)
                        .setFilterAddOn("foo eq bar"))),
            null);

        // response assertion
        Assertions.assertNotNull(response);
        // verify property "response"
        List<KnowledgeBaseMessage> responseResponse = response.getResponse();
        KnowledgeBaseMessage responseResponseFirstItem = responseResponse.iterator().next();
        Assertions.assertNotNull(responseResponseFirstItem);
        List<KnowledgeBaseMessageContent> responseResponseFirstItemContent = responseResponseFirstItem.getContent();
        KnowledgeBaseMessageContent responseResponseFirstItemContentFirstItem
            = responseResponseFirstItemContent.iterator().next();
        Assertions.assertNotNull(responseResponseFirstItemContentFirstItem);
        Assertions.assertEquals(KnowledgeBaseMessageContentType.TEXT,
            responseResponseFirstItemContentFirstItem.getType());
        // verify property "activity"
        List<KnowledgeBaseActivityRecord> responseActivity = response.getActivity();
        KnowledgeBaseActivityRecord responseActivityFirstItem = responseActivity.iterator().next();
        Assertions.assertNotNull(responseActivityFirstItem);
        Assertions.assertEquals(KnowledgeBaseActivityRecordType.MODEL_QUERY_PLANNING,
            responseActivityFirstItem.getType());
        Assertions.assertEquals(0, responseActivityFirstItem.getId());
        Assertions.assertEquals(10, responseActivityFirstItem.getElapsedMs());
        // verify property "references"
        List<KnowledgeBaseReference> responseReferences = response.getReferences();
        KnowledgeBaseReference responseReferencesFirstItem = responseReferences.iterator().next();
        Assertions.assertNotNull(responseReferencesFirstItem);
        Assertions.assertEquals(KnowledgeBaseReferenceType.SEARCH_INDEX, responseReferencesFirstItem.getType());
        Assertions.assertEquals("83dd7d40", responseReferencesFirstItem.getId());
        Assertions.assertEquals(1, responseReferencesFirstItem.getActivitySource());
        Assertions.assertNotNull(responseReferencesFirstItem.getSourceData());
        Assertions.assertEquals(3.5D, responseReferencesFirstItem.getRerankerScore());
    }
}
