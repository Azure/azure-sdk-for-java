// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.azure.search.documents.generated;

import com.azure.identity.DefaultAzureCredentialBuilder;
import com.azure.search.documents.indexes.SearchIndexClient;
import com.azure.search.documents.indexes.SearchIndexClientBuilder;
import com.azure.search.documents.indexes.models.AzureActiveDirectoryApplicationCredentials;
import com.azure.search.documents.indexes.models.AzureOpenAIModelName;
import com.azure.search.documents.indexes.models.AzureOpenAIVectorizerParameters;
import com.azure.search.documents.indexes.models.IndexedSharePointContainerName;
import com.azure.search.documents.indexes.models.IndexedSharePointKnowledgeSource;
import com.azure.search.documents.indexes.models.IndexedSharePointKnowledgeSourceParameters;
import com.azure.search.documents.indexes.models.IndexingSchedule;
import com.azure.search.documents.indexes.models.KnowledgeBaseAzureOpenAIModel;
import com.azure.search.documents.indexes.models.KnowledgeSource;
import com.azure.search.documents.indexes.models.KnowledgeSourceContentExtractionMode;
import com.azure.search.documents.indexes.models.KnowledgeSourceIngestionPermissionOption;
import com.azure.search.documents.indexes.models.SearchIndexerDataUserAssignedIdentity;
import com.azure.search.documents.indexes.models.SearchResourceEncryptionKey;
import com.azure.search.documents.knowledgebase.models.AIServices;
import com.azure.search.documents.knowledgebase.models.KnowledgeSourceAzureOpenAIVectorizer;
import com.azure.search.documents.knowledgebase.models.KnowledgeSourceIngestionParameters;
import java.time.Duration;
import java.time.OffsetDateTime;
import java.util.Arrays;

public class SearchServiceCreateKnowledgeSourceIndexedSharePoint {
    public static void main(String[] args) {
        SearchIndexClient searchIndexClient
            = new SearchIndexClientBuilder().credential(new DefaultAzureCredentialBuilder().build())
                .endpoint("https://previewexampleservice.search.windows.net")
                .buildClient();
        // BEGIN:com.azure.search.documents.generated.create-knowledge-source.search-service-create-knowledge-source-indexed-share-point
        KnowledgeSource response = searchIndexClient.createKnowledgeSource(new IndexedSharePointKnowledgeSource(
            "ks-preview-test",
            new IndexedSharePointKnowledgeSourceParameters(
                "DefaultEndpointsProtocol=https;AccountName=myAccountName;AccountKey=myAccountKey;EndpointSuffix=core.windows.net ",
                IndexedSharePointContainerName.DEFAULT_SITE_LIBRARY)
                    .setQuery("*.docx OR *.pdf")
                    .setIngestionParameters(new KnowledgeSourceIngestionParameters()
                        .setIdentity(new SearchIndexerDataUserAssignedIdentity("/my/userassigned/id"))
                        .setEmbeddingModel(new KnowledgeSourceAzureOpenAIVectorizer()
                            .setAzureOpenAIParameters(new AzureOpenAIVectorizerParameters()
                                .setResourceUrl("https://test-sample.openai.azure.com/")
                                .setDeploymentName("model")
                                .setApiKey("fakeTokenPlaceholder")
                                .setModelName(AzureOpenAIModelName.TEXT_EMBEDDING3LARGE)))
                        .setChatCompletionModel(new KnowledgeBaseAzureOpenAIModel(new AzureOpenAIVectorizerParameters()
                            .setResourceUrl("https://test-sample.openai.azure.com/")
                            .setDeploymentName("myDeployment")
                            .setApiKey("fakeTokenPlaceholder")
                            .setModelName(AzureOpenAIModelName.GPT4O_MINI)))
                        .setDisableImageVerbalization(false)
                        .setIngestionSchedule(new IndexingSchedule(Duration.parse("P1D"))
                            .setStartTime(OffsetDateTime.parse("2025-01-07T19:30:00Z")))
                        .setIngestionPermissionOptions(Arrays.asList(KnowledgeSourceIngestionPermissionOption.USER_IDS,
                            KnowledgeSourceIngestionPermissionOption.GROUP_IDS,
                            KnowledgeSourceIngestionPermissionOption.RBAC_SCOPE))
                        .setContentExtractionMode(KnowledgeSourceContentExtractionMode.STANDARD)
                        .setAiServices(
                            new AIServices("https://my-ai-service.azure.com/").setApiKey("fakeTokenPlaceholder"))))
                                .setDescription("Description of the SharePoint knowledge source.")
                                .setEncryptionKey(
                                    new SearchResourceEncryptionKey("fakeTokenPlaceholder", "fakeTokenPlaceholder")
                                        .setKeyVersion("fakeTokenPlaceholder")
                                        .setAccessCredentials(new AzureActiveDirectoryApplicationCredentials(
                                            "00000000-0000-0000-0000-000000000000")
                                                .setApplicationSecret("fakeTokenPlaceholder"))));
        // END:com.azure.search.documents.generated.create-knowledge-source.search-service-create-knowledge-source-indexed-share-point
    }
}
