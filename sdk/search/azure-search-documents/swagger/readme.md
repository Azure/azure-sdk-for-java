# Azure Search Documents for Java
    
> see https://aka.ms/autorest

This is the AutoRest configuration file for SearchServiceClient and SearchIndexClient.
---
## Getting Started 

To build the SDK for SearchServiceClient and SearchIndexClient, simply [Install AutoRest](https://aka.ms/autorest/install) and in this folder, run:

> `autorest`

To see additional help and options, run:

> `autorest --help`
---

---
### Generation

There are two swaggers for search: index and service. They always under same package version, e.g. `--tag=package-2019-05-searchindex-preview` and `--tag=package-2019-05-searchservice-preview`.

```ps
cd <swagger-folder>
autorest --use=@microsoft.azure/autorest.java@3.0.3 --tag=${package} --version=2.0.4413 
```

e.g.
```ps
cd <swagger-folder>
autorest --use=@microsoft.azure/autorest.java@3.0.3 --tag=package-2019-05-searchindex-preview --version=2.0.4413 
autorest --use=@microsoft.azure/autorest.java@3.0.3 --tag=package-2019-05-searchservice-preview --version=2.0.4413 
```
## Configuration

### Basic Information 
These are the global settings for SearchServiceClient and SearchIndexClient.

``` yaml
opt-in-extensible-enums: true
openapi-type: data-plane
```

### Tag: package-2019-05-searchservice-preview

These settings apply only when `--tag=package-2019-05-searchservice-preview` is specified on the command line.

``` yaml $(tag) == 'package-2019-05-searchservice-preview'
namespace: com.azure.search.documents.indexes
input-file:
- https://github.com/Azure/azure-rest-api-specs/blob/master/specification/search/data-plane/Azure.Search/preview/2019-05-06-preview/searchservice.json
title: SearchServiceRestClient
models-subpackage: implementation.models
custom-types-subpackage: models
```

### Tag: package-2019-05-searchindex-preview

These settings apply only when `--tag=package-2019-05-searchindex-preview` is specified on the command line.

``` yaml $(tag) == 'package-2019-05-searchindex-preview'
namespace: com.azure.search.documents
input-file:
- https://github.com/Azure/azure-rest-api-specs/blob/master/specification/search/data-plane/Azure.Search/preview/2019-05-06-preview/searchindex.json
title: SearchIndexRestClient
models-subpackage: implementation.models
custom-types-subpackage: models
```

### Tag: package-2019-05-searchservice

These settings apply only when `--tag=package-2019-05-searchservice` is specified on the command line.

``` yaml $(tag) == 'package-2019-05-searchservice'
input-file:
- https://github.com/Azure/azure-rest-api-specs/blob/master/specification/search/data-plane/Azure.Search/stable/2019-05-06/searchservice.json
```

### Tag: package-2019-05-searchindex

These settings apply only when `--tag=package-2019-05-searchindex` is specified on the command line.

``` yaml $(tag) == 'package-2019-05-searchindex'
input-file:
- https://github.com/Azure/azure-rest-api-specs/blob/master/specification/search/data-plane/Azure.Search/stable/2019-05-06/searchindex.json
```

---
# Code Generation

!!! READ THIS !!!
This swagger is ready for C# and Java.
!!! READ THIS !!!

## Java

``` yaml
output-folder: ../
java: true
sync-methods: none
add-context-parameter: true
generate-client-interfaces: false
license-header: |-
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the MIT License.
  Code generated by Microsoft (R) AutoRest Code Generator.
  Changes may cause incorrect behavior and will be lost if the code is regenerated.

vararg-properties: >-
  AutocompleteOptions.searchFields,
  SearchOptions.facets, SearchOptions.highlightFields, SearchOptions.orderBy, SearchOptions.scoringParameters, SearchOptions.searchFields, SearchOptions.select,
  SuggestOptions.orderBy, SuggestOptions.searchFields, SuggestOptions.select, CorsOptions.allowedOrigins
```

``` yaml $(java)
directive:
    # Change DocumentsImpl to take Accept header parameter
    - from: DocumentsImpl.java
      where: $
      transform: >-
          return $
          .replace(/(\@HostParam\(\"indexName\"\) String indexName)/g, "$1\, @HeaderParam\(\"accept\"\) String accept")
          .replace(/(this.client.getIndexName\(\),)/g, "$1 accept,")
          .replace(/(public Mono\<(.*)\) \{)/g, "$1\n\t\tfinal String accept \= \"application\/json\;odata\.metadata\=none\"\;\n")

    - from: 
        - DataSourcesImpl.java
        - IndexersImpl.java
        - IndexesImpl.java
        - SkillsetsImpl.java
        - SynonymMapsImpl.java
      where: $
      transform: >-
          return $
          .replace(/(\@QueryParam\(\"api\-version\"\) String apiVersion)/g, "$1\, @HeaderParam\(\"accept\"\) String accept")
          .replace(/(this\.client\.getApiVersion\(\)\,)/g, "$1 accept,")
          .replace(/(public Mono\<(.*)\) \{)/g, "$1\n\t\tfinal String accept \= \"application\/json\;odata\.metadata\=minimal\"\;\n")

    # Enable configuration of RestProxy serializer
    - from: DocumentsImpl.java
      where: $
      transform: >-
          return $
          .replace(/(import com.azure.core.util.serializer.JacksonAdapter;)/g, "$1\nimport com.azure.core.util.serializer.SerializerAdapter;")
          .replace(/(import java.util.List;)/g, "$1\nimport java.util.Map;")
          .replace(/(Mono\<SimpleResponse\<Object\>\>)/g, "Mono<SimpleResponse<Map<? extends String, Object>>>")
          .replace(/(@param client the instance of the service client containing this operation class.)/g, "$1\n     \* @param serializer the serializer to be used for service client requests.")
          .replace(/(public DocumentsImpl\(SearchIndexRestClientImpl client\) {)/g, "public DocumentsImpl(SearchIndexRestClientImpl client, SerializerAdapter serializer) {")
          .replace(/(this.service = RestProxy.create\(DocumentsService.class, client.getHttpPipeline\(\)\);)/g, "this.service = RestProxy.create(DocumentsService.class, client.getHttpPipeline(), serializer);")

    # Enable configuration of RestProxy serializer
    - from: SearchIndexRestClientImpl.java
      where: $
      transform: >-
          return $
          .replace(/(void setApiVersion)/g, "public void setApiVersion")
          .replace(/(void setIndexName)/g, "public void setIndexName")
          .replace(/(void setSearchDnsSuffix)/g, "public void setSearchDnsSuffix")
          .replace(/(void setSearchServiceName)/g, "public void setSearchServiceName")
          .replace(/(package com.azure.search.documents.implementation;)/g, "$1\nimport com.azure.core.util.serializer.JacksonAdapter;\nimport com.azure.core.util.serializer.SerializerAdapter;")
          .replace(/(this\(RestProxy.createDefaultPipeline\(\)\);)/g, "this(RestProxy.createDefaultPipeline(), JacksonAdapter.createDefaultSerializerAdapter());")
          .replace(/(@param httpPipeline The HTTP pipeline to send requests through.)/g, "$1\n     \* @param serializer the serializer to be used for service client requests.")
          .replace(/(this\(new HttpPipelineBuilder\(\)\.policies\(new UserAgentPolicy\(\)\, new RetryPolicy\(\)\, new CookiePolicy\(\)\)\.build\(\)\)\;)/g, "this(new HttpPipelineBuilder().policies(new UserAgentPolicy(), new RetryPolicy(), new CookiePolicy()).build(), new JacksonAdapter());")
          .replace(/(public SearchIndexRestClientImpl\(HttpPipeline httpPipeline\) {)/g, "public SearchIndexRestClientImpl(HttpPipeline httpPipeline, SerializerAdapter serializer) {")
          .replace(/(this.documents = new DocumentsImpl\(this\);)/g, "this.documents = new DocumentsImpl(this, serializer);")

    # Enable configuration of RestProxy serializer
    - from: SearchIndexRestClientBuilder.java
      where: $
      transform: >-
          return $
          .replace(/(package com.azure.search.documents.implementation;)/g, "$1\nimport com.azure.core.util.serializer.SerializerAdapter;")
          .replace(/(\* The HTTP pipeline to send requests through)/g, "\* The serializer to use for requests\n     \*\/\n    private SerializerAdapter serializer;\n\n    \/\*\*\n     \* Sets The serializer to use for requests.\n     \*\n     \* @param serializer the serializer value.\n     \* @return the SearchIndexRestClientBuilder.\n     \*\/\n    public SearchIndexRestClientBuilder serializer\(SerializerAdapter serializer\) {\n        this.serializer = serializer;\n        return this;\n    }\n\n    \/\*\n     $1")
          .replace(/(new SearchIndexRestClientImpl\(pipeline)/g, "$1, serializer")
          .replace(/(this.pipeline = RestProxy.createDefaultPipeline\(\);\s+})/g, "$1\n        if \(serializer == null\) {\n            this.serializer = JacksonAdapter.createDefaultSerializerAdapter\(\);\n        }")
    
    # Workaround to fix bad host path parameters
    - from:
        - SkillsetsImpl.java
        - DatasetsImpl.java
        - DataSourcesImpl.java
        - IndexersImpl.java
        - IndexesImpl.java
        - SynonymMapsImpl.java
      where: $
      transform: >-
        return $
        .replace(/(this.getSearchServiceName)/g, "this.client.getSearchServiceName")
        .replace(/(this.getEndpoint)/g, "this.client.getEndpoint")
        .replace(/(this.getSearchDnsSuffix)/g, "this.client.getSearchDnsSuffix")

    # Add RestProxy import
    - from:
        - SearchServiceRestClientImpl.java
      where: $
      transform: >-
        return $.replace(/(package com.azure.search.documents.implementation;)/g, "$1\nimport com.azure.core.http.rest.RestProxy;")

    # Add @JsonAnyGetter for IndexAction.java
    - from: IndexAction.java
      where: $
      transform: >-
        return $
        .replace(/(import com\.azure\.core\.annotation\.Fluent\;)/g, "$1\nimport com.fasterxml.jackson.annotation.JsonAnyGetter;")
        .replace(/(    public Map\<String\, Object\> getAdditionalProperties\(\) \{)/g, "    @JsonAnyGetter\n$1")
```
