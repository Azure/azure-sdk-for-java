// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) AutoRest Code Generator.

package com.azure.resourcemanager.billing.generated;

import com.azure.core.credential.AccessToken;
import com.azure.core.http.HttpClient;
import com.azure.core.http.rest.PagedIterable;
import com.azure.core.management.AzureEnvironment;
import com.azure.core.management.profile.AzureProfile;
import com.azure.core.test.http.MockHttpResponse;
import com.azure.resourcemanager.billing.BillingManager;
import com.azure.resourcemanager.billing.models.Invoice;
import java.nio.charset.StandardCharsets;
import java.time.OffsetDateTime;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import reactor.core.publisher.Mono;

public final class InvoicesListByBillingSubscriptionMockTests {
    @Test
    public void testListByBillingSubscription() throws Exception {
        String responseStr
            = "{\"value\":[{\"properties\":{\"amountDue\":{\"currency\":\"wvkuhtdxdcodzdh\",\"value\":72.48501},\"azurePrepaymentApplied\":{\"currency\":\"vmxiundifuahtk\",\"value\":7.5689135},\"billedAmount\":{\"currency\":\"srz\",\"value\":37.18018},\"billedDocumentId\":\"odyafayxnlv\",\"billingProfileDisplayName\":\"p\",\"billingProfileId\":\"awsl\",\"creditAmount\":{\"currency\":\"lbxnnynjt\",\"value\":87.91529},\"creditForDocumentId\":\"pel\",\"documents\":[{\"documentNumbers\":[\"vdbn\"],\"externalUrl\":\"rc\",\"kind\":\"TaxReceipt\",\"name\":\"xliqcbonqjoekcjc\",\"url\":\"vobctit\",\"source\":\"ENF\"},{\"documentNumbers\":[\"lvkfdqilprqhxfq\",\"qp\"],\"externalUrl\":\"rqlazfjltckbjvd\",\"kind\":\"TaxReceipt\",\"name\":\"vqtdex\",\"url\":\"zpxalkqlvbkz\",\"source\":\"Other\"},{\"documentNumbers\":[\"ww\",\"iviniyoizuwwzc\",\"igbjbelnqalbso\",\"xajsiueai\"],\"externalUrl\":\"jbizbwxuypcu\",\"kind\":\"Invoice\",\"name\":\"lxtclveqdqt\",\"url\":\"hwlwj\",\"source\":\"Other\"},{\"documentNumbers\":[\"ysghhcmqdlkkw\",\"dekbvdulmkaadnxb\"],\"externalUrl\":\"atpialrqhwcxxccf\",\"kind\":\"Summary\",\"name\":\"za\",\"url\":\"vrexitpzri\",\"source\":\"Other\"}],\"documentType\":\"Invoice\",\"dueDate\":\"2021-08-22T21:13:55Z\",\"failedPayments\":[{\"date\":\"2021-09-23T05:02:16Z\",\"failedPaymentReason\":\"BankDeclined\"},{\"date\":\"2021-09-24T17:44:35Z\",\"failedPaymentReason\":\"IncorrectCardDetails\"},{\"date\":\"2021-10-31T17:34:56Z\",\"failedPaymentReason\":\"BankDeclined\"}],\"freeAzureCreditApplied\":{\"currency\":\"jkhmsobua\",\"value\":8.937472},\"invoiceDate\":\"2021-06-19T03:49:14Z\",\"invoicePeriodEndDate\":\"2021-07-27T03:25:21Z\",\"invoicePeriodStartDate\":\"2021-03-07T11:05:38Z\",\"invoiceType\":\"Other\",\"isMonthlyInvoice\":false,\"payments\":[{\"amount\":{\"currency\":\"c\",\"value\":59.074028},\"date\":\"2021-04-27T06:51:32Z\",\"paymentMethodId\":\"w\",\"paymentMethodFamily\":\"None\",\"paymentMethodType\":\"zdoysmzg\",\"paymentType\":\"gdjwuybcppdvuo\"}],\"purchaseOrderNumber\":\"vk\",\"rebillDetails\":{\"invoiceDocumentId\":\"kupbnkcw\",\"creditNoteDocumentId\":\"ylkbdskrpyfrtl\",\"rebillDetails\":{\"invoiceDocumentId\":\"fqzylem\",\"creditNoteDocumentId\":\"hyuxxeike\",\"rebillDetails\":{\"invoiceDocumentId\":\"wrnh\",\"creditNoteDocumentId\":\"fuvvy\",\"rebillDetails\":{}}}},\"status\":\"Due\",\"subscriptionDisplayName\":\"xgfmesxjeqqfynv\",\"subscriptionId\":\"xtan\",\"specialTaxationType\":\"InvoiceLevel\",\"subTotal\":{\"currency\":\"vzhdncqcuwt\",\"value\":44.25586},\"taxAmount\":{\"currency\":\"lnolspvxpi\",\"value\":16.192787},\"totalAmount\":{\"currency\":\"dvatptzkmfvdrkcw\",\"value\":68.58224},\"refundDetails\":{\"requestedOn\":\"2021-12-03T07:08:10Z\",\"approvedOn\":\"2021-03-27T19:08:29Z\",\"completedOn\":\"2021-12-10T13:36:44Z\",\"amountRequested\":{\"currency\":\"dfrzzxirxxkmozkd\",\"value\":20.382553},\"amountRefunded\":{\"currency\":\"kivvpyznjwmd\",\"value\":94.45917},\"rebillInvoiceId\":\"yjbzzws\",\"transactionCount\":952579976,\"refundStatus\":\"Declined\",\"refundOperationId\":\"tvofgx\",\"refundReason\":\"UnclearDocumentation\"}},\"tags\":{\"kubwkdi\":\"csoaxcmepkpxtbxy\",\"wetwwjv\":\"slnbyi\",\"ityantecv\":\"ycygcvgebf\",\"eciexsc\":\"tkgopdjqnsicucq\"},\"id\":\"zhjjlypwgwbycfam\",\"name\":\"ikisppygothi\",\"type\":\"irhhbogxw\"}]}";

        HttpClient httpClient
            = response -> Mono.just(new MockHttpResponse(response, 200, responseStr.getBytes(StandardCharsets.UTF_8)));
        BillingManager manager = BillingManager.configure()
            .withHttpClient(httpClient)
            .authenticate(tokenRequestContext -> Mono.just(new AccessToken("this_is_a_token", OffsetDateTime.MAX)),
                new AzureProfile("", "", AzureEnvironment.AZURE));

        PagedIterable<Invoice> response = manager.invoices()
            .listByBillingSubscription(null, null, "nrwffzzmxqyjys", "jpy", 3355744504373660268L, 59397306426461440L,
                false, "kzmsyezxifjuvhuo", com.azure.core.util.Context.NONE);

        Assertions.assertEquals("csoaxcmepkpxtbxy", response.iterator().next().tags().get("kubwkdi"));
    }
}
