trigger: none

extends:
  template: /eng/pipelines/templates/stages/1es-redirect.yml
  parameters:
    stages:
      - template: /eng/pipelines/templates/stages/archetype-sdk-tests-isolated.yml
        parameters:
          TestName: 'Kafka_TestContainer_Integration'
          CloudConfig:
            Public:
              SubscriptionConfigurations:
                - $(sub-config-azure-cloud-test-resources)
                - $(sub-config-cosmos-azure-cloud-test-resources)
          MatrixConfigs:
            - Name: Kafka_TestContainer_Integration_Test
              Path: sdk/cosmos/kafka-testcontainer-matrix.json
              Selection: all
              GenerateVMJobs: true
          ServiceDirectory: cosmos
          Artifacts:
            - name: azure-cosmos-kafka-connect
              groupId: com.azure.cosmos.kafka
              safeName: azurecosmoskafkaconnect
          TimeoutInMinutes: 120
          PreSteps:
            - task: DockerInstaller@0
              displayName: "Intalling docker"
          TestGoals: 'clean verify'
          TestOptions: '$(ProfileFlag) $(AdditionalArgs) -DskipCompile=true -DskipTestCompile=true -DcreateSourcesJar=false'
          AdditionalVariables:
            - name: TenantId
              value: '72f988bf-86f1-41af-91ab-2d7cd011db47'
            - name: AdditionalArgs
              value: '-DACCOUNT_TENANT_ID=$(TenantId) -DACCOUNT_AAD_CLIENT_ID=$(spark-databricks-cosmos-spn-clientId) -DACCOUNT_AAD_CLIENT_SECRET=$(spark-databricks-cosmos-spn-clientSecret)'
