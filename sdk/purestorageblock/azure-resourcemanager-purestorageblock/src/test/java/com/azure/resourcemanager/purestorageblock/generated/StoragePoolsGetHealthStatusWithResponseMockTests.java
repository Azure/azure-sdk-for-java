// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.azure.resourcemanager.purestorageblock.generated;

import com.azure.core.credential.AccessToken;
import com.azure.core.http.HttpClient;
import com.azure.core.management.profile.AzureProfile;
import com.azure.core.models.AzureCloud;
import com.azure.core.test.http.MockHttpResponse;
import com.azure.resourcemanager.purestorageblock.PureStorageBlockManager;
import com.azure.resourcemanager.purestorageblock.models.AlertLevel;
import com.azure.resourcemanager.purestorageblock.models.StoragePoolHealthInfo;
import java.nio.charset.StandardCharsets;
import java.time.OffsetDateTime;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import reactor.core.publisher.Mono;

public final class StoragePoolsGetHealthStatusWithResponseMockTests {
    @Test
    public void testGetHealthStatusWithResponse() throws Exception {
        String responseStr
            = "{\"health\":{\"usedCapacityPercentage\":37.904659906955786,\"bandwidthUsage\":{\"current\":3561845794707371131,\"provisioned\":5142901389847761375,\"max\":3428056516697378704},\"iopsUsage\":{\"current\":2089848727273246662,\"provisioned\":2395973517654166674,\"max\":1210801517644379605},\"space\":{\"totalUsed\":8144209061033072751,\"unique\":1627513098218533241,\"snapshots\":195420941787005324,\"shared\":5700722260986013528},\"dataReductionRatio\":88.61506404849831,\"estimatedMaxCapacity\":1833714202725458886},\"alerts\":[{\"level\":\"info\",\"message\":\"iaa\"},{\"level\":\"warning\",\"message\":\"uagydwqfbylyrf\"}]}";

        HttpClient httpClient
            = response -> Mono.just(new MockHttpResponse(response, 200, responseStr.getBytes(StandardCharsets.UTF_8)));
        PureStorageBlockManager manager = PureStorageBlockManager.configure()
            .withHttpClient(httpClient)
            .authenticate(tokenRequestContext -> Mono.just(new AccessToken("this_is_a_token", OffsetDateTime.MAX)),
                new AzureProfile("", "", AzureCloud.AZURE_PUBLIC_CLOUD));

        StoragePoolHealthInfo response = manager.storagePools()
            .getHealthStatusWithResponse("lefaxvxilcbtgn", "nzeyqxtjj", com.azure.core.util.Context.NONE)
            .getValue();

        Assertions.assertEquals(37.904659906955786, response.health().usedCapacityPercentage());
        Assertions.assertEquals(3561845794707371131L, response.health().bandwidthUsage().current());
        Assertions.assertEquals(5142901389847761375L, response.health().bandwidthUsage().provisioned());
        Assertions.assertEquals(3428056516697378704L, response.health().bandwidthUsage().max());
        Assertions.assertEquals(2089848727273246662L, response.health().iopsUsage().current());
        Assertions.assertEquals(2395973517654166674L, response.health().iopsUsage().provisioned());
        Assertions.assertEquals(1210801517644379605L, response.health().iopsUsage().max());
        Assertions.assertEquals(8144209061033072751L, response.health().space().totalUsed());
        Assertions.assertEquals(1627513098218533241L, response.health().space().unique());
        Assertions.assertEquals(195420941787005324L, response.health().space().snapshots());
        Assertions.assertEquals(5700722260986013528L, response.health().space().shared());
        Assertions.assertEquals(88.61506404849831, response.health().dataReductionRatio());
        Assertions.assertEquals(1833714202725458886L, response.health().estimatedMaxCapacity());
        Assertions.assertEquals(AlertLevel.INFO, response.alerts().get(0).level());
        Assertions.assertEquals("iaa", response.alerts().get(0).message());
    }
}
