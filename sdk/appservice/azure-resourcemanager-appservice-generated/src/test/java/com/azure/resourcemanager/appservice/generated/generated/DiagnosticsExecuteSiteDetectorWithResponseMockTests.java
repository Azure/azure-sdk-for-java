// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) AutoRest Code Generator.

package com.azure.resourcemanager.appservice.generated.generated;

import com.azure.core.credential.AccessToken;
import com.azure.core.http.HttpClient;
import com.azure.core.management.AzureEnvironment;
import com.azure.core.management.profile.AzureProfile;
import com.azure.core.test.http.MockHttpResponse;
import com.azure.resourcemanager.appservice.generated.AppServiceManager;
import com.azure.resourcemanager.appservice.generated.models.DiagnosticDetectorResponse;
import com.azure.resourcemanager.appservice.generated.models.IssueType;
import java.nio.charset.StandardCharsets;
import java.time.OffsetDateTime;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import reactor.core.publisher.Mono;

public final class DiagnosticsExecuteSiteDetectorWithResponseMockTests {
    @Test
    public void testExecuteSiteDetectorWithResponse() throws Exception {
        String responseStr
            = "{\"properties\":{\"startTime\":\"2021-05-29T14:37:09Z\",\"endTime\":\"2021-07-25T22:02:59Z\",\"issueDetected\":false,\"detectorDefinition\":{\"displayName\":\"zvxleztmdybx\",\"description\":\"j\",\"rank\":38.38888639602595,\"isEnabled\":false},\"metrics\":[{\"name\":\"xspgh\",\"unit\":\"kqijmyqosrsf\",\"startTime\":\"2021-02-05T19:05:40Z\",\"endTime\":\"2021-01-07T00:06:57Z\",\"timeGrain\":\"rr\",\"values\":[{},{},{},{}]},{\"name\":\"ohnmruvvlwhtfsc\",\"unit\":\"psfey\",\"startTime\":\"2021-12-07T08:22:37Z\",\"endTime\":\"2021-10-22T12:13:09Z\",\"timeGrain\":\"wkwcfkcqexdwecvk\",\"values\":[{},{},{}]},{\"name\":\"otfun\",\"unit\":\"uejxvrwalekqedof\",\"startTime\":\"2021-04-25T09:14:30Z\",\"endTime\":\"2021-01-20T20:12:25Z\",\"timeGrain\":\"ai\",\"values\":[{},{},{}]},{\"name\":\"lpfjibb\",\"unit\":\"ihvzdaycme\",\"startTime\":\"2021-09-28T10:19:30Z\",\"endTime\":\"2021-05-26T21:51:51Z\",\"timeGrain\":\"l\",\"values\":[{},{},{},{}]}],\"abnormalTimePeriods\":[{\"startTime\":\"2021-06-07T09:06:29Z\",\"endTime\":\"2021-11-30T17:15:05Z\",\"message\":\"wbbellcjd\",\"source\":\"pcvddfmfl\",\"priority\":66.04998343837532,\"metaData\":[[{},{}],[{}],[{},{},{}]],\"type\":\"ServiceIncident\",\"solutions\":[{}]},{\"startTime\":\"2021-09-02T02:40:12Z\",\"endTime\":\"2021-01-25T22:46:46Z\",\"message\":\"twxifudlrx\",\"source\":\"uftpv\",\"priority\":94.9530917406193,\"metaData\":[[{},{},{},{}],[{},{}]],\"type\":\"AppCrash\",\"solutions\":[{},{},{}]},{\"startTime\":\"2021-01-31T08:41:53Z\",\"endTime\":\"2021-11-11T13:26:42Z\",\"message\":\"qsf\",\"source\":\"e\",\"priority\":14.151059893550244,\"metaData\":[[{},{},{},{}],[{},{},{}],[{},{},{},{}],[{},{},{}]],\"type\":\"RuntimeIssueDetected\",\"solutions\":[{},{},{}]}],\"data\":[[{\"name\":\"vrbqxisavktuxw\",\"value\":\"l\"},{\"name\":\"bridagwuvcdymoqv\",\"value\":\"krynziudmhed\"},{\"name\":\"ygwagvuioxjwztr\",\"value\":\"tll\"}],[{\"name\":\"vhf\",\"value\":\"ccffsbz\"},{\"name\":\"tfxq\",\"value\":\"j\"}]],\"responseMetaData\":{\"dataSource\":{\"instructions\":[\"ct\",\"a\",\"bchpzvqzm\"],\"dataSourceUri\":[{},{},{},{}]}}},\"kind\":\"jwhonnqudexnicq\",\"id\":\"lfqttf\",\"name\":\"gdoowgqooiphhsv\",\"type\":\"nedhkjiwfvetwfr\"}";

        HttpClient httpClient
            = response -> Mono.just(new MockHttpResponse(response, 200, responseStr.getBytes(StandardCharsets.UTF_8)));
        AppServiceManager manager = AppServiceManager.configure()
            .withHttpClient(httpClient)
            .authenticate(tokenRequestContext -> Mono.just(new AccessToken("this_is_a_token", OffsetDateTime.MAX)),
                new AzureProfile("", "", AzureEnvironment.AZURE));

        DiagnosticDetectorResponse response = manager.diagnostics()
            .executeSiteDetectorWithResponse("anmhvwgchgpbd", "qwgoomapc", "xn", "qnj",
                OffsetDateTime.parse("2021-01-06T14:00:07Z"), OffsetDateTime.parse("2021-11-16T15:39:07Z"),
                "qvectooxjztta", com.azure.core.util.Context.NONE)
            .getValue();

        Assertions.assertEquals("jwhonnqudexnicq", response.kind());
        Assertions.assertEquals(OffsetDateTime.parse("2021-05-29T14:37:09Z"), response.startTime());
        Assertions.assertEquals(OffsetDateTime.parse("2021-07-25T22:02:59Z"), response.endTime());
        Assertions.assertEquals(false, response.issueDetected());
        Assertions.assertEquals("xspgh", response.metrics().get(0).name());
        Assertions.assertEquals("kqijmyqosrsf", response.metrics().get(0).unit());
        Assertions.assertEquals(OffsetDateTime.parse("2021-02-05T19:05:40Z"), response.metrics().get(0).startTime());
        Assertions.assertEquals(OffsetDateTime.parse("2021-01-07T00:06:57Z"), response.metrics().get(0).endTime());
        Assertions.assertEquals("rr", response.metrics().get(0).timeGrain());
        Assertions.assertEquals(OffsetDateTime.parse("2021-06-07T09:06:29Z"),
            response.abnormalTimePeriods().get(0).startTime());
        Assertions.assertEquals(OffsetDateTime.parse("2021-11-30T17:15:05Z"),
            response.abnormalTimePeriods().get(0).endTime());
        Assertions.assertEquals("wbbellcjd", response.abnormalTimePeriods().get(0).message());
        Assertions.assertEquals("pcvddfmfl", response.abnormalTimePeriods().get(0).source());
        Assertions.assertEquals(66.04998343837532D, response.abnormalTimePeriods().get(0).priority());
        Assertions.assertEquals(IssueType.SERVICE_INCIDENT, response.abnormalTimePeriods().get(0).type());
        Assertions.assertEquals("vrbqxisavktuxw", response.data().get(0).get(0).name());
        Assertions.assertEquals("l", response.data().get(0).get(0).value());
        Assertions.assertEquals("ct", response.responseMetadata().dataSource().instructions().get(0));
    }
}
