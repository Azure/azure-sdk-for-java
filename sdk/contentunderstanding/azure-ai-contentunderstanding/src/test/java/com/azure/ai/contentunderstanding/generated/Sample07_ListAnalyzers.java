// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.azure.ai.contentunderstanding.generated;

import com.azure.ai.contentunderstanding.ContentUnderstandingClient;
import com.azure.ai.contentunderstanding.ContentUnderstandingClientBuilder;
import com.azure.ai.contentunderstanding.models.ContentAnalyzer;
import com.azure.core.credential.AzureKeyCredential;
import com.azure.core.http.rest.PagedIterable;
import com.azure.core.util.Configuration;
import com.azure.identity.DefaultAzureCredentialBuilder;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.*;

/**
 * Sample demonstrating how to list all analyzers.
 * This sample shows:
 * 1. Listing all available analyzers (both prebuilt and custom)
 * 2. Filtering analyzers by status
 * 3. Iterating through paginated results
 * 4. Displaying analyzer properties
 */
public class Sample07_ListAnalyzers {

    @Test
    public void testListAnalyzersAsync() {
        // BEGIN: com.azure.ai.contentunderstanding.buildClient
        String endpoint = Configuration.getGlobalConfiguration().get("CONTENTUNDERSTANDING_ENDPOINT");
        String key = System.getenv("AZURE_CONTENT_UNDERSTANDING_KEY");

        // Build the client with appropriate authentication
        ContentUnderstandingClientBuilder builder = new ContentUnderstandingClientBuilder()
            .endpoint(endpoint);

        ContentUnderstandingClient client;
        if (key != null && !key.trim().isEmpty()) {
            // Use API key authentication
            client = builder.credential(new AzureKeyCredential(key)).buildClient();
        } else {
            // Use default Azure credential (for managed identity, Azure CLI, etc.)
            client = builder.credential(new DefaultAzureCredentialBuilder().build()).buildClient();
        }
        // END: com.azure.ai.contentunderstanding.buildClient

        // Verify client initialization
        assertNotNull(endpoint, "CONTENTUNDERSTANDING_ENDPOINT environment variable should be set");
        assertFalse(endpoint.trim().isEmpty(), "Endpoint should not be empty");
        assertNotNull(client, "Client should be successfully created");

        // BEGIN:ContentUnderstandingListAnalyzers
        // List all analyzers
        PagedIterable<ContentAnalyzer> analyzers = client.listAnalyzers();

        System.out.println("Listing all analyzers:");
        System.out.println("======================");

        int count = 0;
        int prebuiltCount = 0;
        int customCount = 0;

        for (ContentAnalyzer analyzer : analyzers) {
            count++;

            // Determine if this is a prebuilt or custom analyzer
            boolean isPrebuilt = analyzer.getAnalyzerId().startsWith("prebuilt-");
            if (isPrebuilt) {
                prebuiltCount++;
            } else {
                customCount++;
            }

            System.out.println("\nAnalyzer #" + count + ":");
            System.out.println("  ID: " + analyzer.getAnalyzerId());
            System.out.println("  Type: " + (isPrebuilt ? "Prebuilt" : "Custom"));

            if (analyzer.getDescription() != null && !analyzer.getDescription().trim().isEmpty()) {
                System.out.println("  Description: " + analyzer.getDescription());
            }

            if (analyzer.getBaseAnalyzerId() != null) {
                System.out.println("  Base Analyzer: " + analyzer.getBaseAnalyzerId());
            }

            if (analyzer.getStatus() != null) {
                System.out.println("  Status: " + analyzer.getStatus());
            }

            if (analyzer.getCreatedAt() != null) {
                System.out.println("  Created: " + analyzer.getCreatedAt());
            }

            if (analyzer.getLastModifiedAt() != null) {
                System.out.println("  Last Modified: " + analyzer.getLastModifiedAt());
            }

            // Display field schema summary if available
            if (analyzer.getFieldSchema() != null && analyzer.getFieldSchema().getFields() != null) {
                System.out.println("  Fields: " + analyzer.getFieldSchema().getFields().size() + " field(s) defined");
            }

            // Display tags if available
            if (analyzer.getTags() != null && !analyzer.getTags().isEmpty()) {
                System.out.println("  Tags: " + analyzer.getTags().size() + " tag(s)");
            }
        }

        System.out.println("\n======================");
        System.out.println("Total analyzers: " + count);
        System.out.println("  Prebuilt: " + prebuiltCount);
        System.out.println("  Custom: " + customCount);
        // END:ContentUnderstandingListAnalyzers

        // BEGIN:Assertion_ContentUnderstandingListAnalyzers
        Assertions.assertNotNull(analyzers, "Analyzers list should not be null");
        System.out.println("\nAnalyzers list retrieved successfully");

        // Verify we have at least the prebuilt analyzers
        Assertions.assertTrue(count > 0, "Should have at least one analyzer");
        Assertions.assertTrue(prebuiltCount > 0, "Should have at least one prebuilt analyzer");
        System.out.println("Verified: Found " + count + " total analyzer(s)");
        System.out.println("Verified: Found " + prebuiltCount + " prebuilt analyzer(s)");
        if (customCount > 0) {
            System.out.println("Verified: Found " + customCount + " custom analyzer(s)");
        }

        // Verify each analyzer has required properties
        int validatedCount = 0;
        for (ContentAnalyzer analyzer : analyzers) {
            Assertions.assertNotNull(analyzer.getAnalyzerId(), "Analyzer ID should not be null");
            Assertions.assertFalse(analyzer.getAnalyzerId().trim().isEmpty(), "Analyzer ID should not be empty");
            Assertions.assertNotNull(analyzer.getStatus(), "Analyzer status should not be null");
            validatedCount++;

            // Only validate first few to avoid excessive output
            if (validatedCount >= 5) {
                break;
            }
        }

        System.out.println("All analyzer list properties validated successfully");
        // END:Assertion_ContentUnderstandingListAnalyzers
    }

    @Test
    public void testListAnalyzersWithMaxResultsAsync() {
        // Create the Content Understanding client
        String endpoint = Configuration.getGlobalConfiguration().get("CONTENTUNDERSTANDING_ENDPOINT");
        String key = System.getenv("AZURE_CONTENT_UNDERSTANDING_KEY");

        ContentUnderstandingClientBuilder builder = new ContentUnderstandingClientBuilder()
            .endpoint(endpoint);

        ContentUnderstandingClient client;
        if (key != null && !key.trim().isEmpty()) {
            client = builder.credential(new AzureKeyCredential(key)).buildClient();
        } else {
            client = builder.credential(new DefaultAzureCredentialBuilder().build()).buildClient();
        }

        assertNotNull(client, "Client should be successfully created");

        // List all analyzers and filter for ready ones
        PagedIterable<ContentAnalyzer> analyzers = client.listAnalyzers();

        System.out.println("\nListing ready analyzers:");
        System.out.println("========================");

        int readyCount = 0;
        for (ContentAnalyzer analyzer : analyzers) {
            if (analyzer.getStatus() != null && "ready".equalsIgnoreCase(analyzer.getStatus().toString())) {
                readyCount++;
                System.out.println("\nReady Analyzer #" + readyCount + ":");
                System.out.println("  ID: " + analyzer.getAnalyzerId());
                if (analyzer.getDescription() != null) {
                    System.out.println("  Description: " + analyzer.getDescription());
                }
            }
        }

        System.out.println("\n========================");
        System.out.println("Total ready analyzers: " + readyCount);

        // Verify
        Assertions.assertTrue(readyCount > 0, "Should have at least one ready analyzer");
        System.out.println("Verified: Found " + readyCount + " ready analyzer(s)");
    }
}
