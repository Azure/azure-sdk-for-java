// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.azure.ai.contentunderstanding.generated;

// The Java test files under 'generated' package are generated for your reference.
// If you wish to modify these files, please copy them out of the 'generated' package, and modify there.
// See https://aka.ms/azsdk/dpg/java/tests for guide on adding a test.

import com.azure.ai.contentunderstanding.ContentUnderstandingClient;
import com.azure.ai.contentunderstanding.ContentUnderstandingClientBuilder;
import com.azure.core.http.policy.HttpLogDetailLevel;
import com.azure.core.http.policy.HttpLogOptions;
import com.azure.core.test.TestMode;
import com.azure.core.test.TestProxyTestBase;
import com.azure.core.test.utils.MockTokenCredential;
import com.azure.core.util.Configuration;
import com.azure.identity.DefaultAzureCredentialBuilder;

class ContentUnderstandingClientTestBase extends TestProxyTestBase {
    protected ContentUnderstandingClient contentUnderstandingClient;

    // Sanitizer IDs to remove:
    // - AZSDK2003, AZSDK2030: Replace Location/Operation-Location headers with "https://example.com"
    //   which breaks LRO polling that relies on Operation-Location header URLs
    // - AZSDK3423: Replaces $..source field with "Sanitized", breaking field source validation
    // - AZSDK3430: Replaces $..id field with "Sanitized"
    // - AZSDK3493: Replaces $..name field with "Sanitized", breaking fieldSchema.name validation
    private static final String[] REMOVE_SANITIZER_ID
        = { "AZSDK2003", "AZSDK2030", "AZSDK3423", "AZSDK3430", "AZSDK3493" };

    @Override
    protected void beforeTest() {
        ContentUnderstandingClientBuilder contentUnderstandingClientbuilder = new ContentUnderstandingClientBuilder()
            .endpoint(
                Configuration.getGlobalConfiguration().get("AZURE_CONTENT_UNDERSTANDING_ENDPOINT", "https://localhost"))
            .httpClient(getHttpClientOrUsePlayback(getHttpClients().findFirst().orElse(null)))
            .httpLogOptions(new HttpLogOptions().setLogLevel(HttpLogDetailLevel.BASIC));
        if (getTestMode() == TestMode.PLAYBACK) {
            contentUnderstandingClientbuilder.credential(new MockTokenCredential());
        } else if (getTestMode() == TestMode.RECORD) {
            contentUnderstandingClientbuilder.addPolicy(interceptorManager.getRecordPolicy())
                .credential(new DefaultAzureCredentialBuilder().build());
        } else if (getTestMode() == TestMode.LIVE) {
            contentUnderstandingClientbuilder.credential(new DefaultAzureCredentialBuilder().build());
        }
        contentUnderstandingClient = contentUnderstandingClientbuilder.buildClient();

        // Remove sanitizers that break LRO polling by replacing entire URLs
        if (getTestMode() != TestMode.LIVE) {
            interceptorManager.removeSanitizers(REMOVE_SANITIZER_ID);
        }
    }
}
