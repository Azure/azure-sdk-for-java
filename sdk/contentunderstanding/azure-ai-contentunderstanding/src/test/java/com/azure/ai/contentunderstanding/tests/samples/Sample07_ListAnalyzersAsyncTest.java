// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.azure.ai.contentunderstanding.tests.samples;

import com.azure.ai.contentunderstanding.models.ContentAnalyzer;
import com.azure.core.http.rest.PagedFlux;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.*;

/**
 * Async sample demonstrating how to list all analyzers.
 * This sample shows:
 * 1. Listing all available analyzers (both prebuilt and custom)
 * 2. Filtering analyzers by status
 * 3. Iterating through paginated results
 * 4. Displaying analyzer properties
 */
public class Sample07_ListAnalyzersAsyncTest extends ContentUnderstandingClientTestBase {

    @Test
    public void testListAnalyzersAsync() {

        // BEGIN:ContentUnderstandingListAnalyzersAsync
        // List all analyzers
        PagedFlux<ContentAnalyzer> analyzers = contentUnderstandingAsyncClient.listAnalyzers();

        System.out.println("Listing all analyzers:");
        System.out.println("======================");

        final int[] count = { 0 };
        final int[] prebuiltCount = { 0 };
        final int[] customCount = { 0 };

        analyzers.toIterable().forEach(analyzer -> {
            count[0]++;

            // Determine if this is a prebuilt or custom analyzer
            boolean isPrebuilt = analyzer.getAnalyzerId().startsWith("prebuilt-");
            if (isPrebuilt) {
                prebuiltCount[0]++;
            } else {
                customCount[0]++;
            }

            System.out.println("\nAnalyzer #" + count[0] + ":");
            System.out.println("  ID: " + analyzer.getAnalyzerId());
            System.out.println("  Type: " + (isPrebuilt ? "Prebuilt" : "Custom"));

            if (analyzer.getDescription() != null && !analyzer.getDescription().trim().isEmpty()) {
                System.out.println("  Description: " + analyzer.getDescription());
            }

            if (analyzer.getBaseAnalyzerId() != null) {
                System.out.println("  Base Analyzer: " + analyzer.getBaseAnalyzerId());
            }

            if (analyzer.getStatus() != null) {
                System.out.println("  Status: " + analyzer.getStatus());
            }

            if (analyzer.getCreatedAt() != null) {
                System.out.println("  Created: " + analyzer.getCreatedAt());
            }

            if (analyzer.getLastModifiedAt() != null) {
                System.out.println("  Last Modified: " + analyzer.getLastModifiedAt());
            }

            // Display field schema summary if available
            if (analyzer.getFieldSchema() != null && analyzer.getFieldSchema().getFields() != null) {
                System.out.println("  Fields: " + analyzer.getFieldSchema().getFields().size() + " field(s) defined");
            }

            // Display tags if available
            if (analyzer.getTags() != null && !analyzer.getTags().isEmpty()) {
                System.out.println("  Tags: " + analyzer.getTags().size() + " tag(s)");
            }
        });

        System.out.println("\n======================");
        System.out.println("Total analyzers: " + count[0]);
        System.out.println("  Prebuilt: " + prebuiltCount[0]);
        System.out.println("  Custom: " + customCount[0]);
        // END:ContentUnderstandingListAnalyzersAsync

        // BEGIN:Assertion_ContentUnderstandingListAnalyzersAsync
        assertNotNull(analyzers, "Analyzers list should not be null");
        System.out.println("\nAnalyzers list retrieved successfully");

        // Verify we have at least the prebuilt analyzers
        assertTrue(count[0] > 0, "Should have at least one analyzer");
        assertTrue(prebuiltCount[0] > 0, "Should have at least one prebuilt analyzer");
        System.out.println("Verified: Found " + count[0] + " total analyzer(s)");
        System.out.println("Verified: Found " + prebuiltCount[0] + " prebuilt analyzer(s)");
        if (customCount[0] > 0) {
            System.out.println("Verified: Found " + customCount[0] + " custom analyzer(s)");
        }

        // Verify each analyzer has required properties
        final int[] validatedCount = { 0 };
        analyzers.toIterable().forEach(analyzer -> {
            if (validatedCount[0] < 5) {
                assertNotNull(analyzer.getAnalyzerId(), "Analyzer ID should not be null");
                assertFalse(analyzer.getAnalyzerId().trim().isEmpty(), "Analyzer ID should not be empty");
                assertNotNull(analyzer.getStatus(), "Analyzer status should not be null");
                validatedCount[0]++;
            }
        });

        System.out.println("All analyzer list properties validated successfully");
        // END:Assertion_ContentUnderstandingListAnalyzersAsync
    }

    @Test
    public void testListAnalyzersWithMaxResultsAsync() {
        // List all analyzers and filter for ready ones
        PagedFlux<ContentAnalyzer> analyzers = contentUnderstandingAsyncClient.listAnalyzers();

        System.out.println("\nListing ready analyzers:");
        System.out.println("========================");

        final int[] readyCount = { 0 };
        analyzers.toIterable().forEach(analyzer -> {
            if (analyzer.getStatus() != null && "ready".equalsIgnoreCase(analyzer.getStatus().toString())) {
                readyCount[0]++;
                System.out.println("\nReady Analyzer #" + readyCount[0] + ":");
                System.out.println("  ID: " + analyzer.getAnalyzerId());
                if (analyzer.getDescription() != null) {
                    System.out.println("  Description: " + analyzer.getDescription());
                }
            }
        });

        System.out.println("\n========================");
        System.out.println("Total ready analyzers: " + readyCount[0]);

        // Verify
        assertTrue(readyCount[0] > 0, "Should have at least one ready analyzer");
        System.out.println("Verified: Found " + readyCount[0] + " ready analyzer(s)");
    }
}
