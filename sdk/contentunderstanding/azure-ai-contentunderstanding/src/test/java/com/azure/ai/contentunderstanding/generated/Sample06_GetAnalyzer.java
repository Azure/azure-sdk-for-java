// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.azure.ai.contentunderstanding.generated;

import com.azure.ai.contentunderstanding.ContentUnderstandingClient;
import com.azure.ai.contentunderstanding.ContentUnderstandingClientBuilder;
import com.azure.ai.contentunderstanding.models.ContentAnalyzer;
import com.azure.core.credential.AzureKeyCredential;
import com.azure.core.util.Configuration;
import com.azure.identity.DefaultAzureCredentialBuilder;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.*;

/**
 * Sample demonstrating how to get analyzer information.
 * This sample shows:
 * 1. Retrieving analyzer details by ID
 * 2. Accessing analyzer configuration
 * 3. Inspecting field schema definitions
 * 4. Getting prebuilt analyzer information
 */
public class Sample06_GetAnalyzer {

    @Test
    public void testGetAnalyzerAsync() {
        // BEGIN: com.azure.ai.contentunderstanding.buildClient
        String endpoint = Configuration.getGlobalConfiguration().get("CONTENTUNDERSTANDING_ENDPOINT");
        String key = System.getenv("AZURE_CONTENT_UNDERSTANDING_KEY");

        // Build the client with appropriate authentication
        ContentUnderstandingClientBuilder builder = new ContentUnderstandingClientBuilder()
            .endpoint(endpoint);

        ContentUnderstandingClient client;
        if (key != null && !key.trim().isEmpty()) {
            // Use API key authentication
            client = builder.credential(new AzureKeyCredential(key)).buildClient();
        } else {
            // Use default Azure credential (for managed identity, Azure CLI, etc.)
            client = builder.credential(new DefaultAzureCredentialBuilder().build()).buildClient();
        }
        // END: com.azure.ai.contentunderstanding.buildClient

        // Verify client initialization
        assertNotNull(endpoint, "CONTENTUNDERSTANDING_ENDPOINT environment variable should be set");
        assertFalse(endpoint.trim().isEmpty(), "Endpoint should not be empty");
        assertNotNull(client, "Client should be successfully created");

        // BEGIN:ContentUnderstandingGetAnalyzer
        // Get a prebuilt analyzer (these are always available)
        String analyzerId = "prebuilt-invoice";

        ContentAnalyzer analyzer = client.getAnalyzer(analyzerId);

        System.out.println("Analyzer ID: " + analyzer.getAnalyzerId());
        System.out.println(
            "Base Analyzer ID: " + (analyzer.getBaseAnalyzerId() != null ? analyzer.getBaseAnalyzerId() : "N/A"));
        System.out.println("Description: " + (analyzer.getDescription() != null ? analyzer.getDescription() : "N/A"));

        // Display configuration
        if (analyzer.getConfig() != null) {
            System.out.println("\nAnalyzer Configuration:");
            System.out.println("  Enable OCR: " + analyzer.getConfig().isEnableOcr());
            System.out.println("  Enable Layout: " + analyzer.getConfig().isEnableLayout());
            System.out.println("  Enable Formula: " + analyzer.getConfig().isEnableFormula());
            System.out.println(
                "  Estimate Field Source and Confidence: " + analyzer.getConfig().isEstimateFieldSourceAndConfidence());
            System.out.println("  Return Details: " + analyzer.getConfig().isReturnDetails());
        }

        // Display field schema if available
        if (analyzer.getFieldSchema() != null) {
            System.out.println("\nField Schema:");
            System.out.println("  Name: " + analyzer.getFieldSchema().getName());
            System.out.println("  Description: " + (analyzer.getFieldSchema().getDescription() != null
                ? analyzer.getFieldSchema().getDescription()
                : "N/A"));
            if (analyzer.getFieldSchema().getFields() != null) {
                System.out.println("  Number of fields: " + analyzer.getFieldSchema().getFields().size());
                System.out.println("  Fields:");
                analyzer.getFieldSchema().getFields().forEach((fieldName, fieldDef) -> {
                    System.out.println("    - " + fieldName + " (" + fieldDef.getType() + ", Method: "
                        + (fieldDef.getMethod() != null ? fieldDef.getMethod() : "N/A") + ")");
                    if (fieldDef.getDescription() != null && !fieldDef.getDescription().trim().isEmpty()) {
                        System.out.println("      Description: " + fieldDef.getDescription());
                    }
                });
            }
        }

        // Display models if available
        if (analyzer.getModels() != null && !analyzer.getModels().isEmpty()) {
            System.out.println("\nModel Mappings:");
            analyzer.getModels().forEach((modelKey, modelValue) -> {
                System.out.println("  " + modelKey + ": " + modelValue);
            });
        }

        // Display status if available
        if (analyzer.getStatus() != null) {
            System.out.println("\nAnalyzer Status: " + analyzer.getStatus());
        }

        // Display created/updated timestamps if available
        if (analyzer.getCreatedAt() != null) {
            System.out.println("Created: " + analyzer.getCreatedAt());
        }
        if (analyzer.getLastModifiedAt() != null) {
            System.out.println("Updated: " + analyzer.getLastModifiedAt());
        }
        // END:ContentUnderstandingGetAnalyzer

        // BEGIN:Assertion_ContentUnderstandingGetAnalyzer
        Assertions.assertNotNull(analyzerId, "Analyzer ID should not be null");
        Assertions.assertNotNull(analyzer, "Analyzer should not be null");
        System.out.println("\nAnalyzer retrieved successfully");

        // Verify analyzer ID
        Assertions.assertNotNull(analyzer.getAnalyzerId(), "Analyzer ID should not be null");
        Assertions.assertEquals(analyzerId, analyzer.getAnalyzerId(), "Analyzer ID should match requested ID");
        System.out.println("Analyzer ID verified: " + analyzer.getAnalyzerId());

        // Verify analyzer has configuration
        Assertions.assertNotNull(analyzer.getConfig(), "Analyzer config should not be null");
        System.out.println("Analyzer configuration verified");

        // For prebuilt analyzers, verify they have field schema
        if (analyzer.getFieldSchema() != null) {
            Assertions.assertNotNull(analyzer.getFieldSchema().getName(), "Field schema name should not be null");
            Assertions.assertFalse(analyzer.getFieldSchema().getName().trim().isEmpty(),
                "Field schema name should not be empty");
            System.out.println("Field schema verified: " + analyzer.getFieldSchema().getName());

            if (analyzer.getFieldSchema().getFields() != null) {
                Assertions.assertTrue(analyzer.getFieldSchema().getFields().size() > 0,
                    "Field schema should have at least one field");
                System.out.println("Field schema contains " + analyzer.getFieldSchema().getFields().size() + " fields");
            }
        }

        System.out.println("All analyzer properties validated successfully");
        // END:Assertion_ContentUnderstandingGetAnalyzer
    }

    @Test
    public void testGetAnalyzerNotFoundAsync() {
        // Create the Content Understanding client
        String endpoint = Configuration.getGlobalConfiguration().get("CONTENTUNDERSTANDING_ENDPOINT");
        String key = System.getenv("AZURE_CONTENT_UNDERSTANDING_KEY");

        ContentUnderstandingClientBuilder builder = new ContentUnderstandingClientBuilder()
            .endpoint(endpoint);

        ContentUnderstandingClient client;
        if (key != null && !key.trim().isEmpty()) {
            client = builder.credential(new AzureKeyCredential(key)).buildClient();
        } else {
            client = builder.credential(new DefaultAzureCredentialBuilder().build()).buildClient();
        }

        assertNotNull(client, "Client should be successfully created");

        // Test getting another prebuilt analyzer
        String analyzerId = "prebuilt-document";

        ContentAnalyzer analyzer = client.getAnalyzer(analyzerId);

        System.out.println("\nRetrieving prebuilt-document analyzer...");
        System.out.println("Analyzer ID: " + analyzer.getAnalyzerId());
        System.out.println("Description: " + (analyzer.getDescription() != null ? analyzer.getDescription() : "N/A"));

        // Verify the analyzer
        Assertions.assertNotNull(analyzer, "Analyzer should not be null");
        Assertions.assertEquals(analyzerId, analyzer.getAnalyzerId(), "Analyzer ID should match");
        Assertions.assertNotNull(analyzer.getConfig(), "Analyzer config should not be null");
        System.out.println("Prebuilt-document analyzer verified successfully");
    }
}
