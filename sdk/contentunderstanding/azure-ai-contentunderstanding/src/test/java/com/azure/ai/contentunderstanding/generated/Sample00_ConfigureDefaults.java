// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.azure.ai.contentunderstanding.generated;

import com.azure.ai.contentunderstanding.ContentUnderstandingClient;
import com.azure.ai.contentunderstanding.ContentUnderstandingClientBuilder;
import com.azure.ai.contentunderstanding.models.ContentUnderstandingDefaults;
import com.azure.core.credential.AzureKeyCredential;
import com.azure.core.http.rest.RequestOptions;
import com.azure.core.http.rest.Response;
import com.azure.core.util.BinaryData;
import com.azure.core.util.Configuration;
import com.azure.identity.DefaultAzureCredentialBuilder;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.*;

/**
 * Test class demonstrating how to configure and manage default settings for Content Understanding service.
 * This test shows:
 * 1. Getting current default configuration
 * 2. Updating default configuration
 * 3. Verifying the updated configuration
 */
public class Sample00_ConfigureDefaults {

    @Test
    public void testConfigureDefaults() {
        // BEGIN: com.azure.ai.contentunderstanding.buildClient
        String endpoint = Configuration.getGlobalConfiguration().get("CONTENTUNDERSTANDING_ENDPOINT");
        String key = System.getenv("AZURE_CONTENT_UNDERSTANDING_KEY");

        // Build the client with appropriate authentication
        ContentUnderstandingClientBuilder builder = new ContentUnderstandingClientBuilder().endpoint(endpoint);

        ContentUnderstandingClient client;
        if (key != null && !key.trim().isEmpty()) {
            // Use API key authentication
            client = builder.credential(new AzureKeyCredential(key)).buildClient();
        } else {
            // Use default Azure credential (for managed identity, Azure CLI, etc.)
            client = builder.credential(new DefaultAzureCredentialBuilder().build()).buildClient();
        }
        // END: com.azure.ai.contentunderstanding.buildClient

        // Verify client initialization
        assertNotNull(endpoint, "CONTENTUNDERSTANDING_ENDPOINT environment variable should be set");
        assertFalse(endpoint.trim().isEmpty(), "Endpoint should not be empty");
        assertNotNull(client, "Client should be successfully created");

        // Step 1: Get current defaults
        System.out.println("Getting current default configuration...");
        ContentUnderstandingDefaults currentDefaults = client.getDefaults();
        System.out.println("Current defaults retrieved successfully.");
        System.out.println("Current configuration: " + currentDefaults);

        // Step 2: Update defaults with the same configuration (demonstrating update)
        System.out.println("\nUpdating default configuration...");

        // Convert the current defaults to BinaryData for the update request
        BinaryData defaultsBody = BinaryData.fromObject(currentDefaults);
        RequestOptions requestOptions = new RequestOptions();

        // Update defaults with the configuration
        Response<BinaryData> updateResponse = client.updateDefaultsWithResponse(defaultsBody, requestOptions);

        if (updateResponse.getStatusCode() == 200 || updateResponse.getStatusCode() == 201) {
            System.out.println("Defaults updated successfully.");
            System.out.println("Status code: " + updateResponse.getStatusCode());
        } else {
            System.err.println("Failed to update defaults. Status code: " + updateResponse.getStatusCode());
        }

        // Step 3: Verify the updated configuration
        System.out.println("\nVerifying updated configuration...");
        ContentUnderstandingDefaults updatedDefaults = client.getDefaults();
        System.out.println("Updated defaults verified successfully.");
        System.out.println("Updated configuration: " + updatedDefaults);

        System.out.println("\nConfiguration management completed.");
    }
}
